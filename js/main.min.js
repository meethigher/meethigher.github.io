/*!
 * https://github.com/meethigher/hugo-theme-starry
 *
 * Released under the MIT license
 *
 * https://meethigher.top
 *
 */(function(e){function n(e){this.starry=e,this.indexUrl=this.starry.varConfiguration.varSearchIndex,this.maxDescLength=100,this.cacheExpire=12*60*60*1e3,this.dbName="hugo-theme-starry",this.storeName="starry",this.dbVersion=1,this.searchIndex=[],this.searchVersion=0,this.states={LOADING_INDEX:"stateLoading",IDLE:"stateIdle",SEARCHING:"stateSearching",EMPTY:"stateEmpty",SUCCESS:"result"},this.currentState=this.states.IDLE,this.resultEl=document.getElementById("result"),this.inputEl=document.getElementById("searchInput")}n.prototype.openDB=function(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})},n.prototype.getCache=async function(e){const t=await this.openDB();return new Promise(n=>{const o=t.transaction(this.storeName,"readonly"),i=o.objectStore(this.storeName),s=i.get(e);s.onsuccess=()=>n(s.result),s.onerror=()=>n(null)})},n.prototype.setCache=async function(e,t){const n=await this.openDB();return new Promise(s=>{const o=n.transaction(this.storeName,"readwrite"),i=o.objectStore(this.storeName);i.put(t,e),o.oncomplete=()=>s()})},n.prototype.updateState=function(e){this.currentState=e;const t=document.getElementById(e);if(t){const e=document.querySelectorAll(".search-active");e.forEach(e=>{e.classList.remove("search-active")}),t.classList.add("search-active")}},n.prototype.truncateText=function(e){return e?e.length<=this.maxDescLength?e:e.slice(0,this.maxDescLength)+" …":""},n.prototype.formatDate=function(e){const t=new Date(e);return t.toLocaleString(navigator.language,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},n.prototype.debounce=function(e,t=300){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}},n.prototype.loadIndex=async function(){this.updateState(this.states.LOADING_INDEX);const e=await this.getCache("index");if(e&&Date.now()-e.time<this.cacheExpire){this.starry.funcUtils.log(`${e.data.length} cache expire time ${new Date(e.time+this.cacheExpire)}`,"Search"),this.searchIndex=e.data,this.updateState(this.states.IDLE);return}this.starry.funcUtils.log(`cache not exist`,"Search");const n=await fetch(this.indexUrl),t=await n.json();this.searchIndex=t,await this.setCache("index",{time:Date.now(),data:t}),this.updateState(this.states.IDLE),this.starry.funcUtils.log(`${t.length} cache created ${new Date}`,"Search")},n.prototype.renderResults=function(e){const t=performance.now(),n=e.map(e=>`
        <div class="result-item" onclick="this.querySelector('a').click()">
            <time class="result-date" datetime="${e.D}">${this.formatDate(e.D)}</time>
            <a class="result-title" href="${e.P}">${e.T}</a>
            <div class="result-desc">${this.truncateText(e.C)}</div>
        </div>
    `).join("");this.resultEl.innerHTML=n,this.starry.funcUtils.log(`search render results consumed ${(performance.now()-t).toFixed(2)} ms`,"Search")},n.prototype.doSearch=function(e){if(this.searchIndex.length===0){this.updateState(this.states.LOADING_INDEX);return}if(!e){this.updateState(this.states.IDLE);return}const t=++this.searchVersion;this.updateState(this.states.SEARCHING),setTimeout(()=>{if(t!==this.searchVersion)return;const s=e.toLowerCase().split(/\s+/).filter(e=>e),n=this.searchIndex.filter(e=>s.every(t=>(e.T||"").toLowerCase().includes(t)||(e.C||"").toLowerCase().includes(t))).sort((e,t)=>new Date(t.D)-new Date(e.D));if(!n.length){this.updateState(this.states.EMPTY);return}this.updateState(this.states.SUCCESS),this.renderResults(n)},200)},n.prototype.init=function(){this.updateState(this.states.LOADING_INDEX),this.loadIndex(),this.inputEl.addEventListener("input",this.debounce(e=>{this.doSearch(e.target.value.trim())},500))};function t(){this.funcUtils.log(`Welcome! You’re using hugo-theme-starry`),this.funcUtils.log(`If you like it, feel free to give it a ⭐ on GitHub!`);let e="starry-theme-mode",t=localStorage.getItem(e);this.config={themeKey:e,themeValue:t,starryId:"starry",lockedScrollTopPoint:0,locked:!1},this.startTime=performance.now(),this.search=new n(this)}t.prototype.varConfiguration={varProgressEnable:!1,varStarCount:200,varStarBgEnable:!1,varToolExpanded:!1,varSiteBegin:"2019/09/15 19:57:09",varStatsServiceEnable:!1,varStatsServiceUrl:"https://meethigher.top/census/count",varSearchIndex:"index.json"},t.prototype.funcGetStats=function(e,t,n){const s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("origin-referer",document.referrer),s.onload=function(){s.status>=200&&s.status<300?n(null,s.response):n(new Error("Request failed with status "+s.status))},s.onerror=function(){n(new Error("Network error"))},s.send(t)},t.prototype.funcInit=function(){this.funcBindEvents(),this.funcApplyTheme(),this.funcUtils.printInfo(this.startTime),this.funcUtils.log(`Theme configuration: varProgressEnable=${this.varConfiguration.varProgressEnable}`),this.funcUtils.log(`Theme configuration: varStarBgEnable=${this.varConfiguration.varStarBgEnable}`),this.funcUtils.log(`Theme configuration: varStarCount=${this.varConfiguration.varStarCount}`),this.funcUtils.log(`Theme configuration: varToolExpanded=${this.varConfiguration.varToolExpanded}`),this.funcUtils.log(`Theme configuration: varSiteBegin=${this.varConfiguration.varSiteBegin}`),this.funcUtils.log(`Theme configuration: varStatsServiceEnable=${this.varConfiguration.varStatsServiceEnable}`),this.funcUtils.log(`Theme configuration: varStatsServiceUrl=${this.varConfiguration.varStatsServiceUrl}`),this.search.init()},t.prototype.funcDiffDaysHours=function(e){const i=new Date(e.replace(/-/g,"/")).getTime(),a=Date.now();let t=a-i;const s=60*60*1e3,n=24*s,o=365*n,r=Math.floor(t/o);t%=o;const c=Math.floor(t/n);t%=n;const l=Math.floor(t/s);return{years:r,days:c,hours:l}},t.prototype.funcLockScrollTop=function(){this.config.locked||(this.funcUtils.log(`body locked`,"Scroll Lock"),this.config.locked=!0,this.config.lockedScrollTopPoint=e.scrollY,document.body.style.position="fixed",document.body.style.top=`-${this.config.lockedScrollTopPoint}px`,document.body.style.width="100%")},t.prototype.funcUnlockScrollTop=function(){this.config.locked&&(this.funcUtils.log(`body unlocked`,"Scroll Lock"),this.config.locked=!1,document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,this.config.lockedScrollTopPoint))},t.prototype.funcShowToast=function(e,t=1,n){const s=document.getElementById(e);if(!s)return;if(s.classList.contains("active"))return;n&&(s.querySelector("span").textContent=n),s.classList.add("active"),setTimeout(function(){s.classList.remove("active")},t*1e3)},t.prototype.funcShowModal=function(e){const n=this,t=document.getElementById(e);if(!t)return;if(t.classList.contains("active"))return;t.classList.add("active");const s=t.querySelector("button");s&&(s.onclick=function(){n.funcCloseModal(e)}),t.onclick=function(s){s.target===t&&n.funcCloseModal(e)},document.addEventListener("keydown",t=>{t.key==="Escape"&&n.funcCloseModal(e)}),n.funcLockScrollTop()},t.prototype.funcCloseModal=function(e){const t=document.getElementById(e);if(!t)return;t.classList.remove("active"),this.funcUnlockScrollTop()},t.prototype.funcStartProgress=function(e){if(this.varConfiguration.varProgressEnable){const t=document.getElementById("progressContainer"),n=document.getElementById("progressBar");t.style.display="block",requestAnimationFrame(()=>{n.style.width="100%"}),setTimeout(()=>{window.location.href=e},300)}},t.prototype.funcRegenStarry=function(){if(this.config.themeValue==="dark"&&this.varConfiguration.varStarBgEnable){let n=performance.now();const e=document.getElementById(this.config.starryId);e.innerHTML="";const t=this.varConfiguration.varStarCount;for(let s=0;s<t;s++){const n=document.createElement("div");n.classList.add("star");const i=Math.random()*100,a=Math.random()*100;n.style.left=`${i}%`,n.style.top=`${a}%`;const o=Math.random()*3+1;n.style.width=`${o}px`,n.style.height=`${o}px`;const r=Math.random()*5+3;n.style.setProperty("--duration",`${r}s`);const c=Math.random()*5;n.style.animationDelay=`${c}s`,e.appendChild(n)}this.funcUtils.log(`Theme regenerated ${t} stars consumed ${(performance.now()-n).toFixed(2)} ms`)}},t.prototype.funcCopyText=function(e){return new Promise((t,n)=>{if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(t).catch(n);else{const s=document.createElement("textarea");s.style.position="fixed",s.style.clip="rect(0 0 0 0)",s.style.top="10px",s.value=e,document.body.appendChild(s),s.select();try{const e=document.execCommand("copy");document.body.removeChild(s),e?t():n()}catch(e){document.body.removeChild(s),n(e)}}})},t.prototype.funcBindEvents=function(){const e=this,v=document.getElementById("themeToggle");v&&v.addEventListener("click",()=>{this.funcToggleTheme()});let s=document.getElementById("mobileHeaderMenu");s&&s.addEventListener("click",()=>{const e=s.getAttribute("aria-expanded")==="true";s.setAttribute("aria-expanded",String(!e)),document.getElementById("headerNav").classList.toggle("open",!e)});const p=document.getElementById("searchBtn");if(p){const t=()=>{e.funcUtils.log("triggered","Search Modal"),e.funcShowModal("searchBtnModal"),setTimeout(()=>e.search.inputEl.focus(),300)};p.addEventListener("click",t),document.addEventListener("keydown",e=>{e.ctrlKey&&e.shiftKey&&e.key.toLowerCase()==="f"&&(e.preventDefault(),t())})}const i=document.getElementById("scrollToTop"),c=document.getElementById("scrollToBottom");if(i&&c){let n=()=>{e.funcUtils.log(`triggered`,"Scroll to top"),window.scrollTo({top:0,behavior:"smooth"})},s=()=>{e.funcUtils.log(`triggered`,"Scroll to bottom"),window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})};c.addEventListener("click",s),i.addEventListener("click",n);let t="",o=0;const a=300;document.addEventListener("keydown",e=>{const i=e.key.toLowerCase(),r=Date.now();if(i==="t"||i==="b"){if(t===i&&r-o<=a){i==="t"&&n(),i==="b"&&s(),t="";return}t=i,o=r}else t=""})}let h=document.getElementById("toolMenuSwitcher"),r=document.getElementById("sidebarTools");h&&r&&h.addEventListener("click",()=>{r.setAttribute("aria-expanded",String(!this.varConfiguration.varToolExpanded)),this.varConfiguration.varToolExpanded=!this.varConfiguration.varToolExpanded,e.funcUtils.log(`expanded=${e.varConfiguration.varToolExpanded}`,"Sidebar tools")}),document.querySelectorAll("a").forEach(t=>{t.addEventListener("click",n=>{const s=t.getAttribute("href"),o=t.getAttribute("target");s&&!s.startsWith("#")&&o!=="_blank"&&e.varConfiguration.varProgressEnable&&(n.preventDefault(),e.funcStartProgress(s),e.funcUtils.log(`triggered`,"Progress"))})});let t=this.funcDiffDaysHours(this.varConfiguration.varSiteBegin),l=document.getElementById("timeYear"),d=document.getElementById("timeDay"),u=document.getElementById("timeHour");if(t&&l&&d&&u&&(l.innerText=t.years,d.innerText=t.days,u.innerText=t.hours),this.varConfiguration.varStatsServiceEnable){const t=document.getElementById("statsValue");this.funcGetStats(this.varConfiguration.varStatsServiceUrl,window.location.href.replace(/http:\/\/|https:\/\//,""),function(n,s){!n&&t?(t.innerText=s,e.funcUtils.log("success","Stats")):e.funcUtils.error("error","Stats")})}let a=document.getElementById("shareBtn");a&&a.addEventListener("click",t=>{e.funcUtils.log("triggered","Share"),e.funcCopyText(`[${document.title}]. Retrieved from ${window.location.href}`).then(function(){e.funcShowToast("shareBtnToastSuccess")}).catch(function(){e.funcShowToast("shareBtnToastError")})});let m=document.getElementById("rewardBtn");m&&m.addEventListener("click",t=>{e.funcUtils.log("triggered","Reward"),this.funcShowModal("rewardBtnModal")});const f=document.getElementById("taxonomySort"),o=document.getElementById("taxonomyTerm");if(f&&o){const t=Array.from(o.children);f.addEventListener("change",function(){const n=[...t];this.value==="nameAsc"?(e.funcUtils.log(`taxonomy triggered nameAsc=true`,"Sort"),n.sort((e,t)=>{const n=e.querySelector(".tag-name").textContent.trim(),s=t.querySelector(".tag-name").textContent.trim();return n.localeCompare(s,navigator.language,{sensitivity:"base"})})):(e.funcUtils.log(`taxonomy triggered nameAsc=false`,"Sort"),n.sort((e,t)=>{const n=parseInt(e.querySelector(".tag-count").textContent),s=parseInt(t.querySelector(".tag-count").textContent);return s-n}));const s=document.createDocumentFragment();n.forEach(e=>s.appendChild(e)),o.innerHTML="",o.appendChild(s)})}const g=document.getElementById("sectionSort"),n=document.getElementById("sectionTerm");if(g&&n){const t=Array.from(n.children);g.addEventListener("change",function(){e.funcUtils.log(`section triggered timeAsc=${this.value==="timeAsc"}`,"Sort");const s=[...t];s.sort((e,t)=>{const n=new Date(e.querySelector(".section-time").textContent.trim()).getTime(),s=new Date(t.querySelector(".section-time").textContent.trim()).getTime();return this.value==="timeAsc"?n-s:s-n});const o=document.createDocumentFragment();s.forEach(e=>o.appendChild(e)),n.innerHTML="",n.appendChild(o)})}document.querySelectorAll(".code-copy").forEach(t=>{t.addEventListener("click",n=>{const s=t.closest(".code-block");if(!s){e.funcUtils.error(".code-block container not found","Code copy");return}e.funcUtils.log("triggered","Code copy");const o=s.querySelector(".code-block-content td:last-child code");if(o){e.funcUtils.log("Detected code block with line numbers","Code copy");const t=o.textContent.trim();e.funcCopyText(t).then(function(){e.funcShowToast("codeCopyToastSuccess")}).catch(function(){e.funcShowToast("codeCopyToastError")})}else{const t=s.querySelector(".code-block-content code");if(t){e.funcUtils.log("Detected code block without line numbers","Code copy");const n=t.textContent.trim();e.funcCopyText(n).then(function(){e.funcShowToast("codeCopyToastSuccess")}).catch(function(){e.funcShowToast("codeCopyToastError")})}else e.funcUtils.error("Expected code block DOM structure not detected","Code copy")}})});let b=document.querySelector(".single-post");b&&new Viewer(b,{show(){e.funcUtils.log("open","Image Viewer"),e.funcLockScrollTop()},hide(){e.funcUtils.log("close","Image Viewer"),e.funcUnlockScrollTop()},zIndex:1e4,url:"data-src",button:!0,title:!0,navbar:!1,inline:!1,container:document.querySelector(".main-container"),toolbar:{zoomIn:!1,zoomOut:!1,oneToOne:!1,reset:!0,prev:!0,play:!1,next:!0,rotateLeft:!0,rotateRight:!0,flipHorizontal:!0,flipVertical:!0}}),e.imgObserver=new IntersectionObserver(t=>{t.forEach(t=>{if(!t.isIntersecting)return;const n=t.target,s=n.querySelector("img"),o=performance.now();s.src=s.dataset.src,s.onload=()=>{n.classList.remove("loading"),n.classList.add("loaded"),this.funcUtils.log(`${s.src} loaded ${(performance.now()-o).toFixed(2)} ms`,"Image")},e.imgObserver.unobserve(n)})},{rootMargin:"100px"}),document.querySelectorAll(".img-box").forEach(t=>{e.imgObserver.observe(t)})},t.prototype.funcApplyTheme=function(){document.documentElement.setAttribute(this.config.themeKey,this.config.themeValue),localStorage.setItem(this.config.themeKey,this.config.themeValue),this.funcRegenStarry()},t.prototype.funcToggleTheme=function(){this.config.themeValue=this.config.themeValue==="light"?"dark":"light",this.funcApplyTheme(),this.funcUtils.log(`Theme switched to ${this.config.themeValue}`)},t.prototype.funcUtils={formatTime:function(){const e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${s} ${o}:${i}:${a}`},log:function(e,t){const n=this.formatTime();t?console.log(`[Starry] [${n}] [${t}]`,e):console.log(`[Starry] [${n}]`,e)},error:function(e,t){const n=this.formatTime();t?console.error(`[Starry] [${n}] [${t}]`,e):console.error(`[Starry] [${n}]`,e)},printInfo:function(e){const a=(performance.now()-e).toFixed(2),t={author:"https://meethigher.top",createdDate:"2026-02-02",github:"https://github.com/meethigher/hugo-theme-starry",loadTime:`${a} ms`},s="=".repeat(50),o="color: #4CAF50; font-weight: bold; font-size: 14px;",r="color: #2196F3; font-weight: bold; font-size: 16px;",n="color: #666; font-weight: bold;",i="color: #333;",c="color: #2196F3; text-decoration: underline;",l="color: #FF9800;";console.log(`%c${s}
%chugo-theme-starry
%c${s}
%cAuthor: %c${t.author}
%cGitHub: %c${t.github}
%cCreated: %c${t.createdDate}
%cLoadTime: %c${t.loadTime}
%c${s}`,o,r,o,n,i,n,i,n,c,n,l,o)}},e.Starry=t})(window),document.addEventListener("DOMContentLoaded",()=>{const e=new Starry;e.funcInit()})