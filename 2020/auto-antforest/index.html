<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="蚂蚁森林自动解锁偷能量,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="今天最后一门科目也考完试了，可以放心码代码了！定时自动解锁，自动刷步数，自动收能量、偷能量"><title>蚂蚁森林自动解锁偷能量</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">蚂蚁森林自动解锁偷能量</h2></div><div class="post-content blog-markdown"><p>该脚本基于很多大佬开源的作品，先说声感谢。</p><p>我写的这个脚本只适用于我自己的手机，我不打算兼容其他手机。如果你要用，可以自己再二次修改，原理都是一样。源代码以及用到的软件放到<a href="https://github.com/meethigher/auto-antforest" target="_blank" rel="noopener">这里</a>;</p><blockquote><p>2020-07-21更新：</p><p>发现bug，即使通过xep来定时处理，autojs脚本也仍然可能出现中断运行的问题。这有可能是autojs的问题，我不知道他的sleep方法是如何实现的，sleep老是不能按期执行，偶尔能定时执行，偶尔又延迟好久执行。</p><p>总结了一下原因，还是出在息屏的问题上。长时间息屏导致后台sleep走时延迟。所以我在每天收蚂蚁森林的前一分钟，执行解锁脚本解锁一下，唤醒一下手机，过一分钟之后，再次执行自动脚本。目前是可以运行的。</p><p>2020-08-10更新：</p><p>今天更新了新版miui系统，但是脚本无法使用了，经过测试，发现xep定时执行是可以的，但是无法自动解锁。</p><p>解决办法是，授予电量无限制。新版MIUI会限制在后台启动app，除非给自启动权限，但是如果给了自启动，可能不定时的就会运行脚本，给生活带来困扰。</p></blockquote><h1 id="一、初版本"><a href="#一、初版本" class="headerlink" title="一、初版本"></a>一、初版本</h1><p>先放张截图</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/auto-antforest/1.png"><p>功能：</p><ol><li>定时解锁</li><li>自动刷步数</li><li>自动收能量</li><li>自动偷能量</li><li>锁屏</li></ol><p>全自动蚂蚁森林.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 该脚本的思路</span></span><br><span class="line"><span class="comment">* 运行之后，给定权限跟自启动和电源无限制。</span></span><br><span class="line"><span class="comment">* 每天到了下面指定的时间，自动运行。</span></span><br><span class="line"><span class="comment">* 我是android10。偶尔好使，偶尔不好使。</span></span><br><span class="line"><span class="comment">* 可能是android出于安全考虑，限制了息屏后app的运行（有时候时间会运行很慢，或者不走。我尝试将其安装成系统应用，但是还是不好使）</span></span><br><span class="line"><span class="comment">* 不过可以用来每隔10分钟执行一次，这样还是可以的，时间一久，就gg了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//检查是否开启无障碍服务，若未开启则等待开启</span></span><br><span class="line">auto.waitFor();</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试机分辨率为1080*2340</span></span><br><span class="line"><span class="comment">//不同像分辨率的机型会按比例缩放</span></span><br><span class="line">setScreenMetrics(<span class="number">1080</span>, <span class="number">2340</span>); <span class="comment">//不要修改该行代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g_help_friend = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//六球坐标值</span></span><br><span class="line"><span class="keyword">var</span> g_energy_postion = [</span><br><span class="line">    [<span class="number">250</span>, <span class="number">750</span>],</span><br><span class="line">    [<span class="number">350</span>, <span class="number">700</span>],</span><br><span class="line">    [<span class="number">450</span>, <span class="number">650</span>],</span><br><span class="line">    [<span class="number">600</span>, <span class="number">650</span>],</span><br><span class="line">    [<span class="number">750</span>, <span class="number">700</span>],</span><br><span class="line">    [<span class="number">850</span>, <span class="number">750</span>]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> hour = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">var</span> min = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> sec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//debug标志 用于测试</span></span><br><span class="line"><span class="keyword">const</span> DEBUG = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主程序入口</span></span><br><span class="line">main();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addSteps</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    launchApp(<span class="string">"小米步数管理"</span>);</span><br><span class="line">    sleep(<span class="number">500</span>);</span><br><span class="line">    id(<span class="string">"edtAddSteps"</span>).findOne().setText(<span class="number">20000</span>);</span><br><span class="line">    sleep(<span class="number">100</span>);</span><br><span class="line">    id(<span class="string">"btnAddSteps"</span>).findOne().click();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"增加步数"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解锁屏幕</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unlock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!device.isScreenOn()) &#123; <span class="comment">//息屏状态将屏幕唤醒</span></span><br><span class="line">        device.wakeUp(); <span class="comment">//唤醒设备</span></span><br><span class="line">        sleep(<span class="number">1000</span>); <span class="comment">// 等待屏幕亮起</span></span><br><span class="line">        <span class="comment">//miui锁屏滑动不能唤出密码输入 通过下拉通知栏点击时间进入密码解锁</span></span><br><span class="line">        swipe(<span class="number">500</span>, <span class="number">30</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="number">300</span>);</span><br><span class="line">        sleep(<span class="number">400</span>);</span><br><span class="line">        <span class="comment">//点击时间</span></span><br><span class="line">        click(<span class="number">100</span>, <span class="number">120</span>);</span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line">        click(<span class="number">555</span>, <span class="number">1379</span>); <span class="comment">//5</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">244</span>, <span class="number">1381</span>); <span class="comment">//4</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">224</span>, <span class="number">1200</span>); <span class="comment">//1</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">541</span>, <span class="number">1596</span>); <span class="comment">//8</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">541</span>, <span class="number">1596</span>); <span class="comment">//8</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">224</span>, <span class="number">1200</span>); <span class="comment">//1</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">244</span>, <span class="number">1381</span>); <span class="comment">//4</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">555</span>, <span class="number">1379</span>); <span class="comment">//5</span></span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        click(<span class="number">544</span>, <span class="number">1196</span>); <span class="comment">//2</span></span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"自动解锁屏幕"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *锁定屏幕</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    KeyCode(<span class="number">26</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"锁屏"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求截图权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScreenCapturePermission</span>(<span class="params"></span>) </span>&#123; <span class="comment">//建议永久开启截图权限，在"取消"按键的上方，部分设备看不见，但是是存在的可以点击</span></span><br><span class="line">    <span class="keyword">if</span> (!requestScreenCapture()) &#123;</span><br><span class="line">        toast(<span class="string">"获取截图权限失败，脚本退出"</span>);</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"获取截图权限失败，脚本退出"</span>);</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    toastLog(<span class="string">"获取截图权限成功，等待支付宝启动"</span>);</span><br><span class="line">    sleep(<span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注册退出事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">registerExitEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> thread = threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        events.observeKey();</span><br><span class="line">        events.onKeyDown(<span class="string">"volume_down"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            toast(<span class="string">"音量下键被按下，脚本退出"</span>);</span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">"音量下键被按下，脚本退出"</span>);</span><br><span class="line">            exit();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> thread;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 寻找支付宝首页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findHomePage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//尝试5次找到支付宝首页</span></span><br><span class="line">    <span class="keyword">while</span> (i++ &lt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (text(<span class="string">"首页"</span>).exists() &amp;&amp; text(<span class="string">"我的"</span>).exists()) <span class="keyword">break</span>;</span><br><span class="line">        back();</span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打开支付宝</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openAlipay</span>(<span class="params"></span>) </span>&#123; <span class="comment">//请确保打开了"Auto.js"的后台弹出界面权限</span></span><br><span class="line">    launchApp(<span class="string">"支付宝"</span>);</span><br><span class="line">    sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">//寻找支付宝首页</span></span><br><span class="line">    <span class="keyword">if</span> (!findHomePage()) &#123; <span class="comment">//未找到，退出脚本</span></span><br><span class="line">        toast(<span class="string">"寻找支付宝首页失败，脚本退出"</span>);</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"寻找支付宝首页失败，脚本退出"</span>);</span><br><span class="line">        exit();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//找到则点击</span></span><br><span class="line">        <span class="keyword">let</span> item = text(<span class="string">"首页"</span>).findOnce();</span><br><span class="line">        <span class="keyword">if</span> (!item.selected()) &#123;</span><br><span class="line">            <span class="keyword">let</span> pos = item.bounds();</span><br><span class="line">            <span class="keyword">if</span> (!click(pos.centerX(), pos.centerY())) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"打开支付宝首页失败，脚本退出"</span>);</span><br><span class="line">                exit();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"成功找到支付宝首页"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入蚂蚁森林</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">entranceAntForest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//滑动页面找到蚂蚁森林</span></span><br><span class="line">    <span class="keyword">var</span> item = <span class="literal">null</span>,</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i++ &lt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="comment">// 使用className和text双重定位</span></span><br><span class="line">        item = className(<span class="string">"android.widget.TextView"</span>).text(<span class="string">"蚂蚁森林"</span>).findOnce();</span><br><span class="line">        <span class="keyword">if</span> (item != <span class="literal">null</span>) <span class="keyword">break</span>;</span><br><span class="line">        swipe(<span class="number">520</span>, <span class="number">500</span>, <span class="number">520</span>, <span class="number">1500</span>, <span class="number">500</span>);</span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">        toast(<span class="string">"首页上没有蚂蚁森林，退出脚本"</span>);</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"首页上没有蚂蚁森林，退出脚本"</span>);</span><br><span class="line">        exit();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = item.bounds();</span><br><span class="line">        click(pos.centerX(), pos.centerY());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//确保进入蚂蚁森林主页</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (text(<span class="string">"背包"</span>).exists() &amp;&amp; text(<span class="string">"任务"</span>).exists()) <span class="keyword">break</span>;</span><br><span class="line">        sleep(<span class="number">1000</span>); <span class="comment">//进入蚂蚁森林主页的时间较长，因此循环检测的时间间隔设置为1000ms(default 500ms)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">        toast(<span class="string">"进入蚂蚁森林主页失败，退出脚本"</span>);</span><br><span class="line">        exit();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"成功进入蚂蚁森林主页"</span>, <span class="string">"用时"</span> + i * <span class="number">1.0</span> + <span class="string">"秒"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"成功进入蚂蚁森林主页"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//收集自己的能量</span></span><br><span class="line">    collectionEnergyByPosition(<span class="number">400</span>); <span class="comment">//100ms delay</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//确保"查看更多好友"控件出现在屏幕中</span></span><br><span class="line">    item = <span class="literal">null</span>;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        item = text(<span class="string">"查看更多好友"</span>).findOnce();</span><br><span class="line">        <span class="keyword">if</span> (item != <span class="literal">null</span> &amp;&amp; item.bounds().height() &gt; <span class="number">100</span>) <span class="keyword">break</span>;</span><br><span class="line">        swipe(<span class="number">520</span>, <span class="number">1800</span>, <span class="number">520</span>, <span class="number">300</span>, <span class="number">500</span>);</span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">        toast(<span class="string">"没有找到查看更多好友，退出脚本"</span>);</span><br><span class="line">        exit();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = item.bounds();</span><br><span class="line">        <span class="keyword">if</span> (!click(pos.centerX(), pos.centerY())) &#123;</span><br><span class="line">            toast(<span class="string">"进入好友排行榜失败，退出脚本"</span>);</span><br><span class="line">            exit();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//进入好友排行榜</span></span><br><span class="line">            <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"成功进入好友排行榜"</span>, <span class="string">"用时"</span> + i * <span class="number">0.5</span> + <span class="string">"秒"</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"成功进入好友排行榜"</span>);</span><br><span class="line">            <span class="comment">//预留足够的反应时间(default 2000ms)等待进入排行榜页面</span></span><br><span class="line">            <span class="comment">//否则会出现排行榜前几个好友检测不到的bug</span></span><br><span class="line">            sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//进入好友排行榜页面收集好友能量</span></span><br><span class="line">            entranceFriendsRank();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据名称查找并点击控件 返回null表示查找失败 返回false表示点击失败 返回true表示成功</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>click_name 控件名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>match_pos 前缀、后缀还是完全匹配</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>text_or_desc text还是desc属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>timeout 查找的超时时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">searchAndClickByName</span>(<span class="params">serach_name, match_pos, text_or_desc, timeout</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (match_pos == <span class="string">"prefix"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (text_or_desc == <span class="string">"text"</span>)</span><br><span class="line">            result = textStartsWith(serach_name).findOne(timeout);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            result = descStartsWith(serach_name).findOne(timeout);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (text_or_desc == <span class="string">"text"</span>)</span><br><span class="line">            result = textEndsWith(serach_name).findOne(timeout);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            result = descEndsWith(serach_name).findOne(timeout);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = result.bounds();</span><br><span class="line">        <span class="keyword">if</span> (pos.centerX() &lt; <span class="number">0</span> || pos.centerY() &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> click(pos.centerX(), pos.centerY());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过六球坐标收取(帮收)能量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">delay</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collectionEnergyByPosition</span>(<span class="params">delay</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(delay) == <span class="string">"undefined"</span>) delay = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; g_energy_postion.length; ++i) &#123;</span><br><span class="line">        click(g_energy_postion[i][<span class="number">0</span>], g_energy_postion[i][<span class="number">1</span>]);</span><br><span class="line">        sleep(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取截图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCaptureImg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = captureScreen();</span><br><span class="line">    sleep(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">if</span> (img == <span class="literal">null</span> || <span class="keyword">typeof</span>(img) == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">        toast(<span class="string">"截图失败，脚本退出"</span>);</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"截图失败，脚本退出"</span>);</span><br><span class="line">        exit();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取有能量成熟的好友</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHasEnergyFriends</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = getCaptureImg();</span><br><span class="line">    <span class="keyword">var</span> hand = <span class="literal">null</span>,</span><br><span class="line">        heart = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找可收取能量的小手 "#1da06d"为深绿色 "#ffffff"为白色</span></span><br><span class="line">    hand = images.findMultiColors(img, <span class="string">"#1da06d"</span>, [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">-7</span>, <span class="string">"#ffffff"</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">10</span>, <span class="string">"#ffffff"</span>]</span><br><span class="line">    ], &#123;</span><br><span class="line">        region: [<span class="number">1010</span>, <span class="number">400</span>, <span class="number">1</span>, <span class="number">1800</span>],</span><br><span class="line">        threshold: <span class="number">4</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (hand != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">"找到**可收取**好友"</span>);</span><br><span class="line">        <span class="keyword">return</span> [hand, <span class="string">"hand"</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (g_help_friend == <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">//查找可帮收能量的爱心 "##f99236"为橙色</span></span><br><span class="line">        heart = images.findColor(img, <span class="string">"#f99236"</span>, &#123; <span class="attr">region</span>: [<span class="number">1000</span>, <span class="number">400</span>, <span class="number">10</span>, <span class="number">1800</span>], <span class="attr">threshold</span>: <span class="number">4</span> &#125;);</span><br><span class="line">        <span class="keyword">if</span> (heart != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.info(<span class="string">"找到**可帮收**好友"</span>);</span><br><span class="line">            <span class="keyword">return</span> [heart, <span class="string">"heart"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检测是否到达排行榜底部</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arriveRankBottom</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = getCaptureImg();</span><br><span class="line">    <span class="comment">//分别是白色、浅灰色、深灰色</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">    result = images.findMultiColors(img, <span class="string">"#F5F5F5"</span>, [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">-40</span>, <span class="string">"#FFFFFF"</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">20</span>, <span class="string">"#999999"</span>]</span><br><span class="line">    ], &#123;</span><br><span class="line">        region: [<span class="number">600</span>, <span class="number">2000</span>],</span><br><span class="line">        threshold: <span class="number">1</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入好友排行榜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">entranceFriendsRank</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    sleep(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">var</span> epoint = getHasEnergyFriends();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//确保当前操作是在排行榜界面</span></span><br><span class="line">    <span class="comment">//不断滑动，查找好友</span></span><br><span class="line">    <span class="keyword">while</span> (epoint == <span class="literal">null</span>) &#123;</span><br><span class="line">        swipe(<span class="number">520</span>, <span class="number">1800</span>, <span class="number">520</span>, <span class="number">800</span>, <span class="number">500</span>);</span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line">        epoint = getHasEnergyFriends();</span><br><span class="line">        <span class="comment">//如果检测到结尾，同时也没有可收能量的好友，那么结束收取</span></span><br><span class="line">        <span class="keyword">if</span> (epoint == <span class="literal">null</span> &amp;&amp; arriveRankBottom()) &#123;</span><br><span class="line">            toastLog(<span class="string">"没有更多好友了"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果连续32次都未检测到可收集好友,无论如何停止查找</span></span><br><span class="line">        <span class="keyword">if</span> (i++ &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"程序可能出错, 连续"</span> + i + <span class="string">"次未检测到可收集好友"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//找到好友，进入好友森林</span></span><br><span class="line">    <span class="keyword">if</span> (click(epoint[<span class="number">0</span>].x, epoint[<span class="number">0</span>].y + <span class="number">20</span>)) &#123;</span><br><span class="line">        <span class="comment">//确认进入了好友森林</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text(<span class="string">"TA收取你"</span>).exists() &amp;&amp; text(<span class="string">"你收取TA"</span>).exists()) <span class="keyword">break</span>;</span><br><span class="line">            sleep(<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (DEBUG) <span class="built_in">console</span>.log(<span class="string">"成功进入好友森林主页"</span>, <span class="string">"用时"</span> + i * <span class="number">0.5</span> + <span class="string">"秒"</span>);</span><br><span class="line">            collectionEnergyByPosition(<span class="number">400</span>); <span class="comment">//100ms delay</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回排行榜</span></span><br><span class="line">        back();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//递归调用</span></span><br><span class="line">    entranceFriendsRank();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">let</span> sleepHour, sleepMin, sleepSec;</span><br><span class="line">        <span class="keyword">if</span> (date.getSeconds() &gt; sec) &#123;</span><br><span class="line">            sleepSec = <span class="number">60</span> - date.getSeconds() + sec;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sleepSec = sec - date.getSeconds();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (date.getMinutes() &gt; min) &#123;</span><br><span class="line">            sleepMin = <span class="number">60</span> - date.getMinutes() + min;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (date.getMinutes() == min) &#123;</span><br><span class="line">            <span class="keyword">if</span> (date.getSeconds() &lt; sec) &#123;</span><br><span class="line">                sleepMin = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sleepMin = <span class="number">60</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sleepMin = min - date.getMinutes();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (date.getHours() &gt; hour) &#123;</span><br><span class="line">            sleepHour = <span class="number">24</span> - date.getHours() + hour;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (date.getHours() == hour) &#123;</span><br><span class="line">            <span class="keyword">if</span> (date.getMinutes() &lt; min) &#123;</span><br><span class="line">                sleepHour = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sleepHour = <span class="number">24</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sleepHour = hour - date.getHours();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sleepHour &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sleepHour--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sleepMin &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sleepMin--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> message = <span class="string">"休眠"</span> + sleepHour + <span class="string">"小时"</span> + sleepMin + <span class="string">"分钟"</span> + sleepSec + <span class="string">"秒后运行"</span>;</span><br><span class="line">        toast(message);</span><br><span class="line">        <span class="built_in">console</span>.log(message);</span><br><span class="line"></span><br><span class="line">        sleep(sleepHour * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> + sleepMin * <span class="number">60</span> * <span class="number">1000</span> + sleepSec * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        unlock();</span><br><span class="line">        <span class="comment">//添加步数</span></span><br><span class="line">        addSteps();</span><br><span class="line">        <span class="comment">//获取截图权限</span></span><br><span class="line">        getScreenCapturePermission();</span><br><span class="line">        <span class="comment">//注册"音量下键按下退出脚本"事件</span></span><br><span class="line">        <span class="comment">//var exit_event = registerExitEvent();</span></span><br><span class="line">        <span class="comment">//等待退出事件子线程执行</span></span><br><span class="line">        <span class="comment">//exit_event.waitFor();</span></span><br><span class="line">        <span class="comment">//打开支付宝</span></span><br><span class="line">        openAlipay();</span><br><span class="line">        <span class="comment">//进入蚂蚁森林</span></span><br><span class="line">        entranceAntForest();</span><br><span class="line">        lock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，我将上述代码打包成了app。如下图。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/auto-antforest/2.png"><h1 id="二、Bug"><a href="#二、Bug" class="headerlink" title="二、Bug"></a>二、Bug</h1><p>短时间后台运行，autojs是可以自动解锁完成一系列功能的。</p><p>长时间后台运行，就不行了。即使你给了所有权限、自启动、电源无限制，也是没用的。这应该是高版本android对后台app的一些限制。</p><p>我看网上说，用tasker，我也试了，跟autojs同样的问题。</p><h1 id="三、改进"><a href="#三、改进" class="headerlink" title="三、改进"></a>三、改进</h1><p>通过xposed edge pro添加定时任务，定时启动上述脚本app。然后脚本app再执行解锁、刷步数、收能量、锁屏一系列操作。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/auto-antforest/3.png"><h1 id="四、致谢"><a href="#四、致谢" class="headerlink" title="四、致谢"></a>四、致谢</h1><ol><li><a href="https://github.com/kwu130/Alipay" target="_blank" rel="noopener">蚂蚁森林自动收取能量</a></li><li><a href="https://www.52pojie.cn/thread-1105058-1-1.html" target="_blank" rel="noopener">云养鸡种树</a></li></ol><p>感谢以上大佬！</p></div><div class="post-detail">发布：2020-07-06 02:51:37<br>修改：2020-08-10 12:20:20<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/auto-antforest/</span><br>标签：<span><a href="/blog/tags/open/">open</a>&nbsp;<a href="/blog/tags/js/">js</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="post-comment"><span class="instruction">翻墙之后才能评论哦</span><div id="gitalk-container"></div></div><link rel="stylesheet" href="/blog/css/gitalk.css"><script src="/blog/js/gitalk.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"84249c02e216e3ce376a",clientSecret:"a032ae7096d026eff848b5815da5afde341e9ffd",repo:"meethigher.github.io",owner:"meethigher",admin:["meethigher"],id:location.pathname,distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>