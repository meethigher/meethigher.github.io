<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="数据库学习笔记,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="老师给自己讲蒙了，满肚子的疑问，也懒得跟老师交流。让我直接把网课打上了静音。我还不如自己学。"><title>数据库学习笔记</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">数据库学习笔记</h2></div><div class="post-content blog-markdown"><p>以下是个人牢骚。</p><p>有个场景，很可笑。</p><p>某上课场景</p><p>学生：老师，我的xx按你说的运行不了啊。</p><p>老师：你安装得不对，卸载了重新安。</p><blockquote><p>其实是学生安装的是最新版，老师非要让学生下载老古董。更气人的是，某些老古董，都已经找不到完整的原程序了。</p></blockquote><p>某面试场景</p><p>面试官：你用过什么数据库？</p><p>面试者：我们老师教过小海豚标志的数据库，我用得很熟练。</p><blockquote><p>教我们的某个老师，自己就搞不懂，mysql是啥，sqlyog又是啥。教的时候，就把sqlyog当做mysql来操作了。</p><p>mysql是数据库，可以通过命令行来操作；sqlyog是数据库的界面可视化工具</p></blockquote><p>大部分老师，是不懂得更新自己知识的，毕竟职业已经是铁饭碗，谁还去想，教的东西有没有用，学生到底学到了什么？</p><p>好老师有吗？当然有。一些刚入职教师行业的老师，还很理想化。就拿我某个老师来说，他一直说，教书育人是件很神圣的事，上课也要有仪式感。我们也都觉得这个老师好，但是他自己呢？工资低、同时也没有副业。还有的老师，兢兢业业备课，认认真真教书。就连期末学生给他送钱，求个及格，老师都拒绝了。过得清廉，然而他也只是个老师而已。</p><p>某些老师，教学混日子，上课出去抽根烟，出去撒泡尿，半节课就过去了。但是他自己有很多职称，有很多副业，有很多关系，有很多专利。你即使去问问题，他也不鸟你。学生确实没学到东西，但是他自己钱包赚得满满的。</p><p>当然，还有些老师，教学认真教，各种关系处得也很好，自己手头也有很多项目。这种老师要看自己机缘了。</p><p>本文以MySQL8.0+为例，仅做入门参考。具体内容，参照<a href="https://dev.mysql.com/doc/refman/8.0/en/preface.html" target="_blank" rel="noopener">MySQL官方文档</a>。</p><h1 id="一、数据库概念"><a href="#一、数据库概念" class="headerlink" title="一、数据库概念"></a>一、数据库概念</h1><p>英文：DataBase 简称DB</p><p>概念：用于存储和管理数据的仓库</p><p>数据库的特点：</p><ol><li>持久化存储数据。本质是一个文件系统</li><li>方便存储和管理数据</li><li>使用了统一的方式（SQL）操作数据库</li></ol><p>常见的数据库：</p><p>全球数据库排名<a href="https://db-engines.com/en/ranking" target="_blank" rel="noopener">DB-Engines Ranking</a></p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/1.png" title="2020年数据库排名"><ul><li>Oracle：收费的，大型关系数据库，Oracle公司的产品。Oracle收购Sun公司，收购MySQL</li><li>MySQL：开源免费的数据库，小型关系数据库。被Oracle收购之后，开始收费<ul><li>免费： 免费版本的具有开源协议，在免费版本上进行的任何修改所发布的软件，也必须是开源的（开源牛逼！）</li><li>收费： 如果你想将修改后的软件出售获利，就必须得购买收费版本才可以 。 此外，收费版本卖的不是软件，而是服务，当数据出现问题的时候，购买的服务可以帮助处理发生问题的数据。</li></ul></li><li>SQLServer：MicroSoft公司收费的中型关系型数据库。C#，.Net等语言常使用。</li><li>DB2：IBM公司的大型关系数据库产品，收费的。常用在银行系统中</li><li>SQLite：嵌入式的小型关系型数据库，内置到软件或系统中去，比方说浏览器。应用在Android手机端</li><li>SyBase：已经淡出历史舞台。提供了一个非常专业的数据建模工具<a href="http://powerdesigner.de/" target="_blank" rel="noopener">PowerDesigner</a></li></ul><h1 id="二、SQL概念"><a href="#二、SQL概念" class="headerlink" title="二、SQL概念"></a>二、SQL概念</h1><p>SQL：结构化查询语言（Structured Query Language ），其实就是定义了操作<strong>所有关系型数据库</strong>的规则。每一种数据库操作的方式存在不一样的地方，就类似于“方言”。</p><p>SQL通用语法：</p><ol><li>SQL语句可以单行或者多行书写，以分号结尾</li><li>使用空格和缩进来提高语句可读性</li><li>SQL语句不区分大小写，关键字建议使用大写</li><li>注释<ul><li>单行注释：– 注释内容 或者 <strong># 注释内容（MySQL特有）</strong></li><li>多行注释：/* 注释 */</li></ul></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单行注释</span></span><br><span class="line"><span class="comment"># 单行注释，MySQL特有</span></span><br><span class="line"><span class="comment">/* 注释 */</span></span><br></pre></td></tr></table></figure><p>SQL分类：</p><ol><li><a href="#4-1-DDL：操作数据库、表">DDL</a>(Data Definition Language)数据定义语言。用来定义数据库对象：数据库，表，列等。关键字：create, drop,alter 等</li><li><a href="#4-2-DML：增删改表中数据">DML</a>(Data Manipulation Language)数据操作语言。用来对数据库中表的数据进行增删改。关键字：insert, delete, update 等</li><li><a href="#4-3-DQL：查询表中记录">DQL</a>(Data Query Language)数据查询语言。用来查询数据库中表的记录(数据)。关键字：select, where 等</li><li><a href="#4-4-DCL：管理用户与权限">DCL</a>(Data Control Language)数据控制语言。用来定义数据库的访问权限和安全级别，及创建用户。关键字：GRANT， REVOKE 等</li></ol><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/2.png" title="描述"><h1 id="三、MySQL使用"><a href="#三、MySQL使用" class="headerlink" title="三、MySQL使用"></a>三、MySQL使用</h1><p>数据库可视化操作工具：</p><ol><li><a href="https://www.navicat.com.cn/download/navicat-premium" target="_blank" rel="noopener">Navicat Premium</a>（目前为止，感觉最好用的一款）</li><li><a href="https://sqlyog.en.softonic.com/download" target="_blank" rel="noopener">SQLyog</a>（最新版的界面依旧是上古风格，不过还是挺好用的，推荐）</li><li><a href="https://dbeaver.io/download/" target="_blank" rel="noopener">DBeaver</a>（别人推荐，我还没用过）</li></ol><p>题外话，讲讲使用技巧</p><p><a href="https://blog.csdn.net/xu1227233860/article/details/78278393" target="_blank" rel="noopener">Navicat生成ER关系图并导出</a></p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/15.png"><p><a href="https://blog.csdn.net/whdxkcx/article/details/78271845" target="_blank" rel="noopener">SQLyog生成关系图</a></p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/16.png"><p>Navicat查看sql语句</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/19.png"><p>SQLyod查看sql语句</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/20.png"><p>MySQL下载：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">地址</a></p><p>推荐解压版，拒绝傻瓜式。身为开发者，动手能力必须要强。我某同学，至今还以为mysql是个软件。我曾经给人安装了解压版，然后人家跟我说，这不是mysql，有海豚标志的才是mysql（可视化工具sqlyog的图标）。我就回了一句，哦，我还不太会安，你找别人吧。</p><p>常用命令行（进入到mysql的bin目录下）：</p><ul><li><p>mysql -u 用户名 -p 用户名 或mysql -u 用户名 -p; - - 连接数据库</p></li><li><p>show databases; - - 展示全部数据库</p></li><li><p>create database name; - - 创建name数据库</p></li><li><p>use name; - - 使用name数据库</p></li><li><p>show tables; - - 展示其中的表</p></li><li><p>create table name (id int,name varchar(20),age int); - - 创建name表，其中有3列，int型id列，varchar型长度为20的name列，int型age列</p></li><li><p>desc name; - - 查看name表的结构</p></li><li><p>source sql.sql; - - 执行本地的sql.sql文件</p></li><li><p>drop table name; - - 删除name表</p></li><li><p>drop database name; - - 删除name数据库</p></li><li><p>exit或quit; - - 退出数据库终端</p></li></ul><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/3.png" title="mysql操作"><p>windows下用命令行操作，是件极爽的事情，最进下载了一套数学视频，文件名都被打了小广告，cmd一键批处理，爽地不要不要的</p><p>本来想着写一篇cmd命令学习笔记，但奈何内容太庞大了，等哪天有足够的时间，来系统学习的话，我会写一篇的。</p><h1 id="四、SQL操作"><a href="#四、SQL操作" class="headerlink" title="四、SQL操作"></a>四、SQL操作</h1><p>以下例子都是基于MySQL</p><h2 id="4-1-DDL：操作数据库、表"><a href="#4-1-DDL：操作数据库、表" class="headerlink" title="4.1 DDL：操作数据库、表"></a>4.1 DDL：操作数据库、表</h2><h3 id="操作数据库：CRUD"><a href="#操作数据库：CRUD" class="headerlink" title="操作数据库：CRUD"></a>操作数据库：CRUD</h3><p>也就是所谓的增删改查</p><ol><li><p>C(Create)：创建<br>创建beauty数据库，判断是否存在，并设置字符集为UTF-8：create database if not exists beauty character set utf8;</p></li><li><p>R(Retrieve)：读取<br>查询所有数据库：show databases;</p></li><li><p>U(Update)：更新</p><p>查看数据库的字符集：show create database beauty;<br>修改数据库的字符集：alter database beauty character set gbk;</p></li><li><p>D(Delete)：删除<br>删除数据库：drop database if exists beauty;</p></li><li><p>使用数据库：use beauty;</p></li></ol><p>查看当前使用的数据库：select database();</p><h3 id="操作表：CRUD"><a href="#操作表：CRUD" class="headerlink" title="操作表：CRUD"></a>操作表：CRUD</h3><ol><li><p>C(Create)：创建<br>语法：create table 表名 (列名1 数据类型1,列名2 数据类型2,…,列名n 数据类型n);</p><p>创建表：create table girls(id int,name varchar(20),score double(4,1),birthday date,insert_time timestamp);</p><p>复制表：create table 表名 like 被复制的表名;</p></li><li><p>R(Retrieve)：读取<br>查询所有表：show tables;<br>查询表结构：desc 表名</p></li><li><p>U(Update)：更新<br>修改表名：alter table 表名 rename to 新表名;<br>查看表的字符集：show create table 表名;<br>修改表的字符集：alter table 表名 character set utf8;<br>添加一列：alter table 表名 add 列名 数据类型;<br>修改列的类型：alter table 表名 modify 列名 新类型;<br>修改列名称 类型： alter table 表名 change 列名 新列名 新类型;<br>删除列：alter table 表名 drop 列名;</p></li><li><p>D(Delete)：删除<br>删除表：drop table if exists 表名;</p></li></ol><blockquote><p>数据类型的注意点：</p><p>double(4,1)表示总长度为4的数，其中小数有1位</p><p>date表示日期，只包含年月日，yyyy/MM/dd。我在开发starry的时候，发现在ios的safari中，只识别yyyy/MM/dd，而不识别yyyy-MM-dd，使用的时候注意。</p><p>datetime表示日期，包含年月日时分秒，yyyy/MM/dd HH:mm:ss</p><p>timestamp表示时间戳，包含年月日时分秒，yyyy/MM/dd HH:mm:ss。有种说法，“如果将来不给这个字段赋值，或者赋值为null，则默认使用系统当前时间，来自动赋值。”，经测验无效。</p></blockquote><h2 id="4-2-DML：增删改表中数据"><a href="#4-2-DML：增删改表中数据" class="headerlink" title="4.2 DML：增删改表中数据"></a>4.2 DML：增删改表中数据</h2><h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><p>语法：insert into 表名(列名1,列名2,…,列名n) values(值1,值2,…,值n);</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> fairy(<span class="keyword">id</span>,<span class="keyword">NAME</span>,score) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'胡列娜'</span>,<span class="number">80.1</span>);</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>列名和值，要一一对应。</li><li>如果表名后，不定义列名，则默认给所有列添加值。insert into 表名 values(值1,值2,…,值n);</li><li>除了数字类型，其他类型都需要使用引号（单双引号都可以）引起来</li></ol><h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>语法：delete from 表名 where 条件;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> <span class="keyword">NAME</span>=<span class="string">'水冰儿'</span>;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>如果不加条件，则会删除表中所有记录。</li><li>如果要删除所有记录。<ul><li>delete from 表名; 不推荐使用，有多少条记录，就会执行多少次删除操作。效率比较低。</li><li>truncate table 表名; 推荐使用，先删除表，然后再创建一张一模一样的表。效率比较高。</li></ul></li></ol><h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>语法：update 表名 set 列名1=值1,列名2=值2,…,列名n=值n where 条件;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> fairy <span class="keyword">SET</span> <span class="keyword">NAME</span>=<span class="string">'水月儿'</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>如果不加任何条件，则会将表中所有记录全部修改</li></ol><h2 id="4-3-DQL：查询表中记录"><a href="#4-3-DQL：查询表中记录" class="headerlink" title="4.3 DQL：查询表中记录"></a>4.3 DQL：查询表中记录</h2><p>导入数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="string">`beauty`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Table structure for table `fairy` */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`fairy`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`fairy`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`gender`</span> <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`grade`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`school`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`position`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">9</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Data for the table `fairy` */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`fairy`</span>(<span class="string">`id`</span>,<span class="string">`name`</span>,<span class="string">`gender`</span>,<span class="string">`age`</span>,<span class="string">`grade`</span>,<span class="string">`school`</span>,<span class="string">`position`</span>) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">'胡列娜'</span>,<span class="string">'女'</span>,<span class="number">22</span>,<span class="number">52</span>,<span class="string">'武魂殿学院'</span>,<span class="string">'武魂殿'</span>),(<span class="number">2</span>,<span class="string">'邱若水'</span>,<span class="string">'女'</span>,<span class="number">18</span>,<span class="number">37</span>,<span class="string">'天水学院'</span>,<span class="string">'天斗帝国'</span>),(<span class="number">3</span>,<span class="string">'水冰儿'</span>,<span class="string">'女'</span>,<span class="number">17</span>,<span class="number">43</span>,<span class="string">'天水学院'</span>,<span class="string">'天斗帝国'</span>),(<span class="number">4</span>,<span class="string">'水月儿'</span>,<span class="string">'女'</span>,<span class="number">17</span>,<span class="number">36</span>,<span class="string">'天水学院'</span>,<span class="string">'天斗帝国'</span>),(<span class="number">5</span>,<span class="string">'邪月'</span>,<span class="string">'男'</span>,<span class="number">22</span>,<span class="number">53</span>,<span class="string">'武魂殿学院'</span>,<span class="string">'武魂殿'</span>),(<span class="number">6</span>,<span class="string">'唐三'</span>,<span class="string">'男'</span>,<span class="number">16</span>,<span class="number">44</span>,<span class="string">'史莱克'</span>,<span class="string">'天斗帝国'</span>),(<span class="number">7</span>,<span class="string">'戴沐白'</span>,<span class="string">'男'</span>,<span class="number">21</span>,<span class="number">48</span>,<span class="string">'史莱克学院'</span>,<span class="string">'天斗帝国'</span>),(<span class="number">8</span>,<span class="string">'胡列娜'</span>,<span class="string">'女'</span>,<span class="number">22</span>,<span class="number">52</span>,<span class="string">'武魂殿学院'</span>,<span class="string">'武魂殿'</span>);</span><br></pre></td></tr></table></figure><p>语法：select 字段列表 from 表名列表 where 条件列表 group by 分组字段 having 分组之后的条件限定 order by 排序规则 limit 分页限定</p><h3 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h3><ol><li>多个字段的查询<br>select 字段名1,字段名2,… from 表名;<br>如果查询所有字段，可以使用 * 来替代字段列表</li><li>去除重复<br>DISTINCE关键字</li><li>计算列<br>一般可以使用四则运算，来计算列的值<br>IFNULL(表达式1,表达式2) 表达式1是指需要判断为NULL的字段，表达式2是指NULL的替换值。</li><li>起别名<br>AS关键字，也可以省略</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 多个字段查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,school <span class="keyword">FROM</span> fairy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 去除重复</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> school <span class="keyword">FROM</span> fairy;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">NAME</span>,school <span class="keyword">FROM</span> fairy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算age跟grade之和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age,grade,age+grade <span class="keyword">FROM</span> fairy;</span><br><span class="line"><span class="comment">-- 如果有NULL参与运算，将NULL换位0</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age,grade,<span class="keyword">IFNULL</span>(age,<span class="number">0</span>)+<span class="keyword">IFNULL</span>(grade,<span class="number">0</span>) <span class="keyword">AS</span> <span class="string">'年龄+等级'</span> <span class="keyword">FROM</span> fairy;</span><br></pre></td></tr></table></figure><h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><ol><li><p>where子句后跟条件</p></li><li><p>运算符</p></li></ol><table><thead><tr><th>运算符</th><th>含义</th></tr></thead><tbody><tr><td>&gt;、&lt;、&lt;=、&gt;=、=、&lt;&gt;</td><td>&lt;&gt;在 SQL 中表示不等于，在 mysql 中也可以使用!=，没有==这个运算符</td></tr><tr><td>BETWEEN…AND…</td><td>在一个范围之内，如：between 100 and 200 相当于条件在 100 到 200 之间，包头又包尾</td></tr><tr><td>IN(集合)</td><td>集合表示多个值，使用逗号分隔</td></tr><tr><td>LIKE ‘张%’ 或 LIKE ‘张_’</td><td>模糊查询。%指多个占位符，_指单个占位符</td></tr><tr><td>IS NULL 或 IS NOT NULL</td><td>查询某一列为 NULL 的值，注：不能写=NULL</td></tr><tr><td>AND 或 &amp;&amp;</td><td>与，SQL 中建议使用前者，后者并不通用。</td></tr><tr><td>OR 或 ||</td><td>或</td></tr><tr><td>NOT 或 !</td><td>非</td></tr></tbody></table><p>代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询年龄大于等于20岁的</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age&gt;=<span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄等于22岁的</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age=<span class="number">22</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄不等于22岁的</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age!=<span class="number">22</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age&lt;&gt;<span class="number">22</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄大于等于18岁，小于等于22岁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age&gt;=<span class="number">18</span> <span class="keyword">AND</span> age&lt;=<span class="number">22</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age&gt;=<span class="number">18</span> &amp;&amp; age&lt;=<span class="number">22</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,age <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">18</span> <span class="keyword">AND</span> <span class="number">22</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有22岁，18岁，性别为女的人</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age=<span class="number">22</span> <span class="keyword">OR</span> age=<span class="number">18</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> age <span class="keyword">IN</span> (<span class="number">22</span>,<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询等级不为NULL的人</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> grade <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询姓水的人</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> <span class="keyword">NAME</span> <span class="keyword">LIKE</span> <span class="string">'水%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询姓名中含有水字的人</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">WHERE</span> <span class="keyword">NAME</span> <span class="keyword">LIKE</span> <span class="string">'%水%'</span>;</span><br></pre></td></tr></table></figure><h3 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h3><p>语法：order by 排序字段1 排序方式1,….;</p><p>排序方式：</p><ol><li>ASC：升序排。默认值</li><li>DESC：降序排。</li></ol><p>注意：</p><ol><li>如果有多个排序条件，则当前面的值一样时，才会去判断第二条件</li></ol><p>代码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按age升序排</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">ORDER</span> <span class="keyword">BY</span> age;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按age降序排</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按照年龄排序，如果年龄一样，则按照等级排序</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">ASC</span>,grade <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>将一列数据作为一个整体，进行纵向计算。</p><ol><li>count：计算个数<br>一般选择非空的列：主键<br>可以通过count(*)，但实际开发中，少用这个</li><li>max：计算最大值</li><li>min：计算最小值</li><li>sum：计算和</li><li>avg：计算平均值</li></ol><p>注意：聚合函数的计算，排除NULL值</p><p>解决方案：</p><ol><li>选择不包含非空的列进行计算</li><li>IFNULL(grade,0)</li></ol><p>代码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 显示总数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">NAME</span>) <span class="keyword">FROM</span> fairy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果grade为NULL的时候，聚合函数就不会统计，可以这样处理</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">IFNULL</span>(grade,<span class="number">0</span>)) <span class="keyword">FROM</span> fairy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取最大值与最小值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(age) <span class="keyword">FROM</span> fairy;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(age) <span class="keyword">FROM</span> fairy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取等级之和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(grade) <span class="keyword">FROM</span> fairy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取平均等级</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(grade) <span class="keyword">FROM</span> fairy;</span><br></pre></td></tr></table></figure><h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3><p>语法：group by 分组字段；</p><p>注意：</p><ol><li>分组之后查询的字段：分组字段或者聚合函数；</li><li>where和having的区别？<ul><li>where在分组之前进行限定，如果不满足条件，则不参与分组；having在分组之后进行限定，如果不满足条件，不会被查询出来</li><li>where后跟不可跟聚合函数；having可以进行聚合函数的判断</li></ul></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按照性别分组，求总人数，并且求不同组的平均等级</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  gender,</span><br><span class="line">  <span class="keyword">AVG</span>(grade) <span class="string">'平均等级'</span>,</span><br><span class="line">  <span class="keyword">COUNT</span>(<span class="keyword">NAME</span>) <span class="string">'人数'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  fairy </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> gender ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按照性别分组，求总人数，并且求不同组的平均等级。</span></span><br><span class="line"><span class="comment">-- 要求：等级低于44的，不参与分组</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  gender,</span><br><span class="line">  <span class="keyword">AVG</span>(grade) <span class="string">'平均等级'</span>,</span><br><span class="line">  <span class="keyword">COUNT</span>(<span class="keyword">NAME</span>) <span class="string">'人数'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  fairy </span><br><span class="line"><span class="keyword">WHERE</span> grade &gt;= <span class="number">44</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> gender ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按照性别分组，求总人数，并且求不同组的平均等级。</span></span><br><span class="line"><span class="comment">-- 要求：等级低于44的，不参与分组。分组之后，人数要大于2人</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  gender,</span><br><span class="line">  <span class="keyword">AVG</span>(grade) <span class="string">'平均等级'</span>,</span><br><span class="line">  <span class="keyword">COUNT</span>(<span class="keyword">NAME</span>) <span class="string">'人数'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  fairy </span><br><span class="line"><span class="keyword">WHERE</span> grade &gt;= <span class="number">44</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> gender </span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="keyword">NAME</span>) &gt; <span class="number">2</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  gender,</span><br><span class="line">  <span class="keyword">AVG</span>(grade) <span class="string">'平均等级'</span>,</span><br><span class="line">  <span class="keyword">COUNT</span>(<span class="keyword">NAME</span>) <span class="string">'人数'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  fairy </span><br><span class="line"><span class="keyword">WHERE</span> grade &gt;= <span class="number">44</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> gender </span><br><span class="line"><span class="keyword">HAVING</span> 人数 &gt; <span class="number">2</span> ;</span><br></pre></td></tr></table></figure><h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p>语法：limit 开始的索引，每页查询的条数;</p><p>公式：开始的索引=(当前的页码-1)x每页显示的条数</p><p>注意：limit是MySQL的一个“方言”。不同的数据库分页操作是不同的</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 从第1条数据开始，显示3条</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从第4条数据开始，显示3条</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fairy <span class="keyword">LIMIT</span> <span class="number">3</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure><h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><p>笛卡尔积：A、B两个集合，取这两个集合的所有组成情况。要完成多表查询，要消除无用的数据。</p><h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><p>使用内连接的要求：</p><ol><li>从哪些表中查询数据</li><li>条件是啥</li><li>查询哪些字段</li></ol><p><strong>隐式内连接</strong></p><p>语法：<em>select 字段列表 from 表名列表 where …;</em></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询两张表所有数据</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber,</span><br><span class="line">  position1 </span><br><span class="line"><span class="keyword">WHERE</span> memeber.<span class="string">`p_id`</span> = position1.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询第一张表的name,grade和第二张表的school,position</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="keyword">NAME</span>,</span><br><span class="line">  grade,</span><br><span class="line">  school,</span><br><span class="line">  <span class="keyword">POSITION</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber,</span><br><span class="line">  position1 </span><br><span class="line"><span class="keyword">WHERE</span> memeber.<span class="string">`p_id`</span> = position1.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用表的别名进行优化，先将表命名为别名，再来写select后的别名.xx</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.<span class="string">`name`</span>,</span><br><span class="line">  t1.<span class="string">`grade`</span>,</span><br><span class="line">  t2.<span class="string">`school`</span>,</span><br><span class="line">  t2.<span class="string">`position`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber t1,</span><br><span class="line">  position1 t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`p_id`</span> = t2.<span class="string">`id`</span> ;</span><br></pre></td></tr></table></figure><p><strong>显式内连接</strong></p><p>语法：<em>select 字段列表 from 表1 [inner] join 表2 on 条件;</em></p><blockquote><p>[]这个符号表示可以省略的意思</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询两张表所有数据</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber </span><br><span class="line">  <span class="keyword">JOIN</span> position1 </span><br><span class="line">    <span class="keyword">ON</span> memeber.<span class="string">`p_id`</span> = position1.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询第一张表的name,grade和第二张表的school,position</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="keyword">NAME</span>,</span><br><span class="line">  grade,</span><br><span class="line">  school,</span><br><span class="line">  <span class="keyword">POSITION</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber </span><br><span class="line">  <span class="keyword">JOIN</span> position1 </span><br><span class="line">    <span class="keyword">ON</span> memeber.<span class="string">`p_id`</span> = position1.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用表的别名进行优化。注意写法，先将表命名为别名，再来写select后的别名.xx</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.name,</span><br><span class="line">  t1.<span class="string">`grade`</span>,</span><br><span class="line">  t2.<span class="string">`school`</span>,</span><br><span class="line">  t2.<span class="string">`position`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber t1 </span><br><span class="line">  <span class="keyword">JOIN</span> position1 t2 </span><br><span class="line">    <span class="keyword">ON</span> t1.<span class="string">`p_id`</span> = t2.<span class="string">`id`</span> ;</span><br></pre></td></tr></table></figure><h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p><strong>左外连接</strong></p><p>语法：<em>select 字段列表 from 表1 left [outer] join 表2 on 条件;</em></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有人信息，如果有位置，则查询位置信息；如果没有位置，则不显示</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.*,</span><br><span class="line">  t2.school </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber t1,</span><br><span class="line">  position1 t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`p_id`</span> = t2.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时，如果有数据的外键是空的，就不会查出来了</span></span><br><span class="line"><span class="comment">-- 为解决这个问题，我们需要用到外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.*,</span><br><span class="line">  t2.school </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber t1 </span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> position1 t2 </span><br><span class="line">    <span class="keyword">ON</span> t1.<span class="string">`p_id`</span> = t2.<span class="string">`id`</span> ;</span><br></pre></td></tr></table></figure><blockquote><p>左外连接：</p><p>查询的是左边表的所有数据，以及连接表的交集部分</p></blockquote><p><strong>右外连接</strong></p><p>语法：<em>select 字段列表 from 表1 right [outer] join 表2 on 条件;</em></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 右外连接，跟上面左外连接的结果一样，写法的区别就是表的顺序，左换右，右换左了</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.*,</span><br><span class="line">  t2.school </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  position1 t2 </span><br><span class="line">  <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> memeber t1 </span><br><span class="line">    <span class="keyword">ON</span> t1.<span class="string">`p_id`</span> = t2.<span class="string">`id`</span> ;</span><br></pre></td></tr></table></figure><blockquote><p>右外连接：</p><p>查询的是右边表的所有数据，以及连接表的交集部分</p></blockquote><h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>概念：查询中嵌套查询，称嵌套的这个查询，为子查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询等级最高的人</span></span><br><span class="line"><span class="comment">-- 1.查询最高等级</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="keyword">MAX</span>(grade) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.查询等级等于最高的人</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber </span><br><span class="line"><span class="keyword">WHERE</span> grade = <span class="number">54</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber </span><br><span class="line"><span class="keyword">WHERE</span> grade = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">MAX</span>(grade) </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    memeber) ;</span><br></pre></td></tr></table></figure><p>子查询的不同情况</p><ol><li>子查询的结果是单行单列的<br>子查询可以作为条件，使用运算符去判断。&gt;,&gt;=, &lt;, &lt;=, =</li><li>子查询的结果是多行单列的<br>子查询可以作为条件，使用运算符in来判断</li><li>子查询的结果是多行多列的<br>子查询可以作为一张虚拟表参与查询</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 子查询结果是单行单列的</span></span><br><span class="line"><span class="comment">-- 查询等级最高的人</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber </span><br><span class="line"><span class="keyword">WHERE</span> grade = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">MAX</span>(grade) </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    memeber) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 子查询结果是多行单列的</span></span><br><span class="line"><span class="comment">-- 查询武魂殿和天斗帝国的所有成员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber </span><br><span class="line"><span class="keyword">WHERE</span> p_id <span class="keyword">IN</span> </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">id</span> </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    position1 </span><br><span class="line">  <span class="keyword">WHERE</span> <span class="keyword">POSITION</span>= <span class="string">"武魂殿"</span> </span><br><span class="line">    <span class="keyword">OR</span> <span class="keyword">POSITION</span>= <span class="string">"天斗帝国"</span>) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 子查询结果是多行多列的</span></span><br><span class="line"><span class="comment">-- 查询成员年龄为18以上的成员信息跟位置信息</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  position1 t1,</span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    * </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    memeber </span><br><span class="line">  <span class="keyword">WHERE</span> age &gt; <span class="number">18</span>) t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`id`</span> = t2.p_id ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以使用普通内连接，会更好理解</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  memeber t1,</span><br><span class="line">  position1 t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`p_id`</span> = t2.<span class="string">`id`</span> </span><br><span class="line">  <span class="keyword">AND</span> t1.<span class="string">`age`</span> &gt; <span class="number">18</span> ;</span><br></pre></td></tr></table></figure><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>数据库的架构如图</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/13.png" title="架构"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：</span></span><br><span class="line"><span class="comment">-- 1.查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.id,</span><br><span class="line">  ename,</span><br><span class="line">  salary,</span><br><span class="line">  jname,</span><br><span class="line">  description </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp t1,</span><br><span class="line">  job t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`job_id`</span> = t2.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.id,</span><br><span class="line">  ename,</span><br><span class="line">  salary,</span><br><span class="line">  jname,</span><br><span class="line">  description,</span><br><span class="line">  dname,</span><br><span class="line">  loc </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp t1,</span><br><span class="line">  job t2,</span><br><span class="line">  dept t3 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`job_id`</span> = t2.<span class="string">`id`</span> </span><br><span class="line">  <span class="keyword">AND</span> t1.<span class="string">`dept_id`</span> = t3.<span class="string">`id`</span> ;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 3.查询员工姓名，工资，工资等级</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.<span class="string">`ename`</span>,</span><br><span class="line">  t1.<span class="string">`salary`</span>,</span><br><span class="line">  t2.<span class="string">`grade`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp t1,</span><br><span class="line">  salarygrade t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`salary`</span> <span class="keyword">BETWEEN</span> t2.<span class="string">`losalary`</span> </span><br><span class="line">  <span class="keyword">AND</span> t2.<span class="string">`hisalary`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4.查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.<span class="string">`ename`</span>,</span><br><span class="line">  t1.<span class="string">`salary`</span>,</span><br><span class="line">  t2.<span class="string">`jname`</span>,</span><br><span class="line">  t2.<span class="string">`description`</span>,</span><br><span class="line">  t3.<span class="string">`dname`</span>,</span><br><span class="line">  t3.<span class="string">`loc`</span>,</span><br><span class="line">  t4.<span class="string">`grade`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp t1,</span><br><span class="line">  job t2,</span><br><span class="line">  dept t3,</span><br><span class="line">  salarygrade t4 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`dept_id`</span> = t3.<span class="string">`id`</span> </span><br><span class="line">  <span class="keyword">AND</span> t2.<span class="string">`id`</span> = t1.<span class="string">`job_id`</span> </span><br><span class="line">  <span class="keyword">AND</span> t1.<span class="string">`salary`</span> <span class="keyword">BETWEEN</span> t4.<span class="string">`losalary`</span> </span><br><span class="line">  <span class="keyword">AND</span> t4.<span class="string">`hisalary`</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5.查询出部门编号、部门名称、部门位置、部门人数</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.<span class="string">`id`</span>,</span><br><span class="line">  t1.<span class="string">`dname`</span>,</span><br><span class="line">  t1.<span class="string">`loc`</span>,</span><br><span class="line">  t2.<span class="string">`总人数`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  dept t1,</span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    dept_id,</span><br><span class="line">    <span class="keyword">COUNT</span>(<span class="keyword">id</span>) 总人数 </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    emp </span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> emp.<span class="string">`dept_id`</span>) t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.<span class="string">`id`</span> = t2.dept_id ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6.查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  t1.<span class="string">`id`</span>,</span><br><span class="line">  t1.<span class="string">`ename`</span>,</span><br><span class="line">  t2.ename </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp t1 </span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> </span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">      <span class="keyword">id</span>,ename </span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">      emp) t2 </span><br><span class="line">    <span class="keyword">ON</span> t1.<span class="string">`mgr`</span> = t2.id ;</span><br></pre></td></tr></table></figure><h2 id="4-4-DCL：管理用户与权限"><a href="#4-4-DCL：管理用户与权限" class="headerlink" title="4.4 DCL：管理用户与权限"></a>4.4 DCL：管理用户与权限</h2><h3 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h3><p>查询用户</p><p>SELECT * FROM USER;<br>注意：通配符%表示可以在任意主机使用用户登录</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/14.png" title="通配符"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询用户</span></span><br><span class="line"><span class="comment">-- 1.切换到MySQL数据库</span></span><br><span class="line"><span class="keyword">USE</span> mysql;</span><br><span class="line"><span class="comment">-- 2.查询user表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USER</span>;</span><br><span class="line"><span class="comment">-- 通配符%表示可以在任意主机使用用户登录</span></span><br></pre></td></tr></table></figure><p>添加用户</p><p>create user ‘用户名‘@’主机名’ identified by ‘密码’;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建用户</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'密码'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br></pre></td></tr></table></figure><p>删除用户</p><p>DROP USER ‘用户名‘@’主机名’;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure><p>修改用户密码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改密码</span></span><br><span class="line"><span class="comment">-- mysql5.7版本</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">USER</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="keyword">PASSWORD</span>(<span class="string">'新密码'</span>) <span class="keyword">WHERE</span> <span class="keyword">USER</span>=<span class="string">'用户名'</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span> =<span class="string">'123456'</span>;</span><br><span class="line"><span class="comment">-- mysql8.0+版本</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'密码'</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'654321'</span>;</span><br><span class="line"><span class="comment">-- DCL特有的方式，高低版本都支持</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span>=<span class="string">'密码'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL忘记了root用户的密码,管理员方式打开cmd</span></span><br><span class="line"><span class="comment">-- 1.停止mysql服务</span></span><br><span class="line">net <span class="keyword">STOP</span> mysql</span><br><span class="line"><span class="comment">-- 2.使用无验证方式启动mysql服务</span></span><br><span class="line">mysqld <span class="comment">--skip-GRANT-TABLES;</span></span><br><span class="line"><span class="comment">-- 3.另开一个窗口登录mysql,直接输入mysql即可</span></span><br><span class="line">mysql</span><br><span class="line"><span class="comment">-- 4.修改密码后，关闭所有命令窗口，并去任务管理器里面关闭mysqld.exe</span></span><br><span class="line"><span class="comment">-- 5.启动mysql服务</span></span><br><span class="line">net <span class="keyword">START</span> mysql</span><br></pre></td></tr></table></figure><h3 id="管理权限"><a href="#管理权限" class="headerlink" title="管理权限"></a>管理权限</h3><p>查询权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询权限</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="string">'root'</span>@<span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure><p>授予权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 授予权限</span></span><br><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库名.表名 <span class="keyword">TO</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">UPDATE</span>,<span class="keyword">DELETE</span> <span class="keyword">ON</span> * <span class="keyword">TO</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span>;</span><br><span class="line"><span class="comment">-- 授予所有权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure><p>撤销权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 撤销权限</span></span><br><span class="line"><span class="keyword">revoke</span> 权限列表 <span class="keyword">on</span> 数据库名.表名 <span class="keyword">from</span> <span class="string">'用户名'</span>@<span class="string">'主机名'</span>;</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">from</span> <span class="string">'huliena'</span>@<span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure><p>刷新权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 刷新权限</span></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure><h2 id="4-5-约束"><a href="#4-5-约束" class="headerlink" title="4.5 约束"></a>4.5 约束</h2><p>概念：对表中的数据进行限定，从而保证数据的正确性、有效性和完整性</p><p>约束：</p><ol><li>主键约束：primary key</li><li>非空约束：not null</li><li>唯一约束：unique</li><li>外键约束：foreign key</li></ol><h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><p>NOT NULL，值不能为NULL</p><ol><li>创建表时，添加非空约束</li><li>已创建表，添加非空约束</li><li>删除非空约束</li></ol><p>代码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时添加非空约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hero (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">desc hero;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除name的非空约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hero <span class="keyword">modify</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 已经创建表后，添加约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hero <span class="keyword">modify</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><p>UNIQUE，值不能重复(但是允许存在多个NULL)</p><ol><li>创建表时，添加唯一约束</li><li>已创建表，添加唯一约束</li><li>删除唯一约束</li></ol><p>代码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加唯一约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hero (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">phone_number <span class="built_in">VARCHAR</span>(<span class="number">11</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 注意mysql中，唯一约束限定的列的值可以有多个NULL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除唯一约束，index索引，唯一约束也叫做唯一索引</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hero <span class="keyword">DROP</span> <span class="keyword">INDEX</span> phone_number;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在创建表之后，添加唯一约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hero <span class="keyword">MODIFY</span> phone_number <span class="built_in">VARCHAR</span>(<span class="number">11</span>) <span class="keyword">UNIQUE</span>;</span><br><span class="line"></span><br><span class="line">DESC hero;</span><br></pre></td></tr></table></figure><h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><p>含义：表示非空且唯一</p><p>一张表只能有一个字段表示主键。主键就是表中记录的唯一标识。</p><p>主键约束：</p><ol><li>创建表时，添加主键约束</li><li>已创建表，添加主键约束</li><li>删除主键约束</li></ol><p>代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加主键约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hero(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hero <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 已创建表，添加主键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hero <span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"></span><br><span class="line">DESC hero;</span><br></pre></td></tr></table></figure><h3 id="自动增长"><a href="#自动增长" class="headerlink" title="自动增长"></a>自动增长</h3><p>概念：如果某一列是数值类型的，使用auto_increment 可以完成自动增长</p><p>自动增长：</p><ol><li>创建表时，添加主键约束，并完成自动增长</li><li>已创建表，添加自动增长</li><li>删除自动增长</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加自动增长</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hero(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除自动增长</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hero <span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 已创建表，添加自动增长</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hero <span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT;</span><br><span class="line"></span><br><span class="line">DESC hero;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><p>自动增长是根据上一条数据的大小来增加的。比防说上一条是9，如果不传值，下一条就会是10</p></blockquote><h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>一张表的数据，会过于冗余，我们可以将其进行拆分，然后再将两张表，通过外键关联起来。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/4.png" title="外键"><p>外键约束：</p><ol><li><p>创建表时，添加外键约束</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">    ....</span><br><span class="line">    外键列</span><br><span class="line">    <span class="keyword">constraint</span> 外键名称 <span class="keyword">foreign</span> <span class="keyword">key</span> (外键列名称) <span class="keyword">references</span> 主表名称(主表列名称)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>已创建表，添加外键约束</p></li><li><p>删除外键约束</p></li><li><p>级联操作(级联更新和级联删除)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加级联操作</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> <span class="keyword">constraint</span> 外键名称 <span class="keyword">foreign</span> <span class="keyword">key</span> (外键列名称) referencs 主表名称(主表列名称) <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">cascade</span> <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--也可以只添加其中某一个，也可以都添加，</span></span><br><span class="line"><span class="comment">--实现的功能，就是在删除外键表的内容的时候，主键表与其相关的内容也会一起被删掉</span></span><br></pre></td></tr></table></figure></li></ol><p>代码：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加外键约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> memeber1 (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  gender <span class="built_in">VARCHAR</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  age <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  grade <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  p_id <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> m_p_fk <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (p_id) <span class="keyword">REFERENCES</span> position1(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 已创建表，添加外键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> memeber1 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> m_p_fk <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (p_id) <span class="keyword">REFERENCES</span> position1(<span class="keyword">id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> memeber1 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> m_p_fk;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加级联更新和级联删除</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> memeber <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> m_p_fk <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (p_id) <span class="keyword">REFERENCES</span> position1(<span class="keyword">id</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span> <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span>;</span><br></pre></td></tr></table></figure><h1 id="五、数据库的设计"><a href="#五、数据库的设计" class="headerlink" title="五、数据库的设计"></a>五、数据库的设计</h1><h2 id="5-1-多表之间的关系"><a href="#5-1-多表之间的关系" class="headerlink" title="5.1 多表之间的关系"></a>5.1 多表之间的关系</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul><li>一对一关系：如人和身份证号。一个人只有一个身份证号，一个身份证号对应一个人。开发中很少使用</li><li>一对多（多对一）关系：如部门和员工。一个部门对应多个员工，一个员工对应一个部门。</li><li>多对多关系： 如学生跟课程。一个课程对应多个学生，一个学生对应多个课程。</li></ul><p>这三种关系可以表示所有的事务之间的关系。</p><p>实现关系</p><ul><li>一对一（一般情况合成一张表）<br>一对一关系实现，可以在任意一方添加唯一外键指向另一方的主键。</li><li>一对多（多对一）<br>在多的一方建立外键，指向一的一方的主键。</li><li>多对多<br>多对多关系实现需要借助第三张中间表。中间表至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表的主键</li></ul><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/5.png" title="数据库设计"><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/6.png" title="案例"><p>代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建旅游线路分类表 tab_category</span></span><br><span class="line"><span class="comment">-- cid 旅游线路分类主键，自动增长</span></span><br><span class="line"><span class="comment">-- cname 旅游线路分类名称非空，唯一，字符串 100</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_category (</span><br><span class="line">    cid <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    cname <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建旅游线路表 tab_route</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">rid 旅游线路主键，自动增长</span></span><br><span class="line"><span class="comment">rname 旅游线路名称非空，唯一，字符串 100</span></span><br><span class="line"><span class="comment">price 价格</span></span><br><span class="line"><span class="comment">rdate 上架时间，日期类型</span></span><br><span class="line"><span class="comment">cid 外键，所属分类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_route(</span><br><span class="line">    rid <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    rname <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    price <span class="keyword">DOUBLE</span>,</span><br><span class="line">    rdate <span class="built_in">DATE</span>,</span><br><span class="line">    cid <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (cid) <span class="keyword">REFERENCES</span> tab_category(cid)</span><br><span class="line">);</span><br><span class="line"><span class="comment">/*创建用户表 tab_user</span></span><br><span class="line"><span class="comment">uid 用户主键，自增长</span></span><br><span class="line"><span class="comment">username 用户名长度 100，唯一，非空</span></span><br><span class="line"><span class="comment">password 密码长度 30，非空</span></span><br><span class="line"><span class="comment">name 真实姓名长度 100</span></span><br><span class="line"><span class="comment">birthday 生日</span></span><br><span class="line"><span class="comment">sex 性别，定长字符串 1</span></span><br><span class="line"><span class="comment">telephone 手机号，字符串 11</span></span><br><span class="line"><span class="comment">email 邮箱，字符串长度 100</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_user (</span><br><span class="line">    uid <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">PASSWORD</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    birthday <span class="built_in">DATE</span>,</span><br><span class="line">    sex <span class="built_in">CHAR</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">'男'</span>,</span><br><span class="line">    telephone <span class="built_in">VARCHAR</span>(<span class="number">11</span>),</span><br><span class="line">    email <span class="built_in">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">创建收藏表 tab_favorite</span></span><br><span class="line"><span class="comment">rid 旅游线路 id，外键</span></span><br><span class="line"><span class="comment">date 收藏时间</span></span><br><span class="line"><span class="comment">uid 用户 id，外键</span></span><br><span class="line"><span class="comment">rid 和 uid 不能重复，设置复合主键，同一个用户不能收藏同一个线路两次</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_favorite (</span><br><span class="line">    rid <span class="built_in">INT</span>, <span class="comment">-- 线路id</span></span><br><span class="line">    <span class="built_in">DATE</span> DATETIME,</span><br><span class="line">    uid <span class="built_in">INT</span>, <span class="comment">-- 用户id</span></span><br><span class="line">    <span class="comment">-- 创建复合主键</span></span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(rid,uid), <span class="comment">-- 联合主键</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (rid) <span class="keyword">REFERENCES</span> tab_route(rid),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(uid) <span class="keyword">REFERENCES</span> tab_user(uid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>打开架构设计器，就会自动生成如下关系图</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/7.png" title="架构设计"><h2 id="5-2-数据库设计的范式"><a href="#5-2-数据库设计的范式" class="headerlink" title="5.2 数据库设计的范式"></a>5.2 数据库设计的范式</h2><p>概念：设计数据库时，需要遵循的一些规范。要遵循后边的范式要求，必须要遵循前边所有的范式要求</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/8.png" title="范式的概念"><p>分类：</p><ul><li>第一范式</li><li>第二范式</li><li>第三范式</li><li>其他范式</li></ul><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/9.png" title="范式分类"><h3 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h3><p><strong>第一范式理解：每一列都是不可分割的原子数据项。</strong></p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/10.png" title="第一范式"><p>像这样的一张表，就满足第一范式了，但是也存在问题</p><ol><li>存在非常严重的数据冗余（重复）：姓名、系名、系主任</li><li>数据添加存在问题：添加新开设的系和系主任时，数据不合法</li><li>数据删除存在问题：如果有人毕业了，删除信息时，会将系一起删掉。</li></ol><h3 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h3><p><strong>第二范式理解：在1NF的基础上，非码属性必须完全依赖于码（在1NF基础上消除非主属性对主码的部分函数依赖）</strong></p><p><strong>函数依赖</strong>：A–&gt;B，如果A属性（属性组）的值，可以唯一确定B属性的值。则成B依赖于A。例如，学号–&gt;姓名；（学号，课程名称）–&gt;分数</p><p><strong>完全函数依赖：</strong>A–&gt;B，如果A是一个属性组，则B属性值的确定需要依赖于A属性组中的所有的属性值。例如，（学号，课程名称）–&gt;分数</p><p><strong>部分函数依赖：</strong>A–&gt;B，如果A是一个属性组，则B属性值的确定只需要依赖于A属性组中的某一些值即可。例如，（学号，课程名称）–&gt;姓名</p><p><strong>传递函数依赖：</strong>A–&gt;B，B–&gt;C，如果通过A属性（属性组）的值，可以确定唯一B属性的值，再通过B属性（属性组）的值可以确定唯一C属性的值，则称C传递函数依赖于A。例如，学号–&gt;系名，系名–&gt;系主任</p><p><strong>码：</strong>如果在一张表中，一个属性或者属性组，被其他所有属性所依赖，则称这个属性（属性组）为该表的码。例如，在上表中的码，就是（学号，课程名称）。</p><ul><li>主属性：码属性组中的所有属性</li><li>非主属性：除码属性组的属性</li></ul><p>详细了解，请移步<a href="https://blog.csdn.net/sumaliqinghua/article/details/85872446" target="_blank" rel="noopener">这里</a></p><p>现在根据第二范式的理解，在1NF基础上基础上消除非主属性对主码的<strong>部分函数依赖</strong>。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/11.png" title="第二范式"><h3 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h3><p>第三范式理解：在2NF基础上，任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/12.png" title="第三范式"><h3 id="其他范式"><a href="#其他范式" class="headerlink" title="其他范式"></a>其他范式</h3><p>巴德斯科范式(BCNF)、第四范式(4NF)和第五范式(5NF)</p><h1 id="六、数据库的备份与还原"><a href="#六、数据库的备份与还原" class="headerlink" title="六、数据库的备份与还原"></a>六、数据库的备份与还原</h1><p>数据库的备份和还原目的：防止出现问题，导致数据丢失的情况。</p><h2 id="6-1-命令行"><a href="#6-1-命令行" class="headerlink" title="6.1 命令行"></a>6.1 命令行</h2><p>备份语法：mysqldmp -u用户名 -p密码 数据库名称 &gt; 保存的路径</p><p>还原语法：</p><ol><li>登录数据库</li><li>创建数据库</li><li>使用数据库</li><li>执行文件：source 文件路径</li></ol><h2 id="6-2-可视化工具"><a href="#6-2-可视化工具" class="headerlink" title="6.2 可视化工具"></a>6.2 可视化工具</h2><p>不同的可视化工具，具体操作不同，不多赘述</p><h1 id="七、事务"><a href="#七、事务" class="headerlink" title="七、事务"></a>七、事务</h1><h2 id="7-1-事务的了解"><a href="#7-1-事务的了解" class="headerlink" title="7.1 事务的了解"></a>7.1 事务的了解</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败。</p><p>举个例子，支付宝转钱。A给B转5块钱，成功的话，A账户金额-5，B账户金额+5。如果在A账户减少金额，或者在B账户增加金额的过程中出错，则所有事件回滚。</p><h3 id="事务的操作"><a href="#事务的操作" class="headerlink" title="事务的操作"></a>事务的操作</h3><p>具体操作</p><ol><li>开启事务</li><li>回滚</li><li>提交</li></ol><p>开启事务：start transaction;</p><p>回滚：rollback;</p><p>提交：commit;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- zs给ls转账500</span></span><br><span class="line"><span class="comment">-- 0 开启事务</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1 zs账户-500</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance=balance<span class="number">-500</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'zs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1.5 模拟中间异常</span></span><br><span class="line"><span class="comment">-- 我来打断，嘿咻嘿咻！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2 ls账户+500</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance=balance+<span class="number">500</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'ls'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.5 模拟中间状态，此时可以通过查询看看中间结果</span></span><br><span class="line"><span class="comment">-- select * from account;</span></span><br><span class="line"><span class="comment">-- 会发现数据已经变了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3 发现执行没有问题，提交事务，执行成功</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3 有问题的话，就回滚事务，执行失败</span></span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><p>事务提交的两种方式：</p><ol><li>自动提交<br>MySQL就是自动提交的，然而Oracle默认是手动提交的。<br>一条DML（增删改）语句会自动提交一次事务。</li><li>手动提交<br>需要先开启事务，再提交</li></ol><p>修改事务的默认提交方式：</p><ol><li>查看事务的默认提交方式：SELECT @@autocommit; – 1代表自动提交 0代表手动提交</li><li>修改默认提交方式：set @@autocommit=0;</li></ol><h2 id="7-2-事务的四大特征"><a href="#7-2-事务的四大特征" class="headerlink" title="7.2 事务的四大特征"></a>7.2 事务的四大特征</h2><p>特征：</p><ol><li><strong>原子性：</strong>是不可分割的最小操作单位，要么同时成功，要么同时失败。</li><li><strong>持久性：</strong>当事务提交或者回滚后，数据库会持久化地保存数据。</li><li><strong>隔离性：</strong>多个事务之间，相互独立。但是，真实的情况下，事务之间是相互影响的，所以，我们要了解事务的隔离级别</li><li><strong>一致性：</strong>事务操作前后，数据总量不变。</li></ol><h2 id="7-3-事务的隔离级别"><a href="#7-3-事务的隔离级别" class="headerlink" title="7.3 事务的隔离级别"></a>7.3 事务的隔离级别</h2><p>概念：多个事务之间是隔离的，即相互独立的。但是，如果多个事务，操作同一批数据，则会引发一些问题，设置不同的隔离级别，就可以解决这些问题。</p><p>存在问题：</p><ol><li>脏读：一个事务，读取到另一个事务中没有提交的数据。</li><li>不可重复读（虚读）：在同一个事务中，两次读取到的事务不一样。</li><li>幻读：一个事务操作（DML）数据表中所有记录，A事务添加了一条数据，B事务查询不到修改。</li></ol><p><a href="https://blog.csdn.net/starlh35/article/details/76445267" target="_blank" rel="noopener">数据库并发事务存在的问题</a></p><p>隔离级别：</p><ol><li>read uncommited<br>含义：读未提交<br>产生的问题：脏读、不可重复读、幻读</li><li>read commited（Oracle中默认隔离级别）<br>含义：读已提交<br>产生的问题：不可重复读、幻读</li><li>repeatable read（MySQL中默认隔离级别）<br>含义：可重复读<br>产生问题：幻读</li><li>serializable<br>含义：串行化（相当于把表锁上，A事物不提交，B事物是没法查询得到的）<br>可以解决任何问题</li></ol><blockquote><p>注意：</p><p>隔离级别从小到大，安全性越来越高，但是效率越来越低。我们要选择合适级别，既保证相对比较安全，又能保证效率较高</p></blockquote><p>修改数据库的默认隔离级别：</p><ol><li>查询隔离级别：<br>mysql5.6-5.7：select @@tx_isolation;<br>mysql8.0+：select @@transaction_isolation;</li><li>设置隔离级别：set global transaction isolation level 级别字符串;</li></ol><p><a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html" target="_blank" rel="noopener">MySQL8.0+系统变量文档</a></p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html" target="_blank" rel="noopener">MySQL5.6系统变量文档</a></p><blockquote><p>修改隔离级别之后，查询，如果没有改变。需要断开连接，重新连接之后，才会查出来。</p></blockquote><h1 id="八、触发器"><a href="#八、触发器" class="headerlink" title="八、触发器"></a>八、触发器</h1><p>本篇内容是做课程设计时，需要用触发器，由此就来总结一下。<a href="https://www.cnblogs.com/phpper/p/7587031.html" target="_blank" rel="noopener">参考文章</a></p><h2 id="8-1-概念"><a href="#8-1-概念" class="headerlink" title="8.1 概念"></a>8.1 概念</h2><p>定义：触发器是与表有关的数据库对象，在满足定义条件时触发，并执行触发器中定义的语句集合。</p><p>作用：协助应用在数据库端确保数据的完整性。</p><p>举例，比如我现在有两个表，unit和person表，person与unit通过unitid进行外键约束。当创建person就需要在其对应的unit表中更新总人数字段，我们可以通过编写程序语言逻辑来实现，如果通过触发器，会自动更新字段，更容易了。</p><p>触发器的类型</p><ol><li>INSERT型触发器：在执行insert、load data、replace语句时触发</li><li>UPDATE型触发器：在执行update语句时触发</li><li>DELETE型触发器：在执行delete、replace时触发</li></ol><blockquote><p>load data语句是将文件的内容插入到表中，相当于是insert语句</p><p>replace语句在一般的情况下和insert差不多，但是如果表中存在primary或者unique索引的时候，如果插入的数据和原来的primary key或者unique相同的时候，会删除原来的数据，然后再增加一条新的护具。</p><p>可以理解成，replace在没有重复的时候，相当于insert；若有重复，则会删除原来的，再执行insert</p></blockquote><h2 id="8-2-语法"><a href="#8-2-语法" class="headerlink" title="8.2 语法"></a>8.2 语法</h2><p>要素</p><ol><li>触发器名称</li><li>触发时机<ul><li>BEFORE：之前</li><li>AFTER：之后</li></ul></li><li>触发事件<ul><li>INSERT</li><li>UPDATE</li><li>DELETE</li></ul></li><li>表名：需要建立触发器的表名</li><li>执行语句<ul><li>一条SQL语句</li><li>多条SQL语句，通过begin和and包含起来</li></ul></li></ol><h3 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一条执行语句</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名称 触发时机 触发事件 <span class="keyword">ON</span> 表名 <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> 执行语句 </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多条执行语句</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名称 触发时机 触发事件 <span class="keyword">ON</span> 表名 <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	执行语句列表 </span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/17.png"><p>以上图为例，创建触发器，来实现person的数据发生变化时，修改unit表的总人数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> insert_trigger <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> person <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">UPDATE</span> unit <span class="keyword">AS</span> a</span><br><span class="line"><span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">sum</span>, unitid <span class="keyword">FROM</span> person <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitid ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitid = b.unitid </span><br><span class="line"><span class="keyword">SET</span> a.sum = b.sum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> delete_trigger <span class="keyword">AFTER</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> person <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">UPDATE</span> unit <span class="keyword">AS</span> a</span><br><span class="line"><span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">sum</span>, unitid <span class="keyword">FROM</span> person <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitid ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitid = b.unitid </span><br><span class="line"><span class="keyword">SET</span> a.sum = b.sum;</span><br></pre></td></tr></table></figure><p>在执行多条语句的时候，触发器中间的sql语句分支是用<code>;</code>来分割的。如果有多个触发器的话，最后也是需要加一个结束符号。而MySQL默认是以<code>;</code>作为结束执行语句，为避免与触发器的内部分支起冲突，我们可以通过使用<code>DELIMITER $</code>来将结束符号修改为<code>$</code></p><blockquote><p>一般用在命令行的时候会这样，直接使用可视化工具，可以不用写</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> insert_trigger <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> tb003 <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">		<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">sum</span>( basenumber ) <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">		<span class="keyword">SET</span> a.basenumber = b.sum;</span><br><span class="line">	<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">sum</span>( unitmonpaysum ) <span class="keyword">AS</span> <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">	<span class="keyword">SET</span> a.unitpaysum = b.sum;</span><br><span class="line">	<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">sum</span>( permonpaysum ) <span class="keyword">AS</span> <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">	<span class="keyword">SET</span> a.perpaysum = b.sum;</span><br><span class="line">	<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">count</span>( accnum ) <span class="keyword">AS</span> <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">	<span class="keyword">SET</span> a.persnum = b.sum;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> delete_trigger <span class="keyword">AFTER</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> tb003 <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">		<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">sum</span>( basenumber ) <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">		<span class="keyword">SET</span> a.basenumber = b.sum;</span><br><span class="line">	<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">sum</span>( unitmonpaysum ) <span class="keyword">AS</span> <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">	<span class="keyword">SET</span> a.unitpaysum = b.sum;</span><br><span class="line">	<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">sum</span>( permonpaysum ) <span class="keyword">AS</span> <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">	<span class="keyword">SET</span> a.perpaysum = b.sum;</span><br><span class="line">	<span class="keyword">UPDATE</span> tb002 <span class="keyword">AS</span> a</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> unitaccnum, <span class="keyword">count</span>( accnum ) <span class="keyword">AS</span> <span class="keyword">sum</span> <span class="keyword">FROM</span> tb003 <span class="keyword">WHERE</span> peraccstate = <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> unitaccnum ) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.unitaccnum = b.unitaccnum </span><br><span class="line">	<span class="keyword">SET</span> a.persnum = b.sum;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><p>可以通过导出sql文件，来进行查看。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/18.png"><h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除触发器</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> 触发器名称</span><br></pre></td></tr></table></figure><h3 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h3><p>在begin…end中可以自定义变量，但是只能在begin…end中使用</p><p>语法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在begin...and中定义变量</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">	变量名 变量类型 [默认值] </span><br><span class="line">	<span class="keyword">SET</span> 变量名 =值</span><br></pre></td></tr></table></figure><h3 id="New-amp-Old"><a href="#New-amp-Old" class="headerlink" title="New&amp;Old"></a>New&amp;Old</h3><p>NEW和OLD使用</p><ol><li>NEW：表示将要或者已经增加（或修改或删除）的数据，用于INSERT、UPDATE型触发器</li><li>OLD：表示将要或者已经被删除的数据，用于UPDATE、DELETE型触发器</li></ol><p>语法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 新增或修改行的某列数据</span></span><br><span class="line">NEW.列名 </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除或修改行的某列数据</span></span><br><span class="line">OLD.列名</span><br></pre></td></tr></table></figure><h2 id="8-3-案例"><a href="#8-3-案例" class="headerlink" title="8.3 案例"></a>8.3 案例</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>当在users中插入一条数据<code>江厌离</code>，就会在logs中生成一条日志信息<code>江厌离 is created</code>。</p><p>创建users表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`users`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`add_time`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">INDEX</span> <span class="string">`name`</span>(<span class="string">`name`</span>(<span class="number">250</span>)) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_general_ci ROW_FORMAT = Dynamic;</span><br></pre></td></tr></table></figure><p>创建logs表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`logs`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`logs`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`log`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'日志说明'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_general_ci <span class="keyword">COMMENT</span> = <span class="string">'日志表'</span> ROW_FORMAT = Dynamic;</span><br></pre></td></tr></table></figure><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user_log`</span>;</span><br><span class="line">delimiter ;;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="string">`user_log`</span> <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> <span class="string">`users`</span> <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> s1 <span class="built_in">varchar</span>(<span class="number">40</span>);</span><br><span class="line"><span class="keyword">declare</span> s2 <span class="built_in">varchar</span>(<span class="number">40</span>);</span><br><span class="line"><span class="keyword">set</span> s2=<span class="string">' is created'</span>;</span><br><span class="line"><span class="keyword">set</span> s1=<span class="keyword">concat</span>(new.name,s2);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">logs</span>(<span class="keyword">log</span>) <span class="keyword">values</span>(s1);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">;;</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure><blockquote><p>所有的触发器都存在information_schema数据库下的triggers表中</p></blockquote><h1 id="九、存储过程"><a href="#九、存储过程" class="headerlink" title="九、存储过程"></a>九、存储过程</h1><h2 id="9-1-概念"><a href="#9-1-概念" class="headerlink" title="9.1 概念"></a>9.1 概念</h2><p>理论概念，看看就行</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/sql/21.png"><p>存储过程：类似于java代码中的方法，可以直接调用，来实现某些功能逻辑。有参数跟返回值</p><blockquote><p>Navicat中描述的就挺合理，一个函数代替了，哈哈</p><p>本质不就是个可调用的方法嘛</p></blockquote><p>优点：</p><ol><li>代码可复用</li><li>代码精简一致</li><li>可维护性高</li></ol><p>缺点：</p><ol><li>可移植性差</li><li>使用于模块较小的功能：跟代码一样，每个方法功能尽量小，这样既易维护，又方便使用</li></ol><h2 id="9-2-快速入门"><a href="#9-2-快速入门" class="headerlink" title="9.2 快速入门"></a>9.2 快速入门</h2><p>直接上sql语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除存储过程</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> getUsers;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建存储过程</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> getUsers () </span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用存储过程</span></span><br><span class="line"><span class="keyword">CALL</span> getUsers ();</span><br></pre></td></tr></table></figure><p>参数类型</p><ol><li>IN：传递给存储过程</li><li>OUT：从存储过程传出</li><li>INOUT：对存储过程传入和传出</li></ol><p>OUT</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> getGrades;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建触发器，返回三个变量的值</span></span><br><span class="line">DELIMITER ;;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> getGrades(</span><br><span class="line"><span class="keyword">OUT</span> minGrade <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line"><span class="keyword">OUT</span> avgGrade <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line"><span class="keyword">OUT</span> maxGrade <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(grade) <span class="keyword">INTO</span> minGrade <span class="keyword">FROM</span> memeber;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(grade) <span class="keyword">INTO</span> avgGrade <span class="keyword">FROM</span> memeber;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(grade) <span class="keyword">INTO</span> maxGrade <span class="keyword">FROM</span> memeber;</span><br><span class="line"><span class="keyword">END</span> ;;</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用三个变量a,b,c接收值</span></span><br><span class="line"><span class="keyword">CALL</span> getGrades (@a, @b, @c) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询三个变量的值</span></span><br><span class="line"><span class="keyword">SELECT</span> @a,@b,@c</span><br></pre></td></tr></table></figure><blockquote><p>在测试的过程中，发现</p><p>select name into username from memeber;</p><p>和</p><p>select name from memeber into username;</p><p>最后的效果是一样的，所以，这两条语句是等价的</p></blockquote><p>IN</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> <span class="keyword">if</span> <span class="keyword">exists</span> getNameById;</span><br><span class="line"></span><br><span class="line">Delimiter ;;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> getNameById(</span><br><span class="line"><span class="keyword">in</span> userId <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">out</span> userName <span class="built_in">varchar</span>(<span class="number">200</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> memeber <span class="keyword">where</span> <span class="keyword">id</span>=userId <span class="keyword">INTO</span> userName;</span><br><span class="line"><span class="keyword">end</span>;;</span><br><span class="line">Delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 传入id为7，然后用name接收结果</span></span><br><span class="line"><span class="keyword">Call</span> getNameById(<span class="number">7</span>,@<span class="keyword">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询结果</span></span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">name</span>;</span><br></pre></td></tr></table></figure><p>用sqlyog运行的时候，把字符串所占的字节也输出了，我就特意百度了一下，字节为啥有的2两个，有的占3个</p><p>原因是字符集的原因，gbk中，英文占1字节（Byte，简记为B）,汉字占2字节；utf-8，英文占1个字节，汉字占3个字节。可以参考<a href="https://meethigher.top/blog/2020/bytes-of-characters/">这篇文章</a></p></div><div class="post-detail">发布：2020-04-29 13:06:52<br>修改：2020-07-11 12:20:56<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/sql/</span><br>标签：<span><a href="/blog/tags/sql/">sql</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>