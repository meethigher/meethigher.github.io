<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="会话技术,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="再次系统学习一下cookie和session"><title>会话技术</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">会话技术</h2></div><div class="post-content blog-markdown"><p>之前写得一篇<a href="https://meethigher.top/blog/2020/cookie-and-session/">cookie与session区别</a></p><h1 id="一、会话技术"><a href="#一、会话技术" class="headerlink" title="一、会话技术"></a>一、会话技术</h1><p>会话：一次会话中包含多次请求和响应。</p><p>一次会话：浏览器第一次给服务器资源发送请求，会话建立，直到有一方断开为止。</p><p>功能：在一次会话的范围内的多次请求间，共享数据</p><p>方式</p><ol><li>客户端会话技术：cookie</li><li>服务器端会话技术：session</li></ol><p>有关http协议的知识，移步到<a href="https://meethigher.top/blog/2020/servlet/">这里</a></p><h1 id="二、Cookie"><a href="#二、Cookie" class="headerlink" title="二、Cookie"></a>二、Cookie</h1><p>概念：客户端会话技术，将数据保存到客户端</p><h2 id="2-1-快速入门"><a href="#2-1-快速入门" class="headerlink" title="2.1 快速入门"></a>2.1 快速入门</h2><p>快速入门</p><ol><li>创建cookie对象，绑定数据<ul><li>Cookie(String name, String value)</li></ul></li><li>发送cookie<ul><li>response.addCookie(Cookie cookie)</li></ul></li><li>获取cookie，拿到数据<ul><li>Cookie[] request.getCookies()</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo01Cookie"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Cookie</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//创建cookie对象</span></span><br><span class="line">        Cookie cookie=<span class="keyword">new</span> Cookie(<span class="string">"msg"</span>,<span class="string">"hello"</span>);</span><br><span class="line">        <span class="comment">//发送cookie</span></span><br><span class="line">        resp.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这串代码，在访问该网址时，服务器返回一串cookie，”msg=hello”。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/1.png"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo02Cookie"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02Cookie</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取cookie</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="comment">//遍历cookies</span></span><br><span class="line">        <span class="keyword">if</span>(cookies!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Cookie c:cookies)&#123;</span><br><span class="line">                String name=c.getName();</span><br><span class="line">                String value=c.getValue();</span><br><span class="line">                System.out.println(name+<span class="string">"=="</span>+value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这些代码，是将浏览器端请求服务器时携带的cookie打印到控制台。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/2.png"><p>如果想要在浏览器查看cookie的话</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/3.png"><h2 id="2-2-实现原理"><a href="#2-2-实现原理" class="headerlink" title="2.2 实现原理"></a>2.2 实现原理</h2><p>浏览器<strong>初次</strong>请求服务器，服务器响应放回<strong>set-cookie</strong>，浏览器将接收到的<strong>cookie</strong>保存到本地。</p><p>浏览器<strong>二次</strong>请求服务器，请求头中携带<strong>cookie</strong>的值。</p><blockquote><p>就相当于买东西</p><p>Cookie 就像是在超级市场买东西拿到的小票，由超市（Server）发给消费者（Browser），超市方面不用记住每一个消费者的脸，但是他们认识消费者手里的小票（Cookie），可以通过小票知道消费者之前的一些消费信息（在服务端产生的数据）。</p></blockquote><h2 id="2-3-Cookie细节"><a href="#2-3-Cookie细节" class="headerlink" title="2.3 Cookie细节"></a>2.3 Cookie细节</h2><ol><li><p>一次可以发送多个Cookie</p><ul><li>可以创建多个对象，使用response调用多次addCookie方法发送cookie即可</li></ul></li><li><p>Cookie在浏览器中保存时间</p><ul><li>默认情况下，当浏览器关闭后，Cookie数据被销毁</li><li>设置Cookie生命周期：持久化存储<ul><li>setMaxAge(int seconds)<ul><li>正数：将Cookie数据写到硬盘的文件中，持久化存储。正数代表cookie的存活时间。比如30，在30s之后，这个Cookie文件将被删除掉</li><li>负数：默认值，存储在内存中，浏览器关闭，就销毁</li><li>零：删除Cookie信息</li></ul></li></ul></li></ul></li><li><p>Cookie存储中文</p><ul><li>Tomcat8之前，Cookie中不能直接存储中文数据。需要将中文数据转码，即url编码（%E3，即%跟两个十六进制的数字表示一个<strong>字节</strong>，有多少个字节，就会有多少%）</li><li>Tomcat8之后，Cookie支持中文数据，但是特殊字符还是不支持，比方说空格。需要用url编码</li></ul></li><li><p>Cookie共享问题</p><ul><li>默认同一服务器不同项目，是不会共享Cookie的<ul><li>setPath(String path)：设置cookie的获取范围。默认情况下，会去设置当前的虚拟目录</li></ul></li><li>不同服务器实现cookie共享<ul><li>setDomain(String path)：设置一级域名相同，那么多个服务器之间cookie可以共享</li></ul></li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo04Cookie"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04Cookie</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//创建Cookie</span></span><br><span class="line">        Cookie ck1 = <span class="keyword">new</span> Cookie(<span class="string">"msg"</span>, <span class="string">"setMaxAge"</span>);</span><br><span class="line">       <span class="comment">//设置Cookie的存活时间</span></span><br><span class="line"><span class="comment">//        ck1.setMaxAge(100);</span></span><br><span class="line"><span class="comment">//        ck1.setMaxAge(-1);//默认值，会话关闭之后即消失</span></span><br><span class="line">        <span class="comment">//删除当前cookie</span></span><br><span class="line">        <span class="comment">//ck1.setMaxAge(0);</span></span><br><span class="line"></span><br><span class="line">        Cookie ck2 = <span class="keyword">new</span> Cookie(<span class="string">"hh"</span>, <span class="string">"奥利给"</span>);</span><br><span class="line"></span><br><span class="line">        ck2.setPath(<span class="string">"/demo04Cookie"</span>);</span><br><span class="line">        <span class="comment">//发送cookie</span></span><br><span class="line">        response.addCookie(ck1);</span><br><span class="line">        response.addCookie(ck2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/4.png"><h2 id="2-4-Cookie的特点和作用"><a href="#2-4-Cookie的特点和作用" class="headerlink" title="2.4 Cookie的特点和作用"></a>2.4 Cookie的特点和作用</h2><p>特点</p><ol><li>Cookie存储数据在客户端浏览器</li><li>浏览器对于单个Cookie的大小有限制（4KB左右，不同浏览器不同），以及同一个域名下的总Cookie数量也有限制（20个，不同浏览器不同）</li></ol><p>作用</p><ol><li>Cookie一般用于存储少量的、不敏感的数据</li><li>在不登录的情况下，完成服务器对客户端的身份识别（比方说百度在不登录的情况下，存储的一些个性化设置，当然这个也是可以通过本地存储来实现）</li></ol><p><a href="https://blog.csdn.net/digua523/article/details/86286623" target="_blank" rel="noopener">localStorage与Cookie的异同</a></p><h2 id="2-5-案例-记录访问"><a href="#2-5-案例-记录访问" class="headerlink" title="2.5 案例-记录访问"></a>2.5 案例-记录访问</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>记住上一次访问时间</p><p>如果是初次访问，提示你好，欢迎首次访问</p><p>如果是二次访问，提示你好，欢迎回来，上次访问时间：xxx</p><p>分析：判断是否有lastTime该cookie，如果没有，则是初次访问。访问时，服务端将访问时间存储到lastTime的cookie中</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/cookieTest"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//设置响应体的消息体的数据格式以及编码</span></span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置有没有lastTime这个cookie标记</span></span><br><span class="line">        <span class="keyword">boolean</span> flag=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取当前时间</span></span><br><span class="line">        String time = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy年MM月dd日 HH:mm:ss"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="comment">//直接存储time，会出错，因为有个空格。当然删掉是可以的，不过最好的办法是url编码</span></span><br><span class="line">        String time_en = URLEncoder.encode(time, StandardCharsets.UTF_8);</span><br><span class="line">        <span class="comment">//获取cookie</span></span><br><span class="line">        Cookie[] cks = request.getCookies();</span><br><span class="line">        <span class="comment">//二次访问</span></span><br><span class="line">        <span class="keyword">if</span>(cks!=<span class="keyword">null</span>&amp;&amp;cks.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Cookie ck:cks)&#123;</span><br><span class="line">                String name=ck.getName();</span><br><span class="line">               <span class="keyword">if</span>(<span class="string">"lastTime"</span>.equals(name))&#123;</span><br><span class="line">                   flag=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">                   <span class="comment">//响应数据</span></span><br><span class="line">                   String value= URLDecoder.decode(ck.getValue(),<span class="string">"utf-8"</span>);</span><br><span class="line">                   response.getWriter().write(<span class="string">"&lt;h1&gt;欢迎回来，您上次访问时间"</span>+value+<span class="string">"&lt;/h1&gt;"</span>);</span><br><span class="line">                   <span class="comment">//重新设置cookie值</span></span><br><span class="line">                   ck.setValue(time_en);</span><br><span class="line">                   ck.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>);<span class="comment">//cookie存储一个月</span></span><br><span class="line">                   response.addCookie(ck);</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//初次访问</span></span><br><span class="line">        <span class="keyword">if</span>(cks==<span class="keyword">null</span>||cks.length==<span class="number">0</span>|| !flag)&#123;</span><br><span class="line">            <span class="comment">//响应数据</span></span><br><span class="line">            response.getWriter().write(<span class="string">"&lt;h1&gt;您好，这是你的首次访问&lt;/h1&gt;"</span>);</span><br><span class="line">            <span class="comment">//设置cookie</span></span><br><span class="line">            Cookie lt = <span class="keyword">new</span> Cookie(<span class="string">"lastTime"</span>, time_en);</span><br><span class="line">            lt.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>);</span><br><span class="line">            response.addCookie(lt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/5.png"><blockquote><p>注意cookie存储中特殊字符的编解码即可</p></blockquote><h1 id="三、JSP"><a href="#三、JSP" class="headerlink" title="三、JSP"></a>三、JSP</h1><h2 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h2><p>JSP：Java Server Pages，java服务端页面</p><p>本质：一个特殊页面，既可以定义html标签，又可以定义java代码。本质就是一个Servlet</p><p>作用：简化Servlet书写</p><h2 id="3-2-原理"><a href="#3-2-原理" class="headerlink" title="3.2 原理"></a>3.2 原理</h2><ol><li>客户端请求<strong>.jsp</strong>，服务端判断有无<strong>.jsp</strong>。无则<strong>404</strong></li><li>找到<strong>.jsp</strong>，会将<strong>.jsp</strong>转换为<strong>.java</strong>文件</li><li>编译<strong>.java</strong>文件，生成<strong>.class</strong>字节码文件</li><li>由字节码文件提供访问</li></ol><p>我们在CATALINA_BASE的路径下，能够找到集成到idea上面Tomcat的路径，在conf下面，能够找到服务器访问的源文件。像servlet生成的源码放到了WEB-INF的classes下面</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/6.png"><p><strong>.jsp</strong>文件经过编译之后，存储在CATALINA_BASE路径下的work中</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/7.png"><p>可以看出，编译后<strong>.java</strong>文件继承了Tomcat中的<strong>HttpJspBase.java</strong>，我们进入Tomcat找到该类</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/8.png"><p><strong>HttpJspBase</strong>继承了<strong>HttpServlet</strong>，故jsp的本质就是一个Servlet</p><h2 id="3-3-jsp脚本"><a href="#3-3-jsp脚本" class="headerlink" title="3.3 jsp脚本"></a>3.3 jsp脚本</h2><p>jsp脚本：jsp定义Java代码的方式</p><ol><li>&lt;% 代码 %&gt;：定义在jsp转换后的java类（Servlet）的service方法中。service方法中可以定义什么，该脚本中就可以定义什么。</li><li>&lt;%! 代码 %&gt;：定义在jsp转换后的java类（Servlet）的成员位置。（不过尽量不要再Servlet中定义成员变量，会引发线程安全问题）</li><li>&lt;%= 代码 %&gt;：定义在jsp转换后的java类（Servlet）的service方法中。会输出在网页页面上，输出语句能输出啥，该脚本中就能定义啥</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;% System.out.println(<span class="string">"Hello JSP"</span>); %&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">3</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%= i %&gt;</span><br><span class="line">&lt;%= <span class="string">"我打你妈的"</span> %&gt;</span><br><span class="line">&lt;h1&gt;Hello JSP&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>以上面这个例子为例，编译生成的index_jsp.java如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">index_jsp</span> <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">HttpJspBase</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">JspSourceDependent</span>,</span></span><br><span class="line"><span class="class">                 <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">JspSourceImports</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">3</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> javax.servlet.jsp.JspFactory _jspxFactory =</span><br><span class="line">          javax.servlet.jsp.JspFactory.getDefaultFactory();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> java.util.Map&lt;java.lang.String,java.lang.Long&gt; _jspx_dependants;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.Set&lt;java.lang.String&gt; _jspx_imports_packages;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.Set&lt;java.lang.String&gt; _jspx_imports_classes;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    _jspx_imports_packages = <span class="keyword">new</span> java.util.HashSet&lt;&gt;();</span><br><span class="line">    _jspx_imports_packages.add(<span class="string">"javax.servlet"</span>);</span><br><span class="line">    _jspx_imports_packages.add(<span class="string">"javax.servlet.http"</span>);</span><br><span class="line">    _jspx_imports_packages.add(<span class="string">"javax.servlet.jsp"</span>);</span><br><span class="line">    _jspx_imports_classes = <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> javax.el.ExpressionFactory _el_expressionfactory;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> org.apache.tomcat.InstanceManager _jsp_instancemanager;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Map&lt;java.lang.String,java.lang.Long&gt; getDependants() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_dependants;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Set&lt;java.lang.String&gt; getPackageImports() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_imports_packages;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Set&lt;java.lang.String&gt; getClassImports() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_imports_classes;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> javax.el.<span class="function">ExpressionFactory <span class="title">_jsp_getExpressionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_el_expressionfactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_el_expressionfactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _el_expressionfactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> org.apache.tomcat.<span class="function">InstanceManager <span class="title">_jsp_getInstanceManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_jsp_instancemanager == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_jsp_instancemanager == <span class="keyword">null</span>) &#123;</span><br><span class="line">          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _jsp_instancemanager;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspService</span><span class="params">(<span class="keyword">final</span> javax.servlet.http.HttpServletRequest request, <span class="keyword">final</span> javax.servlet.http.HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> java.io.IOException, javax.servlet.ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) &#123;</span><br><span class="line">      <span class="keyword">final</span> java.lang.String _jspx_method = request.getMethod();</span><br><span class="line">      <span class="keyword">if</span> (<span class="string">"OPTIONS"</span>.equals(_jspx_method)) &#123;</span><br><span class="line">        response.setHeader(<span class="string">"Allow"</span>,<span class="string">"GET, HEAD, POST, OPTIONS"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="string">"GET"</span>.equals(_jspx_method) &amp;&amp; !<span class="string">"POST"</span>.equals(_jspx_method) &amp;&amp; !<span class="string">"HEAD"</span>.equals(_jspx_method)) &#123;</span><br><span class="line">        response.setHeader(<span class="string">"Allow"</span>,<span class="string">"GET, HEAD, POST, OPTIONS"</span>);</span><br><span class="line">        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, <span class="string">"JSP 只允许 GET、POST 或 HEAD。Jasper 还允许 OPTIONS"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> javax.servlet.jsp.PageContext pageContext;</span><br><span class="line">    javax.servlet.http.HttpSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletContext application;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletConfig config;</span><br><span class="line">    javax.servlet.jsp.JspWriter out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> java.lang.Object page = <span class="keyword">this</span>;</span><br><span class="line">    javax.servlet.jsp.JspWriter _jspx_out = <span class="keyword">null</span>;</span><br><span class="line">    javax.servlet.jsp.PageContext _jspx_page_context = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">      pageContext = _jspxFactory.getPageContext(<span class="keyword">this</span>, request, response,</span><br><span class="line">      			<span class="keyword">null</span>, <span class="keyword">true</span>, <span class="number">8192</span>, <span class="keyword">true</span>);</span><br><span class="line">      _jspx_page_context = pageContext;</span><br><span class="line">      application = pageContext.getServletContext();</span><br><span class="line">      config = pageContext.getServletConfig();</span><br><span class="line">      session = pageContext.getSession();</span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br><span class="line"></span><br><span class="line">      out.write(<span class="string">"\n"</span>);</span><br><span class="line">      out.write(<span class="string">"\n"</span>);</span><br><span class="line">      out.write(<span class="string">"&lt;html&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"  &lt;head&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"    &lt;title&gt;$Title$&lt;/title&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"  &lt;/head&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"  &lt;body&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"  "</span>);</span><br><span class="line"> System.out.println(<span class="string">"Hello JSP"</span>); </span><br><span class="line">      out.write(<span class="string">'\n'</span>);</span><br><span class="line">      out.write(<span class="string">' '</span>);</span><br><span class="line">      out.write(<span class="string">' '</span>);</span><br><span class="line">      out.write(<span class="string">'\n'</span>);</span><br><span class="line">      out.write(<span class="string">' '</span>);</span><br><span class="line">      out.write(<span class="string">' '</span>);</span><br><span class="line">      out.print( i );</span><br><span class="line">      out.write(<span class="string">'\n'</span>);</span><br><span class="line">      out.write(<span class="string">' '</span>);</span><br><span class="line">      out.write(<span class="string">' '</span>);</span><br><span class="line">      out.print( <span class="string">"我打你妈的"</span> );</span><br><span class="line">      out.write(<span class="string">"\n"</span>);</span><br><span class="line">      out.write(<span class="string">"  &lt;h1&gt;Hello JSP&lt;/h1&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"  &lt;/body&gt;\n"</span>);</span><br><span class="line">      out.write(<span class="string">"&lt;/html&gt;\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (java.lang.Throwable t) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(t <span class="keyword">instanceof</span> javax.servlet.jsp.SkipPageException))&#123;</span><br><span class="line">        out = _jspx_out;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="keyword">null</span> &amp;&amp; out.getBufferSize() != <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response.isCommitted()) &#123;</span><br><span class="line">              out.flush();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              out.clearBuffer();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (java.io.IOException e) &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> (_jspx_page_context != <span class="keyword">null</span>) _jspx_page_context.handlePageException(t);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(t);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      _jspxFactory.releasePageContext(_jspx_page_context);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-jsp内置对象"><a href="#3-4-jsp内置对象" class="headerlink" title="3.4 jsp内置对象"></a>3.4 jsp内置对象</h2><p>内置对象概念：在jsp页面中不需要获取和创建，可以直接使用的对象。</p><blockquote><p>因为jsp编译后就是一个servlet类，其中某些代码直接放到了service方法中，所以，像request这种的，是在Servlet中已经定义好的，就可以直接使用。叫做内置对象。</p><p>具体可以参照上面jsp生成的java代码</p></blockquote><p>jsp一共有9个内置对象（本次介绍三个，详细看下篇博客）</p><ul><li>request</li><li>response</li><li>out：字符输出流对象，可以将数据输出到页面上。类似于response.getWriter()<ul><li>out.write()：按代码顺序输出</li><li>response.getWriter().write()：直接先输出。在jsp中尽量不要用这个。</li></ul></li></ul><blockquote><p>在Tomcat服务器做出响应之前，会先找response.getWriter()缓冲区的内容，再找out缓冲区中的内容，故response.getWriter().write()数据输出永远在out.write()之前</p></blockquote><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/9.png"><p>通过jsp，我们可以优化Cookie的案例</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.text.SimpleDateFormat"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.Date"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.net.URLEncoder"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.nio.charset.StandardCharsets"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.net.URLDecoder"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置有没有lastTime这个cookie标记</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取当前时间</span></span><br><span class="line">    String time = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy年MM月dd日 HH:mm:ss"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">//直接存储time，会出错，因为有个空格。当然删掉是可以的，不过最好的办法是url编码</span></span><br><span class="line">    String time_en = URLEncoder.encode(time, StandardCharsets.UTF_8);</span><br><span class="line">    <span class="comment">//获取cookie</span></span><br><span class="line">    Cookie[] cks = request.getCookies();</span><br><span class="line">    <span class="comment">//二次访问</span></span><br><span class="line">    <span class="keyword">if</span> (cks != <span class="keyword">null</span> &amp;&amp; cks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Cookie ck : cks) &#123;</span><br><span class="line">            String name = ck.getName();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"lastTime"</span>.equals(name)) &#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//响应数据</span></span><br><span class="line">                String value = URLDecoder.decode(ck.getValue(), <span class="string">"utf-8"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;h1&gt;欢迎回来，您上次访问时间&lt;%=value%&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">                <span class="comment">//重新设置cookie值</span></span><br><span class="line">                ck.setValue(time_en);</span><br><span class="line">                ck.setMaxAge(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>);<span class="comment">//cookie存储一个月</span></span><br><span class="line">                response.addCookie(ck);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//初次访问</span></span><br><span class="line">    <span class="keyword">if</span> (cks == <span class="keyword">null</span> || cks.length == <span class="number">0</span> || !flag) &#123;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;h1&gt;您好，这是你的首次访问&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">        Cookie lt = <span class="keyword">new</span> Cookie(<span class="string">"lastTime"</span>, time_en);</span><br><span class="line">        lt.setMaxAge(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>);</span><br><span class="line">        response.addCookie(lt);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>优点：简单、方便，不用重启服务器即可运行。</p><p>缺点：代码没有进行分离。后期很难维护。当然实际开发中，还是不会用这种模式的。</p></blockquote><h1 id="四、Session"><a href="#四、Session" class="headerlink" title="四、Session"></a>四、Session</h1><p>概念：服务器端会话技术。在<strong><u>一次会话</u></strong>的多次请求间共享数据，将数据保存在服务器端的对象中（有一个对象就是HttpSession）</p><h2 id="4-1-快速入门"><a href="#4-1-快速入门" class="headerlink" title="4.1 快速入门"></a>4.1 快速入门</h2><ol><li><p>获取HttpSession</p><ul><li>request.getSession()</li></ul></li><li><p>HttpSession对象</p><ul><li>Object getAttribute(String name)</li><li>void setAttribute(String name, Object value)</li><li>void removeAttribute(String name)</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo01Session"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Session</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//使用Session共享数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取Session</span></span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        <span class="comment">//2.存储数据</span></span><br><span class="line">        session.setAttribute(<span class="string">"msg"</span>,<span class="string">"Hello Session"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问上一个页面的时候，获取到session，并存储了数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo02Session"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02Session</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//使用Session共享数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取Session</span></span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取数据</span></span><br><span class="line">        Object msg = session.getAttribute(<span class="string">"msg"</span>);</span><br><span class="line">        System.out.println(msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问demo02Session，即可获取到session中存储的数据。</p><blockquote><p>如果客户端关闭之后，则再次获取数据，会获取到null</p></blockquote><h2 id="4-2-实现原理"><a href="#4-2-实现原理" class="headerlink" title="4.2 实现原理"></a>4.2 实现原理</h2><p><strong><u>Session是依赖于Cookie的！</u></strong></p><p>初次访问服务器，获取Session，没有Cookie。会在内存中创建一个新的Session对象，该Session对象有唯一的id（jsp的话就是JSESSIONID；如果是php，会是PHPSESSID），然后将该id以set-cookie的形式返回给客户端。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/10.png"><p>二次访问服务器，请求头cookie中就会携带该Session对象的id，然后服务器根据id来判断获取的是哪个Session对象</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/11.png"><h2 id="4-3-Session细节"><a href="#4-3-Session细节" class="headerlink" title="4.3 Session细节"></a>4.3 Session细节</h2><ol><li>客户端关闭后，服务器不关闭，两次获取到的Session默认<strong>不是同一个</strong><ul><li>如果需要相同，则可以创建Cookie，键为JSESSIONID，并且设置最大存活时间，让Cookie持久保存</li></ul></li><li>客户端不关闭，服务器关闭后，两次获取到的Session不是同一个<ul><li>那么如何在服务器关闭后保持数据不丢失？<ul><li>Session钝化<ul><li>在服务器正常关闭之前，将session对象存储到硬盘上</li></ul></li><li>Session活化<ul><li>在服务器启动后，将session文件转化为内容中的session对象即可</li></ul></li></ul></li></ul></li><li>Session的销毁<ul><li>默认情况下，服务器关闭</li><li>session对象调用invalidate()</li><li>session默认失效时间为30分钟<ul><li>可以在web.xml进行选择性修改</li></ul></li></ul></li></ol><p>Session的钝化和活化，在本地Tomcat中是可以自动完成的，在idea的集成环境下，是不可以的。在服务器正常关闭的时候，Tomcat会自动在work目录下生成SESSIONS.ser，当服务器再次启动时，会将该文件读取到内存并删除。<a href="https://blog.csdn.net/wjw0130/article/details/45766709" target="_blank" rel="noopener">javaweb之session序列化与反序列化</a></p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/12.png"><h2 id="4-4-Session的特点"><a href="#4-4-Session的特点" class="headerlink" title="4.4 Session的特点"></a>4.4 Session的特点</h2><p>特点</p><ol><li>session用于存储一次会话的多次请求的数据，存在服务器端</li><li>session可以存储任意类型，任意大小</li></ol><h2 id="4-5-Session与Cookie区别"><a href="#4-5-Session与Cookie区别" class="headerlink" title="4.5 Session与Cookie区别"></a>4.5 Session与Cookie区别</h2><p>区别</p><ol><li>Session存储在服务器端，Cookie存储在客户端</li><li>Session没有数据大小限制，Cookie有大小限制</li><li>相对来说，Session比较安全，Cookie不太安全</li></ol><h2 id="4-6-案例-验证码"><a href="#4-6-案例-验证码" class="headerlink" title="4.6 案例-验证码"></a>4.6 案例-验证码</h2><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h3><ol><li>访问带有验证码的登录页面login.jsp</li><li>用户输入用户名、密码以及验证码<ul><li>若用户名和密码输入有误，跳转登录页面，提示<strong>用户名或密码错误</strong></li><li>如果验证码输入有误，跳转登录页面，提示<strong>验证码错误</strong></li><li>如果全部正确，跳转主页success.jsp，提示<strong>用户名，欢迎你</strong></li></ul></li></ol><p>分析</p><ol><li>设置request编码</li><li>获取参数Map集合</li><li>获取验证码</li><li>将用户信息封装到User对象</li><li>判断程序生成的验证码和用户输入的验证码是否一致（从Session中获取程序生成的随机验证码）<ul><li>不一致<ul><li>给用户提示信息</li><li>跳转登录页面：转发</li></ul></li><li>一致<ul><li>判断用户名和密码<ul><li>正确</li><li>不正确</li></ul></li></ul></li></ul></li></ol><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><p>login.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        * &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .box &#123;</span><br><span class="line">            background-color: #74C3B5;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width:<span class="number">100</span>vw;</span><br><span class="line">            height:<span class="number">100</span>vh;</span><br><span class="line">            position:fixed;</span><br><span class="line">        &#125;</span><br><span class="line">        .container &#123;</span><br><span class="line">            width: <span class="number">600</span>px;</span><br><span class="line">            margin: <span class="number">80</span>px auto;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .logo &#123;</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">70</span>px;</span><br><span class="line">            margin: auto;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">            margin-bottom: <span class="number">40</span>px;</span><br><span class="line">            font-size:<span class="number">44</span>px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        input &#123;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">40</span>px;</span><br><span class="line">            <span class="comment">/*opacity:.5;*/</span></span><br><span class="line">            transition: all ease .<span class="number">4</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">2</span>);</span><br><span class="line">            text-align: center;</span><br><span class="line">            font-size: <span class="number">20</span>px;</span><br><span class="line">            border: <span class="number">2</span><span class="function">px solid <span class="title">rgba</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">.4</span>)</span></span>;</span><br><span class="line">            outline: none;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        img &#123;</span><br><span class="line">            outline: <span class="number">0</span>;</span><br><span class="line">            border: <span class="number">1</span><span class="function">px solid <span class="title">rgba</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>)</span></span>;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">70</span>px;</span><br><span class="line">            border-radius: <span class="number">3</span>px;</span><br><span class="line">            padding: <span class="number">5</span>px <span class="number">8</span>px;</span><br><span class="line">            margin: <span class="number">0</span> auto <span class="number">5</span>px auto;</span><br><span class="line">            display: block;</span><br><span class="line">            text-align: center;</span><br><span class="line">            color: white;</span><br><span class="line">            opacity: .<span class="number">9</span>;</span><br><span class="line">            box-sizing: border-box;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        input:focus &#123;</span><br><span class="line">            color: #75DFB7;</span><br><span class="line">            width: <span class="number">300</span>px;</span><br><span class="line">            background-color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        button &#123;</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">40</span>px;</span><br><span class="line">            border: none;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">9</span>);</span><br><span class="line">            font-size: <span class="number">20</span>px;</span><br><span class="line">            color: #75DFB7;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ul &#123;</span><br><span class="line">            list-style: none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        li &#123;</span><br><span class="line">            line-height: <span class="number">50</span>px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        form a &#123;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        input::placeholder &#123;</span><br><span class="line">            color:#fff;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            top: <span class="number">0</span>;</span><br><span class="line">            left: <span class="number">0</span>;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            height: <span class="number">100</span>%;</span><br><span class="line">            z-index: <span class="number">1</span>;</span><br><span class="line">            pointer-events: none;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            list-style: none;</span><br><span class="line">            display: block;</span><br><span class="line">            width: <span class="number">40</span>px;</span><br><span class="line">            height: <span class="number">40</span>px;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.15</span>);</span><br><span class="line">            bottom: -<span class="number">160</span>px;</span><br><span class="line">            -webkit-animation: square <span class="number">25</span>s infinite;</span><br><span class="line">            animation: square <span class="number">25</span>s infinite;</span><br><span class="line">            -webkit-transition-timing-function: linear;</span><br><span class="line">            transition-timing-function: linear;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">1</span>) &#123;</span><br><span class="line">            left: <span class="number">10</span>%;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">2</span>) &#123;</span><br><span class="line">            left: <span class="number">20</span>%;</span><br><span class="line">            width: <span class="number">80</span>px;</span><br><span class="line">            height: <span class="number">80</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">2</span>s;</span><br><span class="line">            animation-delay: <span class="number">2</span>s;</span><br><span class="line">            -webkit-animation-duration: <span class="number">17</span>s;</span><br><span class="line">            animation-duration: <span class="number">17</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">3</span>) &#123;</span><br><span class="line">            left: <span class="number">25</span>%;</span><br><span class="line">            -webkit-animation-delay: <span class="number">4</span>s;</span><br><span class="line">            animation-delay: <span class="number">4</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">4</span>) &#123;</span><br><span class="line">            left: <span class="number">40</span>%;</span><br><span class="line">            width: <span class="number">60</span>px;</span><br><span class="line">            height: <span class="number">60</span>px;</span><br><span class="line">            -webkit-animation-duration: <span class="number">22</span>s;</span><br><span class="line">            animation-duration: <span class="number">22</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.25</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">5</span>) &#123;</span><br><span class="line">            left: <span class="number">70</span>%;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">6</span>) &#123;</span><br><span class="line">            left: <span class="number">80</span>%;</span><br><span class="line">            width: <span class="number">120</span>px;</span><br><span class="line">            height: <span class="number">120</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">3</span>s;</span><br><span class="line">            animation-delay: <span class="number">3</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">7</span>) &#123;</span><br><span class="line">            left: <span class="number">32</span>%;</span><br><span class="line">            width: <span class="number">160</span>px;</span><br><span class="line">            height: <span class="number">160</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">7</span>s;</span><br><span class="line">            animation-delay: <span class="number">7</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">8</span>) &#123;</span><br><span class="line">            left: <span class="number">55</span>%;</span><br><span class="line">            width: <span class="number">20</span>px;</span><br><span class="line">            height: <span class="number">20</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">15</span>s;</span><br><span class="line">            animation-delay: <span class="number">15</span>s;</span><br><span class="line">            -webkit-animation-duration: <span class="number">40</span>s;</span><br><span class="line">            animation-duration: <span class="number">40</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">9</span>) &#123;</span><br><span class="line">            left: <span class="number">25</span>%;</span><br><span class="line">            width: <span class="number">10</span>px;</span><br><span class="line">            height: <span class="number">10</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">2</span>s;</span><br><span class="line">            animation-delay: <span class="number">2</span>s;</span><br><span class="line">            -webkit-animation-duration: <span class="number">40</span>s;</span><br><span class="line">            animation-duration: <span class="number">40</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">10</span>) &#123;</span><br><span class="line">            left: <span class="number">90</span>%;</span><br><span class="line">            width: <span class="number">160</span>px;</span><br><span class="line">            height: <span class="number">160</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">11</span>s;</span><br><span class="line">            animation-delay: <span class="number">11</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        @-webkit-keyframes square &#123;</span><br><span class="line">            <span class="number">0</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(<span class="number">0</span>);</span><br><span class="line">                transform: translateY(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="number">100</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">                transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@keyframes</span> square &#123;</span><br><span class="line">            <span class="number">0</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(<span class="number">0</span>);</span><br><span class="line">                transform: translateY(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="number">100</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">                transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        error &#123;</span><br><span class="line">            color:deeppink;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String login_error = (String) request.getAttribute(<span class="string">"login_error"</span>);</span><br><span class="line">    String cc_error = (String) request.getAttribute(<span class="string">"cc_error"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"box"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"logo"</span>&gt;</span><br><span class="line">            神话Q传</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">            <span class="keyword">if</span>(login_error!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                out.write(<span class="string">"&lt;error&gt;"</span>+login_error+<span class="string">"&lt;/error&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cc_error!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                out.write(<span class="string">"&lt;error&gt;"</span>+cc_error+<span class="string">"&lt;/error&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        %&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/session/loginServlet"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &lt;li&gt;&lt;input type="text" name="username" placeholder="用户名" autocomplete="off"&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;input type="text" name="password" placeholder="密码" autocomplete="off"&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;input type="text" name="checkcode" placeholder="不区分大小写"&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;img id="checkcode" src="/session/checkCodeServlet" alt=""&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;button&gt;登录&lt;/button&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"bg-bubbles"</span>&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    document.querySelector(<span class="string">"#checkcode"</span>).onclick=function ()&#123;</span><br><span class="line">        let url = <span class="string">"/session/checkCodeServlet"</span>;</span><br><span class="line">        let date=<span class="keyword">new</span> Date().getTime();</span><br><span class="line">        <span class="keyword">this</span>.setAttribute(<span class="string">"src"</span>, url+<span class="string">"?"</span>+date)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>CheckCodeServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/session/checkCodeServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> width=<span class="number">100</span>;</span><br><span class="line">        <span class="keyword">int</span> height=<span class="number">30</span>;</span><br><span class="line">        <span class="comment">//1.创建对象，在内存中画图（验证码图片对象）</span></span><br><span class="line">        BufferedImage image=<span class="keyword">new</span> BufferedImage(width,height,BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">//2.美化图片</span></span><br><span class="line">        <span class="comment">//2.1填充背景色</span></span><br><span class="line">        Graphics g=image.getGraphics();<span class="comment">//绘图对象</span></span><br><span class="line">        g.setColor(<span class="keyword">new</span> Color(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</span><br><span class="line">        g.fillRect(<span class="number">0</span>,<span class="number">0</span>,width,height);</span><br><span class="line">        <span class="comment">//2.2画边框</span></span><br><span class="line">        g.setColor(Color.RED);</span><br><span class="line">        g.drawRect(<span class="number">0</span>,<span class="number">0</span>,width-<span class="number">1</span>,height-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//2.3写验证码</span></span><br><span class="line">        String str=<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">        Random r=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="comment">//StringBuilder在处理多个字符串拼接的时候，效率要比+拼接要高很多。</span></span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//设置字体,绘制字符</span></span><br><span class="line">            g.setFont(<span class="keyword">new</span> Font(Font.SANS_SERIF,Font.BOLD,<span class="number">20</span>));</span><br><span class="line">            <span class="keyword">char</span> c = str.charAt(r.nextInt(str.length()));</span><br><span class="line">            stringBuilder.append(c);</span><br><span class="line">            g.drawString(String.valueOf(c),width/<span class="number">5</span>*(i+<span class="number">1</span>),height/<span class="number">2</span>+<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将验证码存入session</span></span><br><span class="line">        String checkcode=stringBuilder.toString();</span><br><span class="line">        request.getSession().setAttribute(<span class="string">"checkcode"</span>,checkcode);</span><br><span class="line">        <span class="comment">//2.4 画干扰线</span></span><br><span class="line">        g.setColor(Color.green);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x1=r.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y1=r.nextInt(height);</span><br><span class="line">            <span class="keyword">int</span> x2=r.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y2=r.nextInt(height);</span><br><span class="line">            g.drawLine(x1,y1,x2,y2);<span class="comment">//画线</span></span><br><span class="line">            <span class="comment">//画点</span></span><br><span class="line"><span class="comment">//            g.drawOval(x1,y1,5,5);</span></span><br><span class="line"><span class="comment">//            g.fillOval(x1,y1,5,5);</span></span><br><span class="line"><span class="comment">//            g.drawOval(x2,y2,5,5);</span></span><br><span class="line"><span class="comment">//            g.fillOval(x2,y2,5,5);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.将图片输出到页面展示</span></span><br><span class="line">        ImageIO.write(image,<span class="string">"jpg"</span>,response.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LoginServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/session/loginServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//        1. 设置request编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line"><span class="comment">//        2. 获取参数Map集合</span></span><br><span class="line"><span class="comment">//        Map&lt;String, String[]&gt; map = request.getParameterMap();</span></span><br><span class="line">        String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">        String checkcode = request.getParameter(<span class="string">"checkcode"</span>);</span><br><span class="line"><span class="comment">//        3. 获取验证码</span></span><br><span class="line">        String code = (String)session.getAttribute(<span class="string">"checkcode"</span>);</span><br><span class="line">        <span class="comment">//这是为了使验证码保持一次性使用</span></span><br><span class="line">        session.removeAttribute(<span class="string">"checkcode"</span>);</span><br><span class="line">        <span class="comment">//忽略大小写</span></span><br><span class="line">        <span class="keyword">if</span>(code!=<span class="keyword">null</span>&amp;&amp;code.equalsIgnoreCase(checkcode))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"胡列娜"</span>.equals(username)&amp;&amp;<span class="string">"fairy"</span>.equals(password))&#123;</span><br><span class="line">                <span class="comment">//存储信息</span></span><br><span class="line">                session.setAttribute(<span class="string">"user"</span>,username);</span><br><span class="line">                <span class="comment">//重定向</span></span><br><span class="line">                response.sendRedirect(<span class="string">"/session/success.jsp"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//存储信息</span></span><br><span class="line">                request.setAttribute(<span class="string">"login_error"</span>,<span class="string">"用户名或者密码错误"</span>);</span><br><span class="line">                <span class="comment">//转发</span></span><br><span class="line">                request.getRequestDispatcher(<span class="string">"/session/login.jsp"</span>).forward(request,response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//存储信息</span></span><br><span class="line">            request.setAttribute(<span class="string">"cc_error"</span>,<span class="string">"验证码错误"</span>);</span><br><span class="line">            <span class="comment">//转发</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/session/login.jsp"</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        4. 将用户信息封装到User对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>success.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;主页&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        * &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .box &#123;</span><br><span class="line">            background-color: #74C3B5;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width:<span class="number">100</span>vw;</span><br><span class="line">            height:<span class="number">100</span>vh;</span><br><span class="line">            position:fixed;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"box"</span>&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        String user= (String) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            out.write(user+<span class="string">",欢迎您"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"/session/login.jsp"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cookie-and-session-2/13.png"><blockquote><p>这个页面是我原来模仿一个网页游戏写的一个页面，今天无意间发现了那么久远的代码，就直接拿来用了。</p></blockquote><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>验证码重复使用的问题已经解决了。</p><p>还有一个问题，就是如果用户直接访问LoginServlet会报错，这个是直接将LoginServlet摆在了明面上，这样做是不太好的，实际开发中，可以异步请求LoginServlet，而LoginServlet只需返回结果即可。这样应该会相对更安全易用</p></div><div class="post-detail">发布：2020-06-23 09:12:05<br>修改：2020-06-24 22:24:51<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/cookie-and-session-2/</span><br>标签：<span><a href="/blog/tags/web/">web</a>&nbsp;<a href="/blog/tags/jsp/">jsp</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>