<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="webpack从入门到茎痛,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="我要爆肝九个小时，记录学习笔记！终于肝完了，此时并没有肝到精通，而是肝得蛋疼~"><title>webpack从入门到茎痛</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">webpack从入门到茎痛</h2></div><div class="post-content blog-markdown"><p><a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack官网</a></p><p>powershell<a href="https://www.cnblogs.com/lsdb/p/9531338.html" target="_blank" rel="noopener">使用教程</a></p><p>在cmd中输入powershell即可直接进入，或者通过vscode进入。</p><p>发现一个网页的小技巧，即可修改内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.contentEditable=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>关于js的加载顺序理解，<a href="https://www.cnblogs.com/echolun/p/12614056.html" target="_blank" rel="noopener">script脚本async和defer的区别</a></p><p>今天看<a href="https://v.qq.com/x/cover/mzc00200gacissy/h0032em4q2k.html" target="_blank" rel="noopener">极限挑战</a>，慢步人生路，太有感触了。</p><p>严敏一句话，“我们少年时期呢，兜里没有很多钱，但是，另一半的生活很精彩”，很真实了。</p><p>我大致在知乎上看了一眼极限挑战的<a href="https://zhuanlan.zhihu.com/p/68668726" target="_blank" rel="noopener">前世今生</a>，文章一看就是个写热文蹭流量那种，不过事实也八九不离十。不仅有很多感慨，或许这就是现实吧。</p><p>比方说我现在周末想看个电影，一般都是追忆老电影了，像李连杰、吴京、周星驰系列，漫威系列，以及其他一些老电影，现在新出的电影基本不看，电视剧更不看了。现在整个影视行业的流向就是只要能吸引来流量，干啥都行，无底线。</p><p>比方说之前翻拍动漫的魔道祖师、斗破苍穹，以及现在正在拍的斗罗大陆，我看了几眼，说实话，真的恶心。但是网上还有大片大片的狂热女粉，或许她们眼里只要人长得好看，拍得烂不烂都无所谓了。</p><p>资本决定了影视行业的流向，资本同样影响了大部分人的价值观，在这个纷扰的社会里，做真自己，太难了。</p><h1 id="一、webpack初体验"><a href="#一、webpack初体验" class="headerlink" title="一、webpack初体验"></a>一、webpack初体验</h1><p>npm i 跟 npm install 类似又不类似，百度即可</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack<span class="literal">-cli</span> <span class="comment">#普通安装webpack跟webpack-cli</span></span><br><span class="line">npm install webpack webpack<span class="literal">-cli</span> <span class="literal">-g</span> <span class="comment">#全局安装</span></span><br><span class="line">npm install webpack webpack<span class="literal">-cli</span> <span class="literal">-D</span> <span class="comment">#安装并添加到开发依赖 --save-dev 写入devDependencies</span></span><br><span class="line">npm install webpack webpack<span class="literal">-cli</span> <span class="literal">-S</span> <span class="comment">#安装并添加到生产依赖 --save 写入dependencies</span></span><br></pre></td></tr></table></figure><blockquote><p>卸载的话，只需要将install换成uninstall即可，用法如上</p></blockquote><p>开发环境命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack ./src/index.js <span class="literal">-o</span> ./build/build.js -<span class="literal">-mode</span>=development</span><br></pre></td></tr></table></figure><p>webpack会以.src/index.js 为入口文件开始打包，打包后输出到./build/build.js<br>整体打包环境，是开发环境</p><p>生产环境命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack ./src/index.js <span class="literal">-o</span> ./build/build.js -<span class="literal">-mode</span>=production</span><br></pre></td></tr></table></figure><p>webpack会以.src/index.js 为入口文件开始打包，打包后输出到./build/build.js<br>整体打包环境，是生产环境</p><p>结论</p><ol><li>webpack能处理js/json，不能处理css/img等资源</li><li>生产环境和开发环境将es6模块化编译成浏览器能识别的模块化</li><li>生产环境比开发环境多一个压缩js代码</li></ol><h1 id="二、webpack开发环境"><a href="#二、webpack开发环境" class="headerlink" title="二、webpack开发环境"></a>二、webpack开发环境</h1><h2 id="2-1-打包样式资源"><a href="#2-1-打包样式资源" class="headerlink" title="2.1 打包样式资源"></a>2.1 打包样式资源</h2><p>下载需要用到的包</p><ul><li>css-loader</li><li>style-loader</li><li>less-loader</li><li>less</li></ul><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> webpack.config.js webpack的配置文件</span></span><br><span class="line"><span class="comment">    作用：指示webpack工作（当运行webpack指令时，会加载里面的配置）</span></span><br><span class="line"><span class="comment">    所有构建工具都是基于nodejs平台运行的，src下源码采用es6，而模块化（比如webpack.config.js）默认采用commonjs</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// resolve用来拼接路径的方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//webpack配置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//入口起点</span></span><br><span class="line">    entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 输出文件名</span></span><br><span class="line">        filename: <span class="string">"built.js"</span>,</span><br><span class="line">        <span class="comment">// 输出路径 _dirname是nodejs的变量，代表当前文件的目录绝对路径</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// loader的配置</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 详细的loader配置</span></span><br><span class="line">            <span class="comment">// 不同文件必须配置不同loader处理</span></span><br><span class="line">            <span class="comment">// 配置css</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 正则匹配文件</span></span><br><span class="line">                test:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// 使用哪些loader进行处理</span></span><br><span class="line">                use:[</span><br><span class="line">                    <span class="comment">// use数组中loader执行顺序：从右到左，从下到上，依次执行</span></span><br><span class="line">                    <span class="comment">// 创建style标签，将js中的css样式资源插入进去，添加到head中生效</span></span><br><span class="line">                    <span class="string">"style-loader"</span>,</span><br><span class="line">                    <span class="comment">// 将css文件变成一个commonjs的模块加载到js中，里面的内容是样式的字符串</span></span><br><span class="line">                    <span class="string">"css-loader"</span></span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 配置less</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.less$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    <span class="string">"style-loader"</span>,</span><br><span class="line">                    <span class="string">"css-loader"</span>,</span><br><span class="line">                    <span class="comment">// 将less文件编译为css文件</span></span><br><span class="line">                    <span class="string">"less-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// plugins的配置</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// 详细的plugins配置</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">"development"</span>,<span class="comment">//开发模式</span></span><br><span class="line">    <span class="comment">// mode: "production"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-打包HTML资源"><a href="#2-2-打包HTML资源" class="headerlink" title="2.2 打包HTML资源"></a>2.2 打包HTML资源</h2><p>下载需要用到的包</p><ul><li>html-webpack-plugin</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * loader:1.下载 2.使用（配置loader）</span></span><br><span class="line"><span class="comment"> * plugins:1.下载 2.引入 3.使用</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin=<span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"built.js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="comment">// plugins的配置</span></span><br><span class="line">        <span class="comment">// html-webpack-plugin</span></span><br><span class="line">        <span class="comment">// 功能：默认会创建一个Html文件，引入打包输出的所有资源（js/css）</span></span><br><span class="line">        <span class="comment">// 需求：需要有结构的html文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="comment">// 复制"./src/index.html",并自动引入打包输出的所有资源（js/css）</span></span><br><span class="line">            template:<span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-打包图片资源"><a href="#2-3-打包图片资源" class="headerlink" title="2.3 打包图片资源"></a>2.3 打包图片资源</h2><p>下载需要用到的包</p><ul><li>url-loader</li><li>file-loader</li><li>html-loader</li></ul><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,</span><br><span class="line">                    <span class="string">'less-loader'</span>,</span><br><span class="line"></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 问题：处理不了html中的img图片</span></span><br><span class="line">            <span class="comment">// 处理图片资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                <span class="comment">// 只需使用一个loader即可</span></span><br><span class="line">                <span class="comment">// 需要下载url-loader和file-loader</span></span><br><span class="line">                loader:<span class="string">"url-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    <span class="comment">// 当发现图片大小，小于8kb时，就会被base64处理</span></span><br><span class="line">                    <span class="comment">// 优点：减少请求数量，减轻服务器压力</span></span><br><span class="line">                    <span class="comment">// 缺点：图片体积会变大大（导致文件请求速度变慢，所以一般只处理小图片，8-12kb的图片），之前5kb，转换为base64，就会变成8kb，类似等等</span></span><br><span class="line">                    limit:<span class="number">8</span>*<span class="number">1024</span>,</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 问题：因为url-loader的es6模块化，使用commonjs解析，而html-loader引入图片使用的是commonjs</span></span><br><span class="line"><span class="comment">                     * 解析时会出问题：[Object Module]</span></span><br><span class="line"><span class="comment">                     * 解决：关闭url-loader的es6模块化，使用commonjs解析</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    esModule:<span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">// 设置图片名字格式</span></span><br><span class="line">                    <span class="comment">// hash:10 取图片哈希值前5位</span></span><br><span class="line">                    <span class="comment">// ext 取文件的原扩展名</span></span><br><span class="line">                    <span class="comment">// 发现重复文件的时候，不会覆盖，而会保留原文件</span></span><br><span class="line">                    name:<span class="string">"[hash:5].[ext]"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.html$/</span>,</span><br><span class="line">                <span class="comment">//处理html文件的img图片（负责引入图片，从而能被url-loader处理）</span></span><br><span class="line">                loader:<span class="string">"html-loader"</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-4-打包其他资源"><a href="#2-4-打包其他资源" class="headerlink" title="2.4 打包其他资源"></a>2.4 打包其他资源</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">"style-loader"</span>,</span><br><span class="line">                    <span class="string">"css-loader"</span>,</span><br><span class="line">                    <span class="string">"less-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 打包其他资源(除了HTML/JS/CSS资源以外的资源)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 排除css/js/html/less资源</span></span><br><span class="line">                exclude: <span class="regexp">/\.(css|js|html|less)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    name:<span class="string">'[hash:5].[ext]'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-devServer"><a href="#2-5-devServer" class="headerlink" title="2.5 devServer"></a>2.5 devServer</h2><p>修改配置文件</p><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">"style-loader"</span>,</span><br><span class="line">                    <span class="string">"css-loader"</span>,</span><br><span class="line">                    <span class="string">"less-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 打包其他资源(除了HTML/JS/CSS资源以外的资源)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 排除css/js/html/less资源</span></span><br><span class="line">                exclude: <span class="regexp">/\.(css|js|html|less)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">'[hash:5].[ext]'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    <span class="comment">// 开发服务器devServer：用来自动化（自动编译、自动打开浏览器，自动刷新浏览器）</span></span><br><span class="line">    <span class="comment">// 特点：只会在内存中编译打包，不会有任何输出</span></span><br><span class="line">    <span class="comment">// 启动devServer指令为：npx webpack-dev-server</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        <span class="comment">// 跳过检查</span></span><br><span class="line">        <span class="comment">// 如果是false，则只能访问localhost:3000,</span></span><br><span class="line">        <span class="comment">// 如果是true，则都可以访问，比方说meethigher.com:3000</span></span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认打开本地的浏览器</span></span><br><span class="line">        open:<span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        <span class="comment">// 启动gzip压缩</span></span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 端口号</span></span><br><span class="line">        port: <span class="number">8080</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行命令，即可自动打开浏览器执行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack<span class="literal">-dev</span><span class="literal">-server</span></span><br></pre></td></tr></table></figure><h2 id="2-6-开发环境基本配置"><a href="#2-6-开发环境基本配置" class="headerlink" title="2.6 开发环境基本配置"></a>2.6 开发环境基本配置</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是开发环境配置：能让代码运行起来，在内存中编译打包</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 运行项目指令：</span></span><br><span class="line"><span class="comment"> * webpack 会将打包结果输出去</span></span><br><span class="line"><span class="comment"> * npx webpack-dev-server 只会在内存中编译打包，没有输出</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'js/built.js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// loader的配置</span></span><br><span class="line">            <span class="comment">// 处理less资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,</span><br><span class="line">                    <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理css资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jpg||png||gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 设置使用commonjs，不使用es</span></span><br><span class="line">                    esModule: <span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">//将图片输出到imgs文件夹</span></span><br><span class="line">                    outputPath:<span class="string">"imgs"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的img资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude: <span class="regexp">/\.(html|css|js|less|jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 将其他资源输出到media文件夹</span></span><br><span class="line">                    outputPath:<span class="string">"media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// plugins的配置</span></span><br><span class="line">        <span class="comment">// 相当于是引入一个模板</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="三、webpack生产环境"><a href="#三、webpack生产环境" class="headerlink" title="三、webpack生产环境"></a>三、webpack生产环境</h1><h2 id="3-1-css提取"><a href="#3-1-css提取" class="headerlink" title="3.1 css提取"></a>3.1 css提取</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin=<span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"./js/built.js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    <span class="comment">// 创建style标签，将样式放入</span></span><br><span class="line">                    <span class="comment">// "style-loader",</span></span><br><span class="line">                    <span class="comment">// 这个loader取代style-loader。作用：提取css成单独文件</span></span><br><span class="line">                    miniCssExtractPlugin.loader,</span><br><span class="line">                    <span class="string">"css-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template:<span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            <span class="comment">// 输出文件</span></span><br><span class="line">            filename:<span class="string">"./css/built.css"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-css兼容性处理"><a href="#3-2-css兼容性处理" class="headerlink" title="3.2 css兼容性处理"></a>3.2 css兼容性处理</h2><p>需要安装的插件</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss<span class="literal">-loader</span> postcss<span class="literal">-preset</span><span class="literal">-env</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line"><span class="comment">// process.env.NODE_ENV="development";</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"./js/built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// 创建style标签，将样式放入</span></span><br><span class="line">                    <span class="comment">// "style-loader",</span></span><br><span class="line">                    <span class="comment">// 这个loader取代style-loader。作用：提取css成单独文件</span></span><br><span class="line">                    miniCssExtractPlugin.loader,</span><br><span class="line">                    <span class="string">"css-loader"</span>,</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * css兼容性处理</span></span><br><span class="line"><span class="comment">                     * 需要用到postcss，这需要两个包postcss-loader、postcss-preset-env</span></span><br><span class="line"><span class="comment">                     * 帮助postcss找到package.json中browserlist里面的配置，通过配置加载指定的css兼容性样式</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 在browserslist配置下面内容，通过process.env.NODE_ENV="development"，来配置browserslist的运行模式</span></span><br><span class="line"><span class="comment">                     * "browserslist":&#123;</span></span><br><span class="line"><span class="comment">                     * "development":[</span></span><br><span class="line"><span class="comment">                     *    "last 1 chrome version",</span></span><br><span class="line"><span class="comment">                     *    "last 1 firefox version",</span></span><br><span class="line"><span class="comment">                     *    "last 1 safari version"</span></span><br><span class="line"><span class="comment">                     *  ],</span></span><br><span class="line"><span class="comment">                     *  "production":[</span></span><br><span class="line"><span class="comment">                     *    "&gt;0.2%",</span></span><br><span class="line"><span class="comment">                     *    "not dead",</span></span><br><span class="line"><span class="comment">                     *    "no op_mini all"</span></span><br><span class="line"><span class="comment">                     *  ]</span></span><br><span class="line"><span class="comment">                     * &#125;</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="comment">//两种写法，第一种是默认配置</span></span><br><span class="line">                    <span class="comment">// "post-loader",</span></span><br><span class="line">                    <span class="comment">//第二种修改配置</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            ident: <span class="string">"postcss"</span>,</span><br><span class="line">                            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                                <span class="comment">// postcss的插件</span></span><br><span class="line">                                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            <span class="comment">// 输出文件</span></span><br><span class="line">            filename: <span class="string">"./css/built.css"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>关于browserslist的配置，可以在github搜索获得</p></blockquote><h2 id="3-3-压缩css"><a href="#3-3-压缩css" class="headerlink" title="3.3 压缩css"></a>3.3 压缩css</h2><p>安装插件</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="built_in">optimize-css</span><span class="literal">-assets</span><span class="literal">-webpack</span><span class="literal">-plugin</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV=<span class="string">"development"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpack=<span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"./js/built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// 创建style标签，将样式放入</span></span><br><span class="line">                    <span class="comment">// "style-loader",</span></span><br><span class="line">                    <span class="comment">// 这个loader取代style-loader。作用：提取css成单独文件</span></span><br><span class="line">                    miniCssExtractPlugin.loader,</span><br><span class="line">                    <span class="string">"css-loader"</span>,</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * css兼容性处理</span></span><br><span class="line"><span class="comment">                     * 需要用到postcss，这需要两个包postcss-loader、postcss-preset-env</span></span><br><span class="line"><span class="comment">                     * 帮助postcss找到package.json中browserlist里面的配置，通过配置加载指定的css兼容性样式</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 在browserslist配置下面内容，通过process.env.NODE_ENV="development"，来配置browserslist的运行模式</span></span><br><span class="line"><span class="comment">                     * "browserslist":&#123;</span></span><br><span class="line"><span class="comment">                     * "development":[</span></span><br><span class="line"><span class="comment">                     *    "last 1 chrome version",</span></span><br><span class="line"><span class="comment">                     *    "last 1 firefox version",</span></span><br><span class="line"><span class="comment">                     *    "last 1 safari version"</span></span><br><span class="line"><span class="comment">                     *  ],</span></span><br><span class="line"><span class="comment">                     *  "production":[</span></span><br><span class="line"><span class="comment">                     *    "&gt;0.2%",</span></span><br><span class="line"><span class="comment">                     *    "not dead",</span></span><br><span class="line"><span class="comment">                     *    "no op_mini all"</span></span><br><span class="line"><span class="comment">                     *  ]</span></span><br><span class="line"><span class="comment">                     * &#125;</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="comment">//两种写法，第一种是默认配置</span></span><br><span class="line">                    <span class="comment">// "post-loader",</span></span><br><span class="line">                    <span class="comment">//第二种修改配置</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            ident: <span class="string">"postcss"</span>,</span><br><span class="line">                            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                                <span class="comment">// postcss的插件</span></span><br><span class="line">                                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// 打包html</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//提取css</span></span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            <span class="comment">// 输出文件</span></span><br><span class="line">            filename: <span class="string">"./css/built.css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 压缩css，直接使用默认配置即可</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpack()</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-js语法检查"><a href="#3-4-js语法检查" class="headerlink" title="3.4 js语法检查"></a>3.4 js语法检查</h2><p>可以参照<a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">js规则</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint<span class="literal">-config</span><span class="literal">-airbnb</span><span class="literal">-base</span> eslint eslint<span class="literal">-plugin</span><span class="literal">-import</span> eslint<span class="literal">-loader</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"js/built.js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 语法检查，需要安装eslint-loader eslint</span></span><br><span class="line"><span class="comment">             * 注意：只检查自己写的源代码，不检查第三方库，通过exclude排除第三方库</span></span><br><span class="line"><span class="comment">             * 设置检查规则：package.json中eslintConfig中设置</span></span><br><span class="line"><span class="comment">             * 推荐使用airbnb规则-&gt;eslint-config-airbnb-base eslint eslint-plugin-import</span></span><br><span class="line"><span class="comment">             * 在package.json中进行配置</span></span><br><span class="line"><span class="comment">             * "eslintConfig":&#123;</span></span><br><span class="line"><span class="comment">             *   "extends":"airbnb-base"</span></span><br><span class="line"><span class="comment">             * &#125;,</span></span><br><span class="line"><span class="comment">             * </span></span><br><span class="line"><span class="comment">             * 如果某些js代码需要忽略检查，可以通过添加// eslint-disable-next-line，来使下一行检测失效</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude:<span class="regexp">/node-modules/</span>,</span><br><span class="line">                loader:<span class="string">"eslint-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    <span class="comment">// 自动修复eslint的错误</span></span><br><span class="line">                    fix:<span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template:<span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5-js兼容性处理"><a href="#3-5-js兼容性处理" class="headerlink" title="3.5 js兼容性处理"></a>3.5 js兼容性处理</h2><p>兼容性处理</p><ol><li>基本兼容性</li><li>全部兼容性</li><li>按需兼容性</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"js/built.js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * js基本兼容性处理：babel-loader <span class="doctag">@babel</span>/preset-env <span class="doctag">@babel</span>/core</span></span><br><span class="line"><span class="comment">             * 问题：只能转换基本语法，如es6中promise就不能转换</span></span><br><span class="line"><span class="comment">             * </span></span><br><span class="line"><span class="comment">             * js全部兼容性处理：<span class="doctag">@babel</span>/polyfill，只需要在index.js中引入即可import "<span class="doctag">@babel</span>/polyfill";</span></span><br><span class="line"><span class="comment">             * 问题：需求是解决部分兼容，但是所有兼容代码都被引入，体积太大</span></span><br><span class="line"><span class="comment">             * </span></span><br><span class="line"><span class="comment">             * js部分兼容性处理：按需加载--&gt;core-js，不需要在index.js引入import "<span class="doctag">@babel</span>/polyfill"</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="comment">//排除</span></span><br><span class="line">                exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader:<span class="string">"babel-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    <span class="comment">//预设：指示babel做哪些兼容性处理，只有presets:["@babel/preset-env"]这一个表示全部兼容性处理</span></span><br><span class="line">                    presets:[</span><br><span class="line">                        [</span><br><span class="line">                            <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                            <span class="comment">// 按需加载</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                useBuiltIns:<span class="string">"usage"</span>,</span><br><span class="line">                                <span class="comment">// 指定corejs版本</span></span><br><span class="line">                                corejs:&#123;</span><br><span class="line">                                    version:<span class="number">3</span></span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="comment">// 指定兼容性做到哪个版本浏览器</span></span><br><span class="line">                                targets:&#123;</span><br><span class="line">                                    chrome:<span class="string">"60"</span>,</span><br><span class="line">                                    firefox:<span class="string">"50"</span>,</span><br><span class="line">                                    ie:<span class="string">"9"</span>,</span><br><span class="line">                                    safari:<span class="string">"10"</span>,</span><br><span class="line">                                    edge:<span class="string">"17"</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    ],</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template:<span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-压缩html与js"><a href="#3-6-压缩html与js" class="headerlink" title="3.6 压缩html与js"></a>3.6 压缩html与js</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"js/built.js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template:<span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify:&#123;</span><br><span class="line">                <span class="comment">// 移除空格</span></span><br><span class="line">                collapseWhitespace:<span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// 移除注释</span></span><br><span class="line">                removeComments:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//生产环境下自动压缩js代码</span></span><br><span class="line">    mode:<span class="string">"production"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-7-生产环境基本配置"><a href="#3-7-生产环境基本配置" class="headerlink" title="3.7 生产环境基本配置"></a>3.7 生产环境基本配置</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpackPlugin=<span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复用loader</span></span><br><span class="line"><span class="keyword">const</span> commonCssLoader = [</span><br><span class="line">    miniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    <span class="comment">// 兼容性处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在package.json中需要配置browserslist</span></span><br><span class="line">        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ident: <span class="string">"postcss"</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"js/built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">//提取css文件</span></span><br><span class="line">            <span class="comment">// 兼容性处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    ...commonCssLoader</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    ...commonCssLoader,</span><br><span class="line">                    <span class="string">"less-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// js语法检查</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 正常来讲，一个文件只能被一个loader处理</span></span><br><span class="line"><span class="comment">             * 当一个文件要被多个loader处理时，那么一定要指定loader执行的先后顺序</span></span><br><span class="line"><span class="comment">             * 先执行eslint，再执行babel</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 在package.json中需要配置eslintConfig-&gt;airbnb</span></span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader:<span class="string">"eslint-loader"</span>,</span><br><span class="line">                <span class="comment">// 自动修复语法</span></span><br><span class="line">                options:&#123;</span><br><span class="line">                    fix:<span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 优先执行</span></span><br><span class="line">                enforce:<span class="string">"pre"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// js兼容性处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader:<span class="string">"babel-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    presets:[</span><br><span class="line">                        [</span><br><span class="line">                            <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                            &#123;</span><br><span class="line">                                useBuiltIns:<span class="string">"usage"</span>,</span><br><span class="line">                                corejs:&#123;<span class="attr">version</span>:<span class="number">3</span>&#125;,</span><br><span class="line">                                targets:&#123;</span><br><span class="line">                                    chrome:<span class="string">"60"</span>,</span><br><span class="line">                                    firefox:<span class="string">"50"</span>,</span><br><span class="line">                                    ie:<span class="string">"9"</span>,</span><br><span class="line">                                    safari:<span class="string">"10"</span>,</span><br><span class="line">                                    edge:<span class="string">"17"</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ],</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                loader:<span class="string">"url-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    limit:<span class="number">8</span>*<span class="number">1024</span>,<span class="comment">//8kb以下进行base64处理</span></span><br><span class="line">                    name:<span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    outputPath:<span class="string">"imgs"</span>,</span><br><span class="line">                    esModule:<span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的图片</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader:<span class="string">"html-loader"</span>, </span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他文件</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude:<span class="regexp">/\.(js|css|less|html|jpg|png|gif)$/</span>,</span><br><span class="line">                loader:<span class="string">"file-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    outputPath:<span class="string">"media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">"css/built.css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template:<span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify:&#123;</span><br><span class="line">                collapseWhitespace:<span class="literal">true</span>,</span><br><span class="line">                removeComments:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        <span class="comment">// 跳过检查</span></span><br><span class="line">        <span class="comment">// 如果是false，则只能访问localhost:3000,</span></span><br><span class="line">        <span class="comment">// 如果是true，则都可以访问，比方说meethigher.com:3000</span></span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认打开本地的浏览器</span></span><br><span class="line">        open:<span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        <span class="comment">// 启动gzip压缩</span></span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 端口号</span></span><br><span class="line">        port: <span class="number">8080</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="四、webpack优化配置"><a href="#四、webpack优化配置" class="headerlink" title="四、webpack优化配置"></a>四、webpack优化配置</h1><h2 id="4-1-HMR"><a href="#4-1-HMR" class="headerlink" title="4.1 HMR"></a>4.1 HMR</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 问题：只修改部分内容，结果所有内容都重新加载</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * HMR:hot module replacement 热模块替换/模块热替换</span></span><br><span class="line"><span class="comment"> * 作用：一个模块发生变化，只会重新打包这一个模块，而不是打包所有</span></span><br><span class="line"><span class="comment"> * 极大地提升构建速度</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 样式文件：可以使用HMR，因为style-loader内部实现了</span></span><br><span class="line"><span class="comment"> * js文件：默认没HMR功能-&gt;需要修改js代码，添加支持HMR功能的代码</span></span><br><span class="line"><span class="comment"> *   只能处理非入口js文件</span></span><br><span class="line"><span class="comment"> * html文件：默认没HMR功能，同时会导致问题-&gt;html不能热更新了(因为实际使用中只有一个index.html，不像js有多个模块，所以不用做hmr功能)</span></span><br><span class="line"><span class="comment"> *   解决：修改entry入口，将html文件引入，但是会全部刷新</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="string">"./src/js/index.js"</span>,<span class="string">"./src/index.html"</span>],</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'js/built.js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// loader的配置</span></span><br><span class="line">            <span class="comment">// 处理less资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,</span><br><span class="line">                    <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理css资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jpg||png||gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 设置使用commonjs，不使用es</span></span><br><span class="line">                    esModule: <span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">//将图片输出到imgs文件夹</span></span><br><span class="line">                    outputPath:<span class="string">"imgs"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的img资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude: <span class="regexp">/\.(html|css|js|less|jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 将其他资源输出到media文件夹</span></span><br><span class="line">                    outputPath:<span class="string">"media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// plugins的配置</span></span><br><span class="line">        <span class="comment">// 相当于是引入一个模板</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"../css/index.less"</span>;</span><br><span class="line"><span class="keyword">import</span> print <span class="keyword">from</span> <span class="string">"./print.js"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"index.js被加载了"</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString());</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line">print();</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局找hot属性，一旦为true，说明开启了HMR功能，-&gt;让HMR功能生效</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot)&#123;</span><br><span class="line">    <span class="comment">// 如果后续还有其他模块，同样的方法</span></span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">"./print.js"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 方法会监听 print.js文件的变化，一旦发生变化，其他模块不会重新打包构建</span></span><br><span class="line">        <span class="comment">//会执行后面的回调函数</span></span><br><span class="line">        print();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-source-map"><a href="#4-2-source-map" class="headerlink" title="4.2 source-map"></a>4.2 source-map</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="string">"./src/js/index.js"</span>, <span class="string">"./src/index.html"</span>],</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'js/built.js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// loader的配置</span></span><br><span class="line">            <span class="comment">// 处理less资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,</span><br><span class="line">                    <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理css资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jpg||png||gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 设置使用commonjs，不使用es</span></span><br><span class="line">                    esModule: <span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">//将图片输出到imgs文件夹</span></span><br><span class="line">                    outputPath: <span class="string">"imgs"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的img资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude: <span class="regexp">/\.(html|css|js|less|jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 将其他资源输出到media文件夹</span></span><br><span class="line">                    outputPath: <span class="string">"media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// plugins的配置</span></span><br><span class="line">        <span class="comment">// 相当于是引入一个模板</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// source-map:一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射关系可以追踪到源代码错误）</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 参数</span></span><br><span class="line"><span class="comment">     * [inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * source-map：外部</span></span><br><span class="line"><span class="comment">     *   错误代码准确信息和源代码的错误位置</span></span><br><span class="line"><span class="comment">     * inline-source-map：内联，只生成一个内联的source-map</span></span><br><span class="line"><span class="comment">     *   错误代码准确信息和源代码的错误位置</span></span><br><span class="line"><span class="comment">     * hidden-source-map：外部</span></span><br><span class="line"><span class="comment">     *   错误代码错误原因，但是没有错误位置，不能追踪到源代码的错误，只能提示到构建后代码的位置</span></span><br><span class="line"><span class="comment">     * eval-source-map：也是内联，每一个文件都生成一个source-map   </span></span><br><span class="line"><span class="comment">     *   错误代码准确信息和源代码的错误位置，文件名后缀多了哈希值</span></span><br><span class="line"><span class="comment">     * nosources-source-map：外部</span></span><br><span class="line"><span class="comment">     *   错误代码准确信息，没有任何源代码信息</span></span><br><span class="line"><span class="comment">     * cheap-source-map：外部</span></span><br><span class="line"><span class="comment">     *   错误代码准确信息和源代码的错误位置，错误只能精确到行，不能精确到列</span></span><br><span class="line"><span class="comment">     * cheap-module-source-map：外部</span></span><br><span class="line"><span class="comment">     *   错误代码准确信息和源代码的错误位置，错误只能精确到行，不能精确到列</span></span><br><span class="line"><span class="comment">     *   module会将loader的source-map也加进来</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 内联和外部：</span></span><br><span class="line"><span class="comment">     * 1. 外部生成的文件，内联是没有的</span></span><br><span class="line"><span class="comment">     * 2. 内联速度更快</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 开发环境：速度快，调试更友好</span></span><br><span class="line"><span class="comment">     *   速度快：eval&gt;inline&gt;cheap&gt;...</span></span><br><span class="line"><span class="comment">     *     eval-cheap-source-map&gt;eval-source-map</span></span><br><span class="line"><span class="comment">     *   调试更友好：</span></span><br><span class="line"><span class="comment">     *     source-map&gt;cheap-module-source-map&gt;cheap-source-map</span></span><br><span class="line"><span class="comment">     *   一般使用eval-source-map/eval-cheap-module-source-map</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 生产环境：源代码要不要隐藏？调试要不要更友好？</span></span><br><span class="line"><span class="comment">     *   内联会让代码体积变大，所以在生产环境不用内联</span></span><br><span class="line"><span class="comment">     *   隐藏源代码↓</span></span><br><span class="line"><span class="comment">     *   nosources-source-map</span></span><br><span class="line"><span class="comment">     *   hidden-source-map</span></span><br><span class="line"><span class="comment">     *   一般使用source-map/cheap-module-source-map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    devtool: <span class="string">"inline-source-map"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="4-3-oneOf"><a href="#4-3-oneOf" class="headerlink" title="4.3 oneOf"></a>4.3 oneOf</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复用loader</span></span><br><span class="line"><span class="keyword">const</span> commonCssLoader = [</span><br><span class="line">    miniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    <span class="comment">// 兼容性处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在package.json中需要配置browserslist</span></span><br><span class="line">        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ident: <span class="string">"postcss"</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"js/built.js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// js语法检查</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 正常来讲，一个文件只能被一个loader处理</span></span><br><span class="line"><span class="comment">             * 当一个文件要被多个loader处理时，那么一定要指定loader执行的先后顺序</span></span><br><span class="line"><span class="comment">             * 先执行eslint，再执行babel</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 在package.json中需要配置eslintConfig-&gt;airbnb</span></span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader: <span class="string">"eslint-loader"</span>,</span><br><span class="line">                <span class="comment">// 自动修复语法</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    fix: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 优先执行</span></span><br><span class="line">                enforce: <span class="string">"pre"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//以下loader只会匹配一个，用来优化打包速度</span></span><br><span class="line">                <span class="comment">//注意：不能有两个配置处理同一种类型文件，所以需要将重复内容提取出来</span></span><br><span class="line">                oneOf: [</span><br><span class="line">                    <span class="comment">//提取css文件</span></span><br><span class="line">                    <span class="comment">// 兼容性处理</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                            ...commonCssLoader</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                            ...commonCssLoader,</span><br><span class="line">                            <span class="string">"less-loader"</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// js兼容性处理</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                        loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            presets: [</span><br><span class="line">                                [</span><br><span class="line">                                    <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        useBuiltIns: <span class="string">"usage"</span>,</span><br><span class="line">                                        corejs: &#123; <span class="attr">version</span>: <span class="number">3</span> &#125;,</span><br><span class="line">                                        targets: &#123;</span><br><span class="line">                                            chrome: <span class="string">"60"</span>,</span><br><span class="line">                                            firefox: <span class="string">"50"</span>,</span><br><span class="line">                                            ie: <span class="string">"9"</span>,</span><br><span class="line">                                            safari: <span class="string">"10"</span>,</span><br><span class="line">                                            edge: <span class="string">"17"</span></span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                ],</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理图片</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                        loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">8</span> * <span class="number">1024</span>,<span class="comment">//8kb以下进行base64处理</span></span><br><span class="line">                            name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                            outputPath: <span class="string">"imgs"</span>,</span><br><span class="line">                            esModule: <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理html中的图片</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                        loader: <span class="string">"html-loader"</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理其他文件</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        exclude: <span class="regexp">/\.(js|css|less|html|jpg|png|gif)$/</span>,</span><br><span class="line">                        loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            outputPath: <span class="string">"media"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">"css/built.css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        <span class="comment">// 跳过检查</span></span><br><span class="line">        <span class="comment">// 如果是false，则只能访问localhost:3000,</span></span><br><span class="line">        <span class="comment">// 如果是true，则都可以访问，比方说meethigher.com:3000</span></span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认打开本地的浏览器</span></span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        <span class="comment">// 启动gzip压缩</span></span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 端口号</span></span><br><span class="line">        port: <span class="number">8080</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4-缓存"><a href="#4-4-缓存" class="headerlink" title="4.4 缓存"></a>4.4 缓存</h2><p>server.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**服务器代码</span></span><br><span class="line"><span class="comment"> * 启动服务器指令</span></span><br><span class="line"><span class="comment"> * npm install nodemon -g</span></span><br><span class="line"><span class="comment"> * nodemon server.js</span></span><br><span class="line"><span class="comment"> * 或者</span></span><br><span class="line"><span class="comment"> * node server.js </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">"build"</span>,&#123;</span><br><span class="line">    maxAge:<span class="number">1000</span>*<span class="number">3600</span></span><br><span class="line">&#125;));</span><br><span class="line">app.listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 缓存</span></span><br><span class="line"><span class="comment"> *   1. babel缓存</span></span><br><span class="line"><span class="comment"> *     cacheDirectory:true</span></span><br><span class="line"><span class="comment"> *     --&gt;让第二次打包构建速度更快</span></span><br><span class="line"><span class="comment"> *   2. 文件资源缓存，文件名添加哈希值</span></span><br><span class="line"><span class="comment"> *     hash</span></span><br><span class="line"><span class="comment"> *     问题：因为js和css同时使用一个哈希值，如果重新打包，会导致所有缓存失效（可能只改动了一个文件）</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *     chunkhash：根据chunk生成的hash，如果打包来源于同一个chunk，那么hash就一样</span></span><br><span class="line"><span class="comment"> *     问题：js和css的hash还是一样的</span></span><br><span class="line"><span class="comment"> *         因为css是在js中被引入的，同属于一个chunk</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *     contenthash：根据文件内容生成hash。不同文件hash一定不一样</span></span><br><span class="line"><span class="comment"> *     --&gt;让代码上线运行缓存更好使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复用loader</span></span><br><span class="line"><span class="keyword">const</span> commonCssLoader = [</span><br><span class="line">    miniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    <span class="comment">// 兼容性处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在package.json中需要配置browserslist</span></span><br><span class="line">        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ident: <span class="string">"postcss"</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="string">"./src/js/index.js"</span>, <span class="string">"./src/index.html"</span>],</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'js/built.[contenthash:10].js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// js语法检查</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 正常来讲，一个文件只能被一个loader处理</span></span><br><span class="line"><span class="comment">             * 当一个文件要被多个loader处理时，那么一定要指定loader执行的先后顺序</span></span><br><span class="line"><span class="comment">             * 先执行eslint，再执行babel</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 在package.json中需要配置eslintConfig-&gt;airbnb</span></span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader: <span class="string">"eslint-loader"</span>,</span><br><span class="line">                <span class="comment">// 自动修复语法</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    fix: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 优先执行</span></span><br><span class="line">                enforce: <span class="string">"pre"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//以下loader只会匹配一个，用来优化打包速度</span></span><br><span class="line">                <span class="comment">//注意：不能有两个配置处理同一种类型文件，所以需要将重复内容提取出来</span></span><br><span class="line">                oneOf: [</span><br><span class="line">                    <span class="comment">//提取css文件</span></span><br><span class="line">                    <span class="comment">// 兼容性处理</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                            ...commonCssLoader</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                            ...commonCssLoader,</span><br><span class="line">                            <span class="string">"less-loader"</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// js兼容性处理</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                        loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            presets: [</span><br><span class="line">                                [</span><br><span class="line">                                    <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        useBuiltIns: <span class="string">"usage"</span>,</span><br><span class="line">                                        corejs: &#123; <span class="attr">version</span>: <span class="number">3</span> &#125;,</span><br><span class="line">                                        targets: &#123;</span><br><span class="line">                                            chrome: <span class="string">"60"</span>,</span><br><span class="line">                                            firefox: <span class="string">"50"</span>,</span><br><span class="line">                                            ie: <span class="string">"9"</span>,</span><br><span class="line">                                            safari: <span class="string">"10"</span>,</span><br><span class="line">                                            edge: <span class="string">"17"</span></span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                ],</span><br><span class="line">                            ],</span><br><span class="line">                            <span class="comment">// 开启babel缓存</span></span><br><span class="line">                            cacheDirectory:<span class="literal">true</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理图片</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                        loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">8</span> * <span class="number">1024</span>,<span class="comment">//8kb以下进行base64处理</span></span><br><span class="line">                            name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                            outputPath: <span class="string">"/imgs"</span>,</span><br><span class="line">                            esModule: <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理html中的图片</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                        loader: <span class="string">"html-loader"</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理其他文件</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        exclude: <span class="regexp">/\.(js|css|less|html|jpg|png|gif)$/</span>,</span><br><span class="line">                        loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            outputPath: <span class="string">"/media"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">"css/built.[contenthash:10].css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// source-map:一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射关系可以追踪到源代码错误）</span></span><br><span class="line">    devtool: <span class="string">"inline-source-map"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="4-5-tree-shaking"><a href="#4-5-tree-shaking" class="headerlink" title="4.5 tree shaking"></a>4.5 tree shaking</h2><p>目的：去掉无用的代码</p><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * tree shaking：去除无用代码</span></span><br><span class="line"><span class="comment"> *  前提：1. 必须使用es6模块化 2. 开启production环境</span></span><br><span class="line"><span class="comment"> *  作用：减少代码体积</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  在package.json中配置"sideEffects":false，表示所有代码都没有副作用，都可以进行treeshaking</span></span><br><span class="line"><span class="comment"> *  问题：可能会把css/<span class="doctag">@babel</span>/polyfill干掉，因为没有使用</span></span><br><span class="line"><span class="comment"> *  可以进行标记</span></span><br><span class="line"><span class="comment"> *  "sideEffects":["*.css","*.less"]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复用loader</span></span><br><span class="line"><span class="keyword">const</span> commonCssLoader = [</span><br><span class="line">    miniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    <span class="comment">// 兼容性处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在package.json中需要配置browserslist</span></span><br><span class="line">        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ident: <span class="string">"postcss"</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="string">"./src/js/index.js"</span>, <span class="string">"./src/index.html"</span>],</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'js/built.[contenthash:10].js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// js语法检查</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 正常来讲，一个文件只能被一个loader处理</span></span><br><span class="line"><span class="comment">             * 当一个文件要被多个loader处理时，那么一定要指定loader执行的先后顺序</span></span><br><span class="line"><span class="comment">             * 先执行eslint，再执行babel</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 在package.json中需要配置eslintConfig-&gt;airbnb</span></span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader: <span class="string">"eslint-loader"</span>,</span><br><span class="line">                <span class="comment">// 自动修复语法</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    fix: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 优先执行</span></span><br><span class="line">                enforce: <span class="string">"pre"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//以下loader只会匹配一个，用来优化打包速度</span></span><br><span class="line">                <span class="comment">//注意：不能有两个配置处理同一种类型文件，所以需要将重复内容提取出来</span></span><br><span class="line">                oneOf: [</span><br><span class="line">                    <span class="comment">//提取css文件</span></span><br><span class="line">                    <span class="comment">// 兼容性处理</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                            ...commonCssLoader</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                        use: [</span><br><span class="line">                            ...commonCssLoader,</span><br><span class="line">                            <span class="string">"less-loader"</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// js兼容性处理</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                        loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            presets: [</span><br><span class="line">                                [</span><br><span class="line">                                    <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        useBuiltIns: <span class="string">"usage"</span>,</span><br><span class="line">                                        corejs: &#123; <span class="attr">version</span>: <span class="number">3</span> &#125;,</span><br><span class="line">                                        targets: &#123;</span><br><span class="line">                                            chrome: <span class="string">"60"</span>,</span><br><span class="line">                                            firefox: <span class="string">"50"</span>,</span><br><span class="line">                                            ie: <span class="string">"9"</span>,</span><br><span class="line">                                            safari: <span class="string">"10"</span>,</span><br><span class="line">                                            edge: <span class="string">"17"</span></span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                ],</span><br><span class="line">                            ],</span><br><span class="line">                            <span class="comment">// 开启babel缓存</span></span><br><span class="line">                            cacheDirectory:<span class="literal">true</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理图片</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                        loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">8</span> * <span class="number">1024</span>,<span class="comment">//8kb以下进行base64处理</span></span><br><span class="line">                            name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                            outputPath: <span class="string">"/imgs"</span>,</span><br><span class="line">                            esModule: <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理html中的图片</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                        loader: <span class="string">"html-loader"</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 处理其他文件</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        exclude: <span class="regexp">/\.(js|css|less|html|jpg|png|gif)$/</span>,</span><br><span class="line">                        loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            outputPath: <span class="string">"/media"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">"css/built.[contenthash:10].css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// source-map:一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射关系可以追踪到源代码错误）</span></span><br><span class="line">    devtool: <span class="string">"inline-source-map"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="4-6-code-split"><a href="#4-6-code-split" class="headerlink" title="4.6 code split"></a>4.6 code split</h2><ol><li>单入口、多入口输出。单入口输出一个bundle；多入口输出多个bundle</li><li>通过optimization</li><li>通过js动态导入语法</li></ol><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">"jquery"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> args.reduce(<span class="function">(<span class="params">p, c</span>) =&gt;</span> p + c, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// eslint-disable-next-line</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line"><span class="comment">// eslint-disable-next-line</span></span><br><span class="line"><span class="built_in">console</span>.log($);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过js代码，让某个文件被单独打包成一个chunk</span></span><br><span class="line"><span class="comment"> * import动态导入语法：能将某个文件单独打包</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * webpackChunkName:'xxx'设置打包之后的名字，如果不设置，默认是以chunk的id值来命名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName:'js动态导入' */</span><span class="string">"./test"</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">&#123; mul, count &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//文件加载成功</span></span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="built_in">console</span>.log(mul(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件加载失败"</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>test.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mul</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x - y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 单入口</span></span><br><span class="line">    <span class="comment">// entry: "./src/js/index.js",</span></span><br><span class="line">    <span class="comment">// 多入口js:有一个入口，最终输出就有一个bundle；有多个，输出就会有多个</span></span><br><span class="line">    entry: &#123; </span><br><span class="line">        index: <span class="string">"./src/js/index.js"</span>, </span><br><span class="line">        test: <span class="string">"./src/js/test.js"</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// [name]：取文件名</span></span><br><span class="line">        filename: <span class="string">'js/[name].[contenthash:10].js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// loader的配置</span></span><br><span class="line">            <span class="comment">// 处理less资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,</span><br><span class="line">                    <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理css资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jpg||png||gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 设置使用commonjs，不使用es</span></span><br><span class="line">                    esModule: <span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">//将图片输出到imgs文件夹</span></span><br><span class="line">                    outputPath: <span class="string">"imgs"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的img资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude: <span class="regexp">/\.(html|css|js|less|jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 将其他资源输出到media文件夹</span></span><br><span class="line">                    outputPath: <span class="string">"media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单入口时，可以设置下面代码，将node_modules中代码单独打包成一个chunk最终输出</span></span><br><span class="line"><span class="comment">     * 多入口时，自动分析多入口chunk中，有没有公共的文件（如果文件太小，还是会打包成一个整的）。如果有，会打包成一个单独的chunk</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    optimization:&#123;</span><br><span class="line">        splitChunks:&#123;</span><br><span class="line">            chunks:<span class="string">"all"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="4-7-js文件懒加载与预加载"><a href="#4-7-js文件懒加载与预加载" class="headerlink" title="4.7 js文件懒加载与预加载"></a>4.7 js文件懒加载与预加载</h2><p>关于html的dom加载顺序，可以参照本文最上面的defer与async</p><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// [name]：取文件名</span></span><br><span class="line">        filename: <span class="string">'js/[name].[contenthash:10].js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// loader的配置</span></span><br><span class="line">            <span class="comment">// 处理less资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span>,</span><br><span class="line">                    <span class="string">'less-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理css资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">'style-loader'</span>,</span><br><span class="line">                    <span class="string">'css-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jpg||png||gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 设置使用commonjs，不使用es</span></span><br><span class="line">                    esModule: <span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">//将图片输出到imgs文件夹</span></span><br><span class="line">                    outputPath: <span class="string">"imgs"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的img资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他资源</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude: <span class="regexp">/\.(html|css|js|less|jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    <span class="comment">// 将其他资源输出到media文件夹</span></span><br><span class="line">                    outputPath: <span class="string">"media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单入口时，可以设置下面代码，将node_modules中代码单独打包成一个chunk最终输出</span></span><br><span class="line"><span class="comment">     * 多入口时，自动分析多入口chunk中，有没有公共的文件（如果文件太小，还是会打包成一个整的）。如果有，会打包成一个单独的chunk</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    optimization:&#123;</span><br><span class="line">        splitChunks:&#123;</span><br><span class="line">            chunks:<span class="string">"all"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>开发环境配置<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./media/img3.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://meethigher.obs.cn-north-4.myhuaweicloud.com:443/OBSBrowserPlus-HEC-win64.zip?AccessKeyId=MJXE1SVRAHUR4INU2JVX&amp;Expires=1594782807&amp;Signature=mAW9elrLaTdqoxFk%2BDJDOs42gMg%3D"</span> <span class="attr">download</span>=<span class="string">"下载.zip"</span>&gt;</span>点击下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"indexjs文件被加载了"</span>);</span><br><span class="line"><span class="comment">// import &#123;mul&#125; from "./test";</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 懒加载：当文件需要使用时，才加载文件。这个方法不会进行重复加载，第一次加载之后，就会将数据保存到缓存</span></span><br><span class="line">    <span class="comment">// 预加载：会在使用之前，提前加载js文件</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 正常加载可以认为是并行加载，同一时间加载多个js文件，文件即使不用，也会加载</span></span><br><span class="line"><span class="comment">     * 预加载是等其他资源加载完毕，浏览器空闲了，再进行加载。兼容性非常差，目前只适用于pc端主流浏览器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="comment">/*webpackChunkName:"test",webpackPrefetch:true*/</span><span class="string">"./test"</span>).then(<span class="function">(<span class="params">&#123; mul &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(mul(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"失败"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>test.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"testjs被加载"</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mul</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x*y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-8-PWA"><a href="#4-8-PWA" class="headerlink" title="4.8 PWA"></a>4.8 PWA</h2><p>参考资料：</p><ol><li><a href="https://linwhitehat.github.io/Blog/2020/02/09/Hexo%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2PWA.html" target="_blank" rel="noopener">Hexo博客部署PWA</a></li><li><a href="https://diygod.me/2954/" target="_blank" rel="noopener">Service Workers 实现网站加速和离线缓存</a></li></ol><p>安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install workbox<span class="literal">-webpack</span><span class="literal">-plugin</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PWA：渐进式网络开发应用程序（离线可访问）</span></span><br><span class="line"><span class="comment"> *  workbox(google开源)--&gt;workbox-webpack-plugin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> workboxWebpackPlugin=<span class="built_in">require</span>(<span class="string">"workbox-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin=<span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpackPlugin=<span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"><span class="comment">// 复用loader</span></span><br><span class="line"><span class="keyword">const</span> commonCssLoader = [</span><br><span class="line">    miniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    <span class="comment">// 兼容性处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在package.json中需要配置browserslist</span></span><br><span class="line">        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ident: <span class="string">"postcss"</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// [name]：取文件名</span></span><br><span class="line">        filename: <span class="string">'js/[name].[contenthash:10].js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">//提取css文件</span></span><br><span class="line">            <span class="comment">// 兼容性处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    ...commonCssLoader</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    ...commonCssLoader,</span><br><span class="line">                    <span class="string">"less-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// js兼容性处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader:<span class="string">"babel-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    presets:[</span><br><span class="line">                        [</span><br><span class="line">                            <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                            &#123;</span><br><span class="line">                                useBuiltIns:<span class="string">"usage"</span>,</span><br><span class="line">                                corejs:&#123;<span class="attr">version</span>:<span class="number">3</span>&#125;,</span><br><span class="line">                                targets:&#123;</span><br><span class="line">                                    chrome:<span class="string">"60"</span>,</span><br><span class="line">                                    firefox:<span class="string">"50"</span>,</span><br><span class="line">                                    ie:<span class="string">"9"</span>,</span><br><span class="line">                                    safari:<span class="string">"10"</span>,</span><br><span class="line">                                    edge:<span class="string">"17"</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ],</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                loader:<span class="string">"url-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    limit:<span class="number">8</span>*<span class="number">1024</span>,<span class="comment">//8kb以下进行base64处理</span></span><br><span class="line">                    name:<span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    outputPath:<span class="string">"/imgs"</span>,</span><br><span class="line">                    esModule:<span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的图片</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader:<span class="string">"html-loader"</span>, </span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他文件</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude:<span class="regexp">/\.(js|css|less|html|jpg|png|gif)$/</span>,</span><br><span class="line">                loader:<span class="string">"file-loader"</span>,</span><br><span class="line">                options:&#123;</span><br><span class="line">                    outputPath:<span class="string">"/media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">"css/built.css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 使用</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1. 帮助ServiceWorker快点启动</span></span><br><span class="line"><span class="comment">         * 2. 删除旧的ServiceWorker</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * 最终生成ServiceWorker的配置文件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">new</span> workboxWebpackPlugin.GenerateSW(&#123;</span><br><span class="line">            clientsClaim:<span class="literal">true</span>,</span><br><span class="line">            skipWaiting:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单入口时，可以设置下面代码，将node_modules中代码单独打包成一个chunk最终输出</span></span><br><span class="line"><span class="comment">     * 多入口时，自动分析多入口chunk中，有没有公共的文件（如果文件太小，还是会打包成一个整的）。如果有，会打包成一个单独的chunk</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    optimization:&#123;</span><br><span class="line">        splitChunks:&#123;</span><br><span class="line">            chunks:<span class="string">"all"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"../css/index.less"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"indexjs文件被加载了"</span>);</span><br><span class="line"><span class="comment">// import &#123;mul&#125; from "./test";</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 懒加载：当文件需要使用时，才加载文件。这个方法不会进行重复加载，第一次加载之后，就会将数据保存到缓存</span></span><br><span class="line">    <span class="comment">// 预加载：会在使用之前，提前加载js文件</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 正常加载可以认为是并行加载，同一时间加载多个js文件，文件即使不用，也会加载</span></span><br><span class="line"><span class="comment">     * 预加载是等其他资源加载完毕，浏览器空闲了，再进行加载。兼容性非常差，目前只适用于pc端主流浏览器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="comment">/*webpackChunkName:"test",webpackPrefetch:true*/</span><span class="string">"./test"</span>).then(<span class="function">(<span class="params">&#123; mul &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">        <span class="built_in">console</span>.log(mul(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"失败"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注册ServiceWorker</span></span><br><span class="line"><span class="comment">// 处理兼容性问题</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. exlint不认识window、navigator全局变量</span></span><br><span class="line"><span class="comment"> *   解决：需要package.json中eslintConfig配置</span></span><br><span class="line"><span class="comment"> * "env":&#123;</span></span><br><span class="line"><span class="comment"> *      "browser":true</span></span><br><span class="line"><span class="comment"> *  &#125;</span></span><br><span class="line"><span class="comment"> * 2. sw必须运行在服务器上</span></span><br><span class="line"><span class="comment"> *  解决：1.nodejs</span></span><br><span class="line"><span class="comment"> *        2.npm i server -g</span></span><br><span class="line"><span class="comment"> *         通过命令server -s build，启动服务器,将build目录下所有资源作为静态资源暴露出去</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"serviceWorker"</span> <span class="keyword">in</span> navigator)&#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>,()=&gt;&#123;</span><br><span class="line">        navigator.serviceWorker.register(<span class="string">"/service-worker.js"</span>).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">            alert(<span class="string">"sw注册成功"</span>);</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">            alert(<span class="string">"sw注册失败"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>问题：</p><p>在eslint语法检测时，出现import和export必须放在顶部的错误，该错误暂未解决。</p></blockquote><h2 id="4-9-多进程打包"><a href="#4-9-多进程打包" class="headerlink" title="4.9 多进程打包"></a>4.9 多进程打包</h2><p>安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install th<span class="built_in">read-loader</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>将某个loader放到thread-loader的后面，就会对该loader进行多进程打包</p><p>下面，以多进程打包js兼容性处理为例</p><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> workboxWebpackPlugin = <span class="built_in">require</span>(<span class="string">"workbox-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> optimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置nodejs的环境变量，此处是用来设置package.json中browserlist以什么模式来兼容</span></span><br><span class="line">process.env.NODE_ENV = <span class="string">"production"</span>;</span><br><span class="line"><span class="comment">// 复用loader</span></span><br><span class="line"><span class="keyword">const</span> commonCssLoader = [</span><br><span class="line">    miniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    <span class="comment">// 兼容性处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在package.json中需要配置browserslist</span></span><br><span class="line">        loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ident: <span class="string">"postcss"</span>,</span><br><span class="line">            plugins: <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"postcss-preset-env"</span>)()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// [name]：取文件名</span></span><br><span class="line">        filename: <span class="string">'js/[name].[contenthash:10].js'</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">//提取css文件</span></span><br><span class="line">            <span class="comment">// 兼容性处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    ...commonCssLoader</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    ...commonCssLoader,</span><br><span class="line">                    <span class="string">"less-loader"</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// js兼容性处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 开启多线程打包</span></span><br><span class="line"><span class="comment">                     * 进程启动大概为600ms，进程通信也有开销</span></span><br><span class="line"><span class="comment">                     * 只有工作消耗时间比较长的时候，才需要多进程打包</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="comment">// "thread-loadaer",</span></span><br><span class="line">                    <span class="comment">//也可以进行详细配置</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        loader:<span class="string">"thread-loader"</span>,</span><br><span class="line">                        options:&#123;</span><br><span class="line">                            workers:<span class="number">2</span> <span class="comment">//进程2个</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            presets: [</span><br><span class="line">                                [</span><br><span class="line">                                    <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        useBuiltIns: <span class="string">"usage"</span>,</span><br><span class="line">                                        corejs: &#123; <span class="attr">version</span>: <span class="number">3</span> &#125;,</span><br><span class="line">                                        targets: &#123;</span><br><span class="line">                                            chrome: <span class="string">"60"</span>,</span><br><span class="line">                                            firefox: <span class="string">"50"</span>,</span><br><span class="line">                                            ie: <span class="string">"9"</span>,</span><br><span class="line">                                            safari: <span class="string">"10"</span>,</span><br><span class="line">                                            edge: <span class="string">"17"</span></span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                ],</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理图片</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"url-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8</span> * <span class="number">1024</span>,<span class="comment">//8kb以下进行base64处理</span></span><br><span class="line">                    name: <span class="string">"[hash:10].[ext]"</span>,</span><br><span class="line">                    outputPath: <span class="string">"/imgs"</span>,</span><br><span class="line">                    esModule: <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理html中的图片</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 处理其他文件</span></span><br><span class="line">            &#123;</span><br><span class="line">                exclude: <span class="regexp">/\.(js|css|less|html|jpg|png|gif)$/</span>,</span><br><span class="line">                loader: <span class="string">"file-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    outputPath: <span class="string">"/media"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> miniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">"css/built.css"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//压缩css</span></span><br><span class="line">        <span class="keyword">new</span> optimizeCssAssetsWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./src/index.html"</span>,</span><br><span class="line">            <span class="comment">// 压缩html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 使用</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1. 帮助ServiceWorker快点启动</span></span><br><span class="line"><span class="comment">         * 2. 删除旧的ServiceWorker</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * 最终生成ServiceWorker的配置文件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">new</span> workboxWebpackPlugin.GenerateSW(&#123;</span><br><span class="line">            clientsClaim: <span class="literal">true</span>,</span><br><span class="line">            skipWaiting: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单入口时，可以设置下面代码，将node_modules中代码单独打包成一个chunk最终输出</span></span><br><span class="line"><span class="comment">     * 多入口时，自动分析多入口chunk中，有没有公共的文件（如果文件太小，还是会打包成一个整的）。如果有，会打包成一个单独的chunk</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">"all"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="comment">// devServer</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        contentBase: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能，并重启服务</span></span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="4-10-externals"><a href="#4-10-externals" class="headerlink" title="4.10 externals"></a>4.10 externals</h2><p>可以用来拒绝某些库的打包进入（某些情况下，通过cdn来引入库会更快一点）</p><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin=<span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"js/build.js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="comment">// plugins的配置</span></span><br><span class="line">        <span class="comment">// html-webpack-plugin</span></span><br><span class="line">        <span class="comment">// 功能：默认会创建一个Html文件，引入打包输出的所有资源（js/css）</span></span><br><span class="line">        <span class="comment">// 需求：需要有结构的html文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="comment">// 复制"./src/index.html",并自动引入打包输出的所有资源（js/css）</span></span><br><span class="line">            template:<span class="string">"./src/index.html"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"production"</span>,</span><br><span class="line">    externals:&#123;</span><br><span class="line">        <span class="comment">// 忽略库名以及对应的npm下载的包名</span></span><br><span class="line">        <span class="comment">// 拒绝jquery这个包被打包进来</span></span><br><span class="line">        jquery:<span class="string">"jQuery"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-11-dll"><a href="#4-11-dll" class="headerlink" title="4.11 dll"></a>4.11 dll</h2><p>dll：动态连接库</p><p>对某些库进行打包，并自动添加到html中。可以理解成跟externals相反。</p><p>安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="built_in">add-asset</span><span class="literal">-html</span><span class="literal">-webpack</span><span class="literal">-plugin</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>webpack.dll.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用dll技术，对某些库（第三方库，如jquery、react、vue...）进行单独打包</span></span><br><span class="line"><span class="comment"> * 当使用webpack命令时，默认查找webpack.config.js文件 </span></span><br><span class="line"><span class="comment"> * 而我们需要运行webpack.dll.js，所以指令要改成 webpack --config webpack.dll.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125;=<span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> webpack=<span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:&#123;</span><br><span class="line">        <span class="comment">//最终打包生成的[name]是jquery</span></span><br><span class="line">        <span class="comment">//["jquery"]-&gt;要打包的库是jquery </span></span><br><span class="line">        jquery:[<span class="string">"jquery"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"[name].js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"dll"</span>),</span><br><span class="line">        library:<span class="string">"[name]_[hash]"</span>,<span class="comment">//打包的库向外暴露出的库的名字</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="comment">// 打包生成manifest.json-&gt;提供jquery的映射关系</span></span><br><span class="line">        <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">            name:<span class="string">"[name]_[hash]"</span>,<span class="comment">//映射库的暴露的内容名称</span></span><br><span class="line">            path:resolve(__dirname,<span class="string">"dll/manifest.json"</span>),<span class="comment">//输出文件路径</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"production"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行命令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack -<span class="literal">-config</span> webpack.dll.js</span><br></pre></td></tr></table></figure><h2 id="4-12-总结"><a href="#4-12-总结" class="headerlink" title="4.12 总结"></a>4.12 总结</h2><ul><li>开发环境性能优化<ul><li>优化打包构建速度<ul><li>HMR：针对css、js文件进行热替换。一个模块发生变化，只会重新打包这一个模块，而不是打包所有</li></ul></li><li>优化代码调试<ul><li>source-map：一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射关系可以追踪到源代码错误）</li></ul></li></ul></li><li>生产环境性能优化<ul><li>优化打包构建速度<ul><li>oneOf：其中loader只会匹配一个，用来优化打包速度。就好比搜索内容时，搜索到第一个内容，后面的就不会再考虑了。所以在oneOf中，重复的内容需要单独提取出去。</li><li>babel缓存</li><li>多进程打包</li></ul></li><li>优化代码运行性能<ul><li>文件缓存：hash-&gt;chunkhash-&gt;contenthash</li><li>treeshaking：去除无用代码</li><li>code split：代码分割</li><li>懒加载/预加载</li><li>pwa：离线可访问技术</li><li>externals</li><li>dll</li></ul></li></ul></li></ul><h1 id="五、webpack配置详解"><a href="#五、webpack配置详解" class="headerlink" title="五、webpack配置详解"></a>五、webpack配置详解</h1><h2 id="5-1-entry"><a href="#5-1-entry" class="headerlink" title="5.1 entry"></a>5.1 entry</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * entry:入口起点</span></span><br><span class="line"><span class="comment"> * 1. string-&gt;"./src/index.js" 单入口，打包生成一个chunk。输出一个build文件，此时chunk名称默认为main</span></span><br><span class="line"><span class="comment"> * 2. array-&gt;["./src/index.js","./src/add.js"] 多入口，所有文件最终只会生成一个chunk，输出出去只有一个bundle文件</span></span><br><span class="line"><span class="comment"> *    作用：只有在HMR中，让html热更新生效</span></span><br><span class="line"><span class="comment"> * 3. object 多入口，有几个入口文件，就形成几个chunk，并输出几个bundle文件，此时chunk的名称是key</span></span><br><span class="line"><span class="comment"> *    特殊用法-&gt;看配置</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 第1种和第3种使用较多</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// entry:["./src/index.js","./src/add.js"],</span></span><br><span class="line">    entry:&#123;</span><br><span class="line">        <span class="comment">// 特殊用法</span></span><br><span class="line">        index:[<span class="string">"./src/index.js"</span>,<span class="string">"./src/sub.js"</span>],</span><br><span class="line">        add:<span class="string">"./src/add.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"[name].js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-2-output"><a href="#5-2-output" class="headerlink" title="5.2 output"></a>5.2 output</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        <span class="comment">//文件名称（指定名称+目录）</span></span><br><span class="line">        filename:<span class="string">"[name].js"</span>,</span><br><span class="line">        <span class="comment">// 输出文件目录（将来所有资源输出的公共目录）</span></span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line">        <span class="comment">// 所有资源引入公共路径前缀，如引入路径是"imgs/a.jpg"就会变成"/imgs/a.jpg"</span></span><br><span class="line">        publicPath:<span class="string">"/"</span>,</span><br><span class="line">        <span class="comment">// entry中的就是入口chunk，像import这种就是非入口chunk</span></span><br><span class="line">        chunkFilename:<span class="string">"[name]_chunk.js"</span>,<span class="comment">//非入口chunk的名称,</span></span><br><span class="line">        <span class="comment">// 除非使用dll，正常打包一般不用library</span></span><br><span class="line">        <span class="comment">// library:"[name]",//将库以变量名暴露出去</span></span><br><span class="line">        <span class="comment">// libraryTarget:"window",//将变量名添加到browser上</span></span><br><span class="line">        <span class="comment">// libraryTarget:"global",//将变量名添加到node上</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-3-module"><a href="#5-3-module" class="headerlink" title="5.3 module"></a>5.3 module</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"[name].js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            <span class="comment">// loader配置</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// 多个loader用use</span></span><br><span class="line">                use:[<span class="string">"style-loader"</span>,<span class="string">"css-loader"</span>],</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="comment">// 排除</span></span><br><span class="line">                exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="comment">// 包含</span></span><br><span class="line">                include:resolve(__dirname,<span class="string">"src"</span>),</span><br><span class="line">                <span class="comment">// pre优先执行,post延后执行，不写中间执行</span></span><br><span class="line">                enforce:<span class="string">"pre"</span>,</span><br><span class="line">                <span class="comment">// 单个loader用loader</span></span><br><span class="line">                loader:<span class="string">"eslint-loader"</span>,</span><br><span class="line">                <span class="comment">// 配置，具体看文档</span></span><br><span class="line">                options:&#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 以下配置只会生效一个</span></span><br><span class="line">                oneOf:[]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-4-resolve"><a href="#5-4-resolve" class="headerlink" title="5.4 resolve"></a>5.4 resolve</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    entry:<span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"[name].js"</span>,</span><br><span class="line">        path:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                use:[<span class="string">"style-loader"</span>,<span class="string">"css-loader"</span>],</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode:<span class="string">"development"</span>,</span><br><span class="line">    <span class="comment">// webpack本身是个对象，所以写法顺序无所谓的</span></span><br><span class="line">    resolve:&#123;</span><br><span class="line">        <span class="comment">// 配置解析模块路径别名，优点：写路径时，简写路径。缺点：写代码时没有提示</span></span><br><span class="line">        alias:&#123;</span><br><span class="line">            <span class="comment">// 配置css的绝对路径</span></span><br><span class="line">            $css:resolve(__dirname,<span class="string">"src/css"</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 配置省略文件路径的后缀名</span></span><br><span class="line">        extensions:[<span class="string">".json"</span>,<span class="string">".css"</span>],</span><br><span class="line">        <span class="comment">// 告诉webpack解析模块时去找哪个目录，绝对路径，再写一个node_modules是为了防止找不到</span></span><br><span class="line">        modules:[resolve(__dirname,<span class="string">"../../node_modules"</span>),<span class="string">"node_modules"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-5-devServer"><a href="#5-5-devServer" class="headerlink" title="5.5 devServer"></a>5.5 devServer</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"[name].js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>],</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            $css: resolve(__dirname, <span class="string">"src/css"</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        extensions: [<span class="string">".json"</span>, <span class="string">".css"</span>],</span><br><span class="line">        modules: [resolve(__dirname, <span class="string">"../../node_modules"</span>), <span class="string">"node_modules"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    devServer:&#123;</span><br><span class="line">        <span class="comment">// 运行代码的目录</span></span><br><span class="line">        contentBase:resolve(__dirname,<span class="string">"build"</span>),</span><br><span class="line">        <span class="comment">// 监视ContentBase目录 目录下的所有文件，一旦文件变化就会reload重载</span></span><br><span class="line">        watchContentBase:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 配置</span></span><br><span class="line">        watchOptions:&#123;</span><br><span class="line">            <span class="comment">// 忽略文件</span></span><br><span class="line">            ignored:<span class="regexp">/node_modules/</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 启动gzip压缩</span></span><br><span class="line">        compress:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 端口号</span></span><br><span class="line">        port:<span class="number">8080</span>,</span><br><span class="line">        <span class="comment">// 域名</span></span><br><span class="line">        host:<span class="string">"localhost"</span>,</span><br><span class="line">        <span class="comment">// 自动打开</span></span><br><span class="line">        open:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启hmr功能</span></span><br><span class="line">        hot:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 日志，不要显示启动服务器时的日志</span></span><br><span class="line">        clientLogLevel:<span class="string">"none"</span>,</span><br><span class="line">        <span class="comment">// 除了基本启动信息以外，其他内容都不打印</span></span><br><span class="line">        quiet:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 如果出现错误，不要全屏提示</span></span><br><span class="line">        overlay:<span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// 服务器代理，解决开发环境跨域问题</span></span><br><span class="line">        proxy:&#123;</span><br><span class="line">            <span class="comment">// 一旦服务器8080接收到/api请求，就会自动把请求转发到另一个服务器8000</span></span><br><span class="line">            <span class="string">"/api"</span>:&#123;</span><br><span class="line">                target:<span class="string">"http://localhost:8000"</span>,</span><br><span class="line">                <span class="comment">// 发送请求时，请求路径重写：将/api/xxx--&gt;/xxx(去掉/api)</span></span><br><span class="line">                pathRewrite:&#123;</span><br><span class="line">                    <span class="string">"^/api"</span>:<span class="string">""</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-7-optimization"><a href="#5-7-optimization" class="headerlink" title="5.7 optimization"></a>5.7 optimization</h2><p>webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin=<span class="built_in">require</span>(<span class="string">"terser-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"js/[name].[contenthash].js"</span>,</span><br><span class="line">        path: resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">        chunkFilename:<span class="string">"js/[name].[contenthash].chunk.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>],</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            $css: resolve(__dirname, <span class="string">"src/css"</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        extensions: [<span class="string">".json"</span>, <span class="string">".css"</span>],</span><br><span class="line">        modules: [resolve(__dirname, <span class="string">"../../node_modules"</span>), <span class="string">"node_modules"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    optimization:&#123;</span><br><span class="line">        splitChunks:&#123;</span><br><span class="line">            chunks:<span class="string">"all"</span>,</span><br><span class="line">            <span class="comment">// 以下这些都是默认值，一般也不会修改。所以也可以不写</span></span><br><span class="line">            <span class="comment">// 分割的chunk最小是30kb</span></span><br><span class="line">            minSize:<span class="number">30</span>*<span class="number">1024</span>,</span><br><span class="line">            <span class="comment">// 0表示最大没有限制</span></span><br><span class="line">            maxSize:<span class="number">0</span>,</span><br><span class="line">            <span class="comment">// 要提取的chunk最少被引用一次，如果未被引用，不会提取</span></span><br><span class="line">            minChunks:<span class="number">1</span>,</span><br><span class="line">            <span class="comment">// 按需加载时，并行加载的文件最大数量为5</span></span><br><span class="line">            maxAsyncRequests:<span class="number">5</span>,</span><br><span class="line">            <span class="comment">// 入口js文件最大并行请求数量为3个</span></span><br><span class="line">            maxInitialRequests:<span class="number">3</span>,</span><br><span class="line">            <span class="comment">// 名称连接符是~</span></span><br><span class="line">            automaticNameDelimiter:<span class="string">"~"</span>,</span><br><span class="line">            <span class="comment">// 可以使用命名规则</span></span><br><span class="line">            name:<span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// 分割chunk的组</span></span><br><span class="line">            cacheGroups:&#123;</span><br><span class="line">                <span class="comment">// node_modules中的文件会被打包到vendors这个chunk中。命名--&gt;vendors~xxx.js</span></span><br><span class="line">                <span class="comment">// 同时，也要满足上面的公共规则</span></span><br><span class="line">                vendors:&#123;</span><br><span class="line">                    test:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    <span class="comment">// 优先级</span></span><br><span class="line">                    priority:<span class="number">-10</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">default</span>:&#123;</span><br><span class="line">                    <span class="comment">// 要提取的chunk最少被提取两次</span></span><br><span class="line">                    minChunks:<span class="number">2</span>,</span><br><span class="line">                    <span class="comment">// 优先级</span></span><br><span class="line">                    priority:<span class="number">-20</span>,</span><br><span class="line">                    <span class="comment">// 代码能复用。如果当前要打包的模块和之前已经被提取的模块是同一个，就会复用，而不是重新打包模块</span></span><br><span class="line">                    reuseExistingChunk:<span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * index.js中引用a.js，若a.js发生变化，hash就会变，那么引用a.js的index.js也会变化</span></span><br><span class="line"><span class="comment">         * 下面的代码作用是：将当前模块记录其他模块的hash单独打包成一个文件，叫runtime，这样index.js就不用改了</span></span><br><span class="line"><span class="comment">         * index.js直接引用runtime中的带有hash的内容即可</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        runtimeChunk:&#123;</span><br><span class="line">            name:<span class="function"><span class="params">entrypoint</span>=&gt;</span><span class="string">`runtime-<span class="subst">$&#123;entrypoint.name&#125;</span>`</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 配置生产环境的压缩方案:js和css</span></span><br><span class="line">        <span class="comment">// 将来压缩js就使用这个</span></span><br><span class="line">        minimizer:[</span><br><span class="line">            <span class="keyword">new</span> terserWebpackPlugin(&#123;</span><br><span class="line">                <span class="comment">// 开启缓存</span></span><br><span class="line">                cache:<span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// 开启多进程打包</span></span><br><span class="line">                parallel:<span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// 启动source-map</span></span><br><span class="line">                sourceMap:<span class="literal">true</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="六、webpack5"><a href="#六、webpack5" class="headerlink" title="六、webpack5"></a>六、webpack5</h1><p>虽然目前还没发布，先了解</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init <span class="literal">-y</span> <span class="comment"># 初始化node_modules，并且使用默认配置，-y代表yes</span></span><br></pre></td></tr></table></figure><p>安装webpack5测试版</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack@next webpack<span class="literal">-cli</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure><p>此版本重点关注以下内容:</p><ul><li>通过持久缓存提高构建性能.</li><li>使用更好的算法和默认值来改善长期缓存.</li><li>通过更好的树摇和代码生成来改善捆绑包大小.</li><li>清除处于怪异状态的内部结构，同时在 v4 中实现功能而不引入任何重大更改.</li><li>通过引入重大更改来为将来的功能做准备，以使我们能够尽可能长时间地使用 v5.</li></ul><h2 id="6-1-下载"><a href="#6-1-下载" class="headerlink" title="6.1 下载"></a>6.1 下载</h2><ul><li>npm i webpack@next webpack-cli -D</li></ul><h2 id="6-2-自动删除-Node-js-Polyfills"><a href="#6-2-自动删除-Node-js-Polyfills" class="headerlink" title="6.2 自动删除 Node.js Polyfills"></a>6.2 自动删除 Node.js Polyfills</h2><p>早期，webpack 的目标是允许在浏览器中运行大多数 node.js 模块，但是模块格局发生了变化，许多模块用途现在主要是为前端目的而编写的。webpack &lt;= 4 附带了许多 node.js 核心模块的 polyfill，一旦模块使用任何核心模块（即 crypto 模块），这些模块就会自动应用。</p><p>尽管这使使用为 node.js 编写的模块变得容易，但它会将这些巨大的 polyfill 添加到包中。在许多情况下，这些 polyfill 是不必要的。</p><p>webpack 5 会自动停止填充这些核心模块，并专注于与前端兼容的模块。</p><p>迁移：</p><ul><li>尽可能尝试使用与前端兼容的模块。</li><li>可以为 node.js 核心模块手动添加一个 polyfill。错误消息将提示如何实现该目标。</li></ul><h2 id="6-3-Chunk-和模块-ID"><a href="#6-3-Chunk-和模块-ID" class="headerlink" title="6.3 Chunk 和模块 ID"></a>6.3 Chunk 和模块 ID</h2><p>添加了用于长期缓存的新算法。在生产模式下默认情况下启用这些功能。</p><p><code>chunkIds: &quot;deterministic&quot;, moduleIds: &quot;deterministic&quot;</code></p><h2 id="6-4-Chunk-ID"><a href="#6-4-Chunk-ID" class="headerlink" title="6.4 Chunk ID"></a>6.4 Chunk ID</h2><p>你可以不用使用 <code>import(/* webpackChunkName: &quot;name&quot; */ &quot;module&quot;)</code> 在开发环境来为 chunk 命名，生产环境还是有必要的</p><p>webpack 内部有 chunk 命名规则，不再是以 id(0, 1, 2)命名了</p><h2 id="6-5-Tree-Shaking"><a href="#6-5-Tree-Shaking" class="headerlink" title="6.5 Tree Shaking"></a>6.5 Tree Shaking</h2><ol><li>webpack 现在能够处理对嵌套模块的 tree shaking</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inner.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> inner <span class="keyword">from</span> <span class="string">'./inner'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; inner &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// user.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="built_in">module</span> <span class="keyword">from</span> <span class="string">'./module'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.inner.a);</span><br></pre></td></tr></table></figure><p>在生产环境中, inner 模块暴露的 <code>b</code> 会被删除</p><ol start="2"><li>webpack 现在能够多个模块之前的关系</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; something &#125; <span class="keyword">from</span> <span class="string">'./something'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usingSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> something;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> usingSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当设置了<code>&quot;sideEffects&quot;: false</code>时，一旦发现<code>test</code>方法没有使用，不但删除<code>test</code>，还会删除<code>&quot;./something&quot;</code></p><ol start="3"><li>webpack 现在能处理对 Commonjs 的 tree shaking</li></ol><h2 id="6-6-Output"><a href="#6-6-Output" class="headerlink" title="6.6 Output"></a>6.6 Output</h2><p>webpack 4 默认只能输出 ES5 代码</p><p>webpack 5 开始新增一个属性 output.ecmaVersion, 可以生成 ES5 和 ES6 / ES2015 代码.</p><p>如：<code>output.ecmaVersion: 2015</code></p><h2 id="6-7-SplitChunk"><a href="#6-7-SplitChunk" class="headerlink" title="6.7 SplitChunk"></a>6.7 SplitChunk</h2><p>webpack4中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack4</span></span><br><span class="line">minSize: <span class="number">30000</span>;</span><br></pre></td></tr></table></figure><p>webpack5中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack5</span></span><br><span class="line">minSize: &#123;</span><br><span class="line">  javascript: <span class="number">30000</span>,</span><br><span class="line">  style: <span class="number">50000</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-8-Caching"><a href="#6-8-Caching" class="headerlink" title="6.8 Caching"></a>6.8 Caching</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置缓存</span></span><br><span class="line">cache: &#123;</span><br><span class="line">  <span class="comment">// 磁盘存储</span></span><br><span class="line">  type: <span class="string">"filesystem"</span>,</span><br><span class="line">  buildDependencies: &#123;</span><br><span class="line">    <span class="comment">// 当配置修改时，缓存失效</span></span><br><span class="line">    config: [__filename]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>缓存将存储到 <code>node_modules/.cache/webpack</code></p><h2 id="6-9-监视输出文件"><a href="#6-9-监视输出文件" class="headerlink" title="6.9 监视输出文件"></a>6.9 监视输出文件</h2><p>之前 webpack 总是在第一次构建时输出全部文件，但是监视重新构建时会只更新修改的文件。</p><p>此次更新在第一次构建时会找到输出文件看是否有变化，从而决定要不要输出全部文件。</p><h2 id="6-10-默认值"><a href="#6-10-默认值" class="headerlink" title="6.10 默认值"></a>6.10 默认值</h2><ul><li><code>entry: &quot;./src/index.js</code></li><li><code>output.path: path.resolve(__dirname, &quot;dist&quot;)</code></li><li><code>output.filename: &quot;[name].js&quot;</code></li></ul><h2 id="6-11-更多内容"><a href="#6-11-更多内容" class="headerlink" title="6.11 更多内容"></a>6.11 更多内容</h2><p><a href="https://github.com/webpack/changelog-v5" target="_blank" rel="noopener">https://github.com/webpack/changelog-v5</a></p><h1 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a>七、总结</h1><h2 id="7-1-参考"><a href="#7-1-参考" class="headerlink" title="7.1 参考"></a>7.1 参考</h2><ul><li><a href="https://www.bilibili.com/video/BV1e7411j7T5" target="_blank" rel="noopener">尚硅谷webpack从入门到精通</a></li><li><a href="http://cdn.meethigher.top/media/webpack%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E8%8C%8E%E7%97%9B.pdf" target="_blank" rel="noopener">webpack从入门到茎痛.pdf</a></li><li><a href="https://github.com/meethigher/webpack-notes" target="_blank" rel="noopener">源码</a></li></ul><blockquote><p>npm打包那些事</p><p>我想上传代码到github，但是其中node_modules数据太大了，所以需要在git中忽略掉。</p><p><a href="https://blog.csdn.net/sunxiaoju/article/details/86495234" target="_blank" rel="noopener">git忽略某个目录或文件不上传</a></p></blockquote><h2 id="7-2-小结"><a href="#7-2-小结" class="headerlink" title="7.2 小结"></a>7.2 小结</h2><video src="http://cdn.meethigher.top/media/webpack.mp4" width="100%" controls></video></div><div class="post-detail">发布：2020-07-24 16:00:01<br>修改：2020-07-25 07:31:56<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/webpack/</span><br>标签：<span><a href="/blog/tags/js/">js</a>&nbsp;<a href="/blog/tags/web/">web</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>