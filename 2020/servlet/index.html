<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="Servlet,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="记录Servlet的学习使用过程，另外typora的自带的小表情挺有意思。格式是&lt;strong&gt;:emoji:&lt;/strong&gt;，可惜我这款主题还没添加这个功能，网上有别人写的现成的插件，傲娇的我又不是很想用。打算哪天空闲的时候，自己写一套支持emoji的插件"><title>Servlet</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">Servlet</h2></div><div class="post-content blog-markdown"><p>先附上<a href="https://docs.oracle.com/javaee/7/api/toc.htm" target="_blank" rel="noopener">JavaEE官方文档</a>。</p><p>之前课堂上学过jsp，jsp的每次修改之后不需要重启服务器，而Servlet修改一次需要重启一次。</p><p>servlet和jsp本质都是servlet，运行时都是运行.class文件。但是它们的部署方式不一样。</p><p>servlet是先编译后部署，修改完以后，IDE进行编译，然后部署.class文件到servlet容器中。如果web服务器已启动，则之前class已被servlet容器加载，可能修改后的class文件不会被servlet容器执行。</p><p>而jsp是web服务器进行编译。tomcat可以设置为监视jsp文件的改动，改动之后则重新编译、执行。</p><h1 id="一、入门Servlet"><a href="#一、入门Servlet" class="headerlink" title="一、入门Servlet"></a>一、入门Servlet</h1><p>概念：运行在服务器端的小程序</p><p>本质：Servlet就是一个接口，定义了java类被浏览器访问到（Tomcat识别到）的规则。</p><h2 id="1-1-快速入门"><a href="#1-1-快速入门" class="headerlink" title="1.1 快速入门"></a>1.1 快速入门</h2><ol><li>创建JavaEE项目</li><li>创建类，实现Servlet接口</li><li>实现接口中的抽象方法</li><li>配置Servlet</li></ol><p>配置Servlet，修改WEB-INF下的web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置Servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>demo01_servlet.Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Servlet映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 访问路径，过滤器中这个地方是拦截路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Demo01Servlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet快速入门</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/meethigher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Servlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提供服务的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello Servlet"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问localhost:8080/demo01，然后控制台就会输出Hello Servlet</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/1.png"><blockquote><p>之前一直在用eclipse，最近改用idea，不得不说，真香！</p></blockquote><h1 id="二、详解Servlet"><a href="#二、详解Servlet" class="headerlink" title="二、详解Servlet"></a>二、详解Servlet</h1><h2 id="2-1-执行原理"><a href="#2-1-执行原理" class="headerlink" title="2.1 执行原理"></a>2.1 执行原理</h2><p>浏览器访问localhost:8080/demo01，tomcat从web.xml找资源路径/demo01，通过url找到配对的servlet-name，然后找到类文件（看到全类名，首先应该想到反射）</p><p>tomcat将全类名对应的字节码文件加载进内存<code>Class.forName</code>，创建对象<code>class.newInstance</code>，调用方法<code>service</code>，这些过程都是在服务器完成的。</p><p>总结</p><ol><li>当服务器接收到客户端浏览器的请求后，会解析请求URL路径，获取访问的Servlet的资源路径</li><li>查找web.xml，是否有对应的<code>&lt;url-pattern&gt;</code>便签体内容</li><li>如果有，则再找到对应的<code>&lt;servlet-class&gt;</code>找到全类名，Tomcat将字节码文件加载进内存，并创建其对象</li><li>调用方法</li></ol><h2 id="2-2-生命周期"><a href="#2-2-生命周期" class="headerlink" title="2.2 生命周期"></a>2.2 生命周期</h2><ol><li>被创建：执行init方法，只执行一次。<ul><li>默认情况下，第一次访问时，Servlet被创建</li><li>可以指定Servlet启动的时机为启动服务器时，Servlet被创建，一般用于加载资源</li></ul></li><li>提供服务：执行service方法，执行多次<ul><li>每次访问Servlet时，service都会被调用一次</li></ul></li><li>被销毁：执行destroy方法（服务器正常关闭时），只执行一次<ul><li>Servlet被销毁时执行。如果服务器不是正常关闭，不会执行。destroy可以理解为“临终遗言”，在Servlet销毁之前执行。一般用于释放资源。</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02Servlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化方法</span></span><br><span class="line"><span class="comment">     * 在Servlet被创建时执行。只会执行一次</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletConfig</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"init..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Servlet对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提供服务的方法</span></span><br><span class="line"><span class="comment">     * 每一次Servlet被访问，都会被执行。执行多次</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"service..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Servlet的一些信息，版本、作者等等</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销毁方法</span></span><br><span class="line"><span class="comment">     * 在服务器正常关闭时，执行一次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"destory..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置Servlet启动的时机</p><ol><li>第一次被访问时创建。<code>&lt;load-on-startup&gt;</code>为负数，一般为-1</li><li>在服务器启动时创建。<code>&lt;load-on-startup&gt;</code>为0或正整数，一般为0-10</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo02<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>demo01_servlet.Demo02Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定Servlet的创建时机</span></span><br><span class="line"><span class="comment">        1. 第一次被访问时，创建。&lt;load-on-startup&gt;为负数，一般为-1</span></span><br><span class="line"><span class="comment">        2. 在服务器启动时，创建。&lt;load-on-startup&gt;为0或正整数，一般为0-10</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Servlet的init方法，只执行一次，说明一个Servlet在内存中只存在一个对象，Servlet是单例的。</p><p>多个用户同时访问时，可能存在线程安全问题。就比方说买票，容易数据错乱</p><p>解决方法：尽量不要在Servlet中定义成员变量。即使定义了成员变量，也不要对其赋值和修改值。</p></blockquote><h2 id="2-3-注解配置"><a href="#2-3-注解配置" class="headerlink" title="2.3 注解配置"></a>2.3 注解配置</h2><p>在Servlet3.0之前，需要通过配置文件web.xml来配置。但是，太麻烦。</p><p>在Servlet3.0之后，可以通过注解来配置，web.xml可以不需要了。</p><p>从JavaEE6之后，才开始支持Servlet3.0。</p><p>步骤</p><ol><li>创建JavaEE项目，选择Servlet的版本为3.0以上，可以不创建web.xml</li><li>定义一个类，实现Servlet接口</li><li>实现接口中的抽象方法</li><li>在类上使用注解@WebServlet<ul><li><code>@WebServlet(&quot;资源路径&quot;)</code>，当然@WebServlet还可以配置别的内容，具体参照其源码</li></ul></li></ol><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/2.png"><blockquote><p>参照文章<a href="https://meethigher.top/blog/2020/reflection-and-annotation/#2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3">注解</a></p><p>如果定义属性时，使用default关键字给属性默认初始化值，则使用注解时，可以不进行属性的赋值</p><p>如果只有一个属性需要赋值，并且属性的名称是<strong>value</strong>，则value可以省略（可以参考@SuppressWarnings的源码）</p><p>数组赋值时，用{}包裹。如果其中只有一个值的时候，{}可以省略不写</p></blockquote><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/3.png"><h2 id="2-4-编译器与其Tomcat相关配置"><a href="#2-4-编译器与其Tomcat相关配置" class="headerlink" title="2.4 编译器与其Tomcat相关配置"></a>2.4 编译器与其Tomcat相关配置</h2><p>如果直接使用tomcat的bin目录下脚本打开服务器，他的配置文件就放在服务器根目录下了。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/4.png"><p>对于编译器，他们会给集成到自身的tomcat单独建立配置文件。eclipse和idea这两款编译器，我都用过。</p><p>如果使用eclipse，那么eclipse会给他单独配置一个路径</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/5.png"><p>同样地，idea也会单独配置路径来存储配置文件</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/6.png"><p>项目分为工作空间目录和tomcat部署的Web项目</p><ul><li>tomcat真正访问的是tomcat部署的Web项目，而tomcat会将编译后的工作空间目录内容的字节码文件放到WEB-INF下的classes中</li><li>WEB-INF下的文件不能直接被浏览器访问</li><li>断点调试：不能直接运行服务器，需要通过Debug模式来运行服务器</li></ul><h2 id="2-5-Servlet体系结构"><a href="#2-5-Servlet体系结构" class="headerlink" title="2.5 Servlet体系结构"></a>2.5 Servlet体系结构</h2><p>每次都像上面那样实现Servlet接口，却只用到了service方法，多余！那就需要通过一个实现类来帮助完成。Servlet自身有这种体系结构。</p><p>HttpServlet继承自GenericServlet，GenericServlet实现Servlet接口。看<a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html" target="_blank" rel="noopener">文档</a>或者源码</p><p>GenericServlet：将Servlet接口中的其他方法做了默认空实现，只将service()方法作为抽象</p><ul><li>将来定义Servlet类时，可以继承GenericServlet，实现service()方法即可。其他方法可以自选重写</li></ul><p>HttpServlet：对http协议的一种封装，简化操作</p><ol><li>定义类继承HttpServlet</li><li>重写doGet和doPost方法</li></ol><blockquote><p>在实际使用中，继承HttpServlet的方法会更好</p></blockquote><h2 id="2-6-Servlet相关配置"><a href="#2-6-Servlet相关配置" class="headerlink" title="2.6 Servlet相关配置"></a>2.6 Servlet相关配置</h2><p>urlPattens：Servlet访问路径</p><ul><li>一个Servlet可以定义多个访问路径：@WebServlet({“/d6”,”/dd6”,”/demo06”})</li><li>路径定义规则：如<code>/xxx</code>、<code>/xxx/xxx</code>（多层路径，目录结构）、<code>/*</code>（<code>*</code>的优先级很低，如果在访问已经配置的路径时，则会访问已配置的路径）、<code>*.do</code>（如果写<code>*.do</code>是会报错的，这个只是换了一个扩展名而已）</li></ul><blockquote><p>在注解中，如果属性值是value，那么value可以省略。</p><p>在配置访问路径的时候，是走的value，而不是urlPattens。我就在想，那么实现类是如何将value转换成url的呢？</p><p>找了半天，百度，和官网源码，也没找到@WebServlet的实现类。</p><p>后来再文档中看到说，value跟urlPatterns是一个东西。WTF！可能官方是为了让书写更加简洁？</p></blockquote><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/7.png"><h1 id="三、HTTP请求协议"><a href="#三、HTTP请求协议" class="headerlink" title="三、HTTP请求协议"></a>三、HTTP请求协议</h1><p>概念：Hyper Text Transfer Protocol 超文本传输协议</p><p>传输协议：定义了客户端和服务端通信时，发送数据的格式</p><p>特点</p><ol><li>基于TCP/IP的高级协议</li><li>默认端口号：80</li><li>基于请求/响应模型的：一次请求对应一次响应</li><li>无状态的协议：每次请求之间相互独立</li></ol><p>历史版本</p><ul><li>1.0：每一次请求响应都会建立新的连接</li><li>1.1：复用连接</li></ul><p>具体的<a href="https://www.cnblogs.com/surui/p/11669346.html" target="_blank" rel="noopener">各版本的区别</a></p><h2 id="3-1-请求消息数据格式"><a href="#3-1-请求消息数据格式" class="headerlink" title="3.1 请求消息数据格式"></a>3.1 请求消息数据格式</h2><ol><li>请求行<ul><li>请求方式 请求url 请求协议/版本。如GET /login.html HTTP/1.1</li></ul></li><li>请求头<ul><li>请求头名称:请求头值1,请求头值2,…</li></ul></li><li>请求空行：作分割作用</li><li>请求体（正文）：get方式是没有请求体的。用来封装post请求消息的请求参数的</li></ol><p>字符串格式的请求数据</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://meethigher.top/admin/login.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: meethigehr.top</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">Content-Length</span>: 35</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br><span class="line"><span class="attribute">Origin</span>: http://baixiu-dev.top</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span>: http://meethigher.top/</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=cdtnkpj4apnarjhtqugqegsfmn</span><br><span class="line"></span><br><span class="line">email=admin@qq.com&amp;password=admin</span><br></pre></td></tr></table></figure><h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><p>Http协议中有7种请求方式，常用的有2种</p><ul><li>get<ul><li>请求参数在请求行中（也可以理解在url中）</li><li>请求的url长度是有限制的</li><li>相对不安全</li></ul></li><li>post<ul><li>请求参数在请求体中</li><li>请求的url长度是没有限制的</li><li>相对安全</li></ul></li></ul><h3 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h3><p>常见的请求头</p><ol><li>User-Agent：浏览器访问服务器内容时，使用的浏览器版本信息</li><li>Referer：告诉服务器，当前请求从哪里来</li><li>Connection：keep-alive一直连接，表示可复用</li></ol><p>Referer有两个作用</p><ol><li>防盗链（盗取超链接）</li><li>统计功能</li></ol><p>比如看斗罗大陆，一般是通过选了集数，跳转到腾讯播放页观看，这是用户正常的播放流程。但是如果，用户通过自己建的网页，直接指向腾讯播放页，这个过程就叫做<strong>盗链</strong>。</p><h2 id="3-2-响应消息数据格式"><a href="#3-2-响应消息数据格式" class="headerlink" title="3.2 响应消息数据格式"></a>3.2 响应消息数据格式</h2><ol><li>响应行<ul><li>请求协议/版本 响应状态码 状态码描述</li></ul></li><li>响应头<ul><li>响应头名称:响应头值1,响应头值2,…</li></ul></li><li>响应空行</li><li>响应体</li></ol><p>字符串格式的响应数据</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Tue, 09 Jun 2020 01:43:26 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.4.34 (Win64) PHP/7.2.10</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/7.2.10</span><br><span class="line"><span class="attribute">Expires</span>: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-store, no-cache, must-revalidate</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Location</span>: /admin/index.php</span><br><span class="line"><span class="attribute">Content-Length</span>: 2508</span><br><span class="line"><span class="attribute">Keep-Alive</span>: timeout=5, max=100</span><br><span class="line"><span class="attribute">Connection</span>: Keep-Alive</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;html&gt;返回一套html代码，此处省略&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h3><p>服务器告诉客户端浏览器本次请求和响应的状态，状态码都是三位数字</p><p><a href="https://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">状态码</a>分类</p><ol><li>1xx：服务器接收客户端消息，但是没有接收完成，等待一段时间后，发送1xx多状态码</li><li>2xx：表示成功。最常见的就是200</li><li>3xx：表示重定向。最常见的302（重定向），304（访问缓存）</li><li>4xx：客户端错误。最常见的404（代表请求路径没有对应的资源），405（请求方式没有相应的方法，比方说在Servlet中，没有doGet方法或者doPost方法）</li><li>5xx：服务器端错误 。最常见的500（代表服务器内部错误）</li></ol><h3 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h3><p>常见的响应头</p><ol><li>Content-Type：服务器告诉客户端本次响应体数据格式以及编码格式</li><li>Content-disposition：服务器告诉客户端以什么格式打开响应体数据<ul><li>in-line：默认值（在当前页面内打开）</li><li>attachment;filename=xxx：以附件形式打开响应体。在文件下载中，会使用这个，文件名是xxx</li></ul></li></ol><h3 id="响应体"><a href="#响应体" class="headerlink" title="响应体"></a>响应体</h3><p>响应体就是真实的传输的数据</p><h1 id="四、Request"><a href="#四、Request" class="headerlink" title="四、Request"></a>四、Request</h1><p>Request对象和Response对象的原理</p><ol><li>request和response是由服务器来创建，开发者来使用</li><li>request获取请求消息，response设置响应消息</li></ol><h2 id="4-1-Request对象继承体系结构"><a href="#4-1-Request对象继承体系结构" class="headerlink" title="4.1 Request对象继承体系结构"></a>4.1 Request对象继承体系结构</h2><p>tomcat里面的<code>RequestFacade</code>类实现了继承自<code>ServletRequest</code>接口的实现类<code>HttpServletRequest</code></p><p>具体的实现可以在Tomcat的源码中查看。</p><h2 id="4-2-Request功能"><a href="#4-2-Request功能" class="headerlink" title="4.2 Request功能"></a>4.2 Request功能</h2><ol><li>获取请求消息<ul><li>获取请求行数据（标❤比较常用）<ul><li>获取请求方式：String getMethod()</li><li>❤获取虚拟目录：String getContextPath()</li><li>获取Servlet路径：String getServletPath()</li><li>获取get请求参数：String getQueryString()</li><li>❤获取请求URI：String getRequestURI()和String getRequestURL()</li><li>获取协议以及版本：String getProtocol()</li><li>获取客户机ip地址：String getRemoteAddr()</li></ul></li><li>获取请求头数据（标❤比较常用，请求头是不区分大小写的）<ul><li>❤String getHeader(String name)：通过请求头的名称，获取请求头的值</li><li>Enumeration<string>getHeaderNames()：获取所有的请求头名称</string></li></ul></li><li>获取请求体数据：只有post请求方式，才有请求体，在请求体中封装了post请求的请求参数<ol><li>获取流对象<ul><li>BufferedReader getReader()：获取字符输入流，只能操作字符</li><li>ServletInputStream getInputStream()：获取字节输入流，可以操作所有类型数据。用于文件上传比较好</li></ul></li><li>流对象中拿数据</li></ol></li></ul></li><li>❤其他功能<ul><li>获取请求参数通用方式：不论get或是post请求，都可以使用下面这些方法<ul><li>String getParameter(String name)：根据参数名称获取参数值</li><li>String[] getParameterValues(String name)：根据参数名称获取参数值数组，多用于复选框</li><li>Enumeration<string>getParameterNames()：获取所有请求的参数名称</string></li><li>Map&lt;String,String[]&gt; getParameterMap()：获取所有参数的map集合</li></ul></li><li>请求转发：一种在服务器内部的资源跳转方式</li><li>共享数据</li><li>获取ServletContext对象</li></ul></li></ol><h3 id="获取请求消息"><a href="#获取请求消息" class="headerlink" title="获取请求消息"></a>获取请求消息</h3><h4 id="获取请求行"><a href="#获取请求行" class="headerlink" title="获取请求行"></a>获取请求行</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo01request"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 获取请求方式：String getMethod()</span></span><br><span class="line"><span class="comment">         * ❤获取虚拟目录：String getContextPath()</span></span><br><span class="line"><span class="comment">         * 获取Servlet路径：String getServletPath()</span></span><br><span class="line"><span class="comment">         * 获取get请求参数：String getQueryString()</span></span><br><span class="line"><span class="comment">         * ❤获取请求URI：String getRequestURI()和String getRequestURL()</span></span><br><span class="line"><span class="comment">         * 获取协议以及版本：String getProtocol()</span></span><br><span class="line"><span class="comment">         * 获取客户机ip地址：String getRemoteAddr()</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(request.getMethod());<span class="comment">// GET</span></span><br><span class="line">        System.out.println(request.getContextPath());<span class="comment">// /demo</span></span><br><span class="line">        System.out.println(request.getServletPath());<span class="comment">// /demo01request</span></span><br><span class="line">        System.out.println(request.getQueryString());<span class="comment">// user=hh&amp;password=123</span></span><br><span class="line">        System.out.println(request.getRequestURI()+<span class="string">"---"</span>+request.getRequestURL());<span class="comment">// /demo/demo01request---http://localhost:8080/demo/demo01request</span></span><br><span class="line">        System.out.println(request.getProtocol());<span class="comment">// HTTP/1.1</span></span><br><span class="line">        System.out.println(request.getRemoteAddr());<span class="comment">// 这是获取的ipv6地址 0:0:0:0:0:0:0:1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>URL 统一资源定位符</p><p>URI 统一资源标识符</p><p>URI代表的范围更大一些（并不是取决于路径的长度的），URL限制了指定的服务器，而URI是没有限制的，应该这样理解</p></blockquote><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/8.png" title="idea中配置虚拟目录的方法"><h4 id="获取请求头"><a href="#获取请求头" class="headerlink" title="获取请求头"></a>获取请求头</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo02request"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02Request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Enumeration&lt;String&gt; headerNames = request.getHeaderNames();</span><br><span class="line">        <span class="keyword">while</span> (headerNames.hasMoreElements()) &#123;</span><br><span class="line">            String str = headerNames.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"user-agent"</span>.equals(str)) &#123;</span><br><span class="line">                String agent = request.getHeader(str);</span><br><span class="line">                <span class="keyword">if</span> (agent.contains(<span class="string">"Chrome"</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Chrome"</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Firefox"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取请求体"><a href="#获取请求体" class="headerlink" title="获取请求体"></a>获取请求体</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo03request"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03Request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取请求消息体 请求参数</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//1.获取字符流</span></span><br><span class="line">        BufferedReader br=request.getReader();</span><br><span class="line">        <span class="comment">//2.读取数据</span></span><br><span class="line">        String line=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span>((line=br.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这个部分出了点问题，就是它输出的内容，将字符串以url编码形式打印出来了。而后面的getParameter是直接原样输出的。那这两个的区别是啥？我尝试查看HttpServletRequest这个接口的实现类，最后通过request.getClass().getName()输出全类名，发现实现类是在tomcat里面。</p><p>结果里面的代码，也是超级简洁，我也没咋看明白两者的不同之处，惆怅。</p></blockquote><h3 id="4-3-其他功能"><a href="#4-3-其他功能" class="headerlink" title="4.3 其他功能"></a>4.3 其他功能</h3><h4 id="获取请求参数通用方式"><a href="#获取请求参数通用方式" class="headerlink" title="获取请求参数通用方式"></a>获取请求参数通用方式</h4><p>这个方式既适用于post也适用于get，所以说是通用方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo04request"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04Request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//post获取请求参数</span></span><br><span class="line">        <span class="comment">//根据参数名称获取参数值</span></span><br><span class="line"><span class="comment">//        String user = request.getParameter("user");</span></span><br><span class="line"><span class="comment">//        String password = request.getParameter("password");</span></span><br><span class="line"><span class="comment">//        System.out.println(user+"--"+password);</span></span><br><span class="line"><span class="comment">//        //根据参数名称获取参数值数组</span></span><br><span class="line"><span class="comment">//        String[] hobbies=request.getParameterValues("beauty");</span></span><br><span class="line"><span class="comment">//        for (String hobby: hobbies) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(hobby);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//获取所有请求的参数名称</span></span><br><span class="line"><span class="comment">//        Enumeration&lt;String&gt; parameterNames = request.getParameterNames();</span></span><br><span class="line"><span class="comment">//        while(parameterNames.hasMoreElements())&#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(parameterNames.nextElement());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//测试热部署</span></span><br><span class="line">        System.out.println(<span class="string">"奥利给"</span>);<span class="comment">//没卵用，百度一下，发现要用debug模式运行才可以</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取所有参数的Map集合</span></span><br><span class="line">        Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">        <span class="comment">//遍历</span></span><br><span class="line">        Set&lt;String&gt; strings = parameterMap.keySet();</span><br><span class="line">        <span class="keyword">for</span>(String key:strings)&#123;</span><br><span class="line">            System.out.println(key+<span class="string">"↓↓↓↓↓↓"</span>);</span><br><span class="line">            <span class="comment">//根据key获取值</span></span><br><span class="line">            String[] strings1 = parameterMap.get(key);</span><br><span class="line">            <span class="comment">//遍历值数组</span></span><br><span class="line">            <span class="keyword">for</span> (String value:strings1) &#123;</span><br><span class="line">                System.out.println(value);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"------"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="请求转发"><a href="#请求转发" class="headerlink" title="请求转发"></a>请求转发</h4><p>步骤</p><ol><li>通过request对象获取请求转发器对象：RequestDispatcher getRequestDispatcher(String path)</li><li>使用RequestDispatcher对象进行转发：void forward(ServletRequest request, ServletResponse response)</li></ol><p>特点</p><ol><li>浏览器地址栏路径没有发生变化</li><li>只能转发到当前的服务器内部中</li><li>转发是一次请求</li></ol><h4 id="共享数据"><a href="#共享数据" class="headerlink" title="共享数据"></a>共享数据</h4><p>域对象：一个有作用范围的对象，可以在范围内共享数据</p><p>request域：代表一次请求的范围。一般用于<strong>请求转发</strong>的多个资源中共享数据</p><p>方法</p><ol><li>setAttribute(String name,Object object)：存储数据</li><li>Object getAttribute(String name)：通过键获取值</li><li>removeAttribute(String name)：通过键移除值</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo05request"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05Request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"demo05request"</span>);</span><br><span class="line">        request.setAttribute(<span class="string">"女神"</span>,<span class="string">"胡列娜"</span>);</span><br><span class="line">        RequestDispatcher requestDispatcher = request.getRequestDispatcher(<span class="string">"/demo06request"</span>);</span><br><span class="line">        requestDispatcher.forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>demo05将请求转发到demo06，同时在request域内共享数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo06request"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo06Request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"demo06request"</span>);</span><br><span class="line">        System.out.println(request.getAttribute(<span class="string">"女神"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取ServletContext"><a href="#获取ServletContext" class="headerlink" title="获取ServletContext"></a>获取ServletContext</h4><p>ServletContext getServletContext()</p><h3 id="4-4-中文乱码问题"><a href="#4-4-中文乱码问题" class="headerlink" title="4.4 中文乱码问题"></a>4.4 中文乱码问题</h3><p>get方式：Tomcat8已经将get方式乱码解决了</p><p>post方式：会乱码。解决方式是在获取参数前，将request的编码设置为utf-8</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure><h1 id="五、用户登录案例"><a href="#五、用户登录案例" class="headerlink" title="五、用户登录案例"></a>五、用户登录案例</h1><h2 id="5-1-需求"><a href="#5-1-需求" class="headerlink" title="5.1 需求"></a>5.1 需求</h2><ol><li>编写登录页面，账号密码</li><li>使用Druid数据库连接技术</li><li>使用JDBCTemplate技术封装JDBC</li><li>登录成功，跳转SuccessServlet，提示登录成功</li><li>登录失败，跳转到FailServlet，提示登录失败</li></ol><h2 id="5-2-实现"><a href="#5-2-实现" class="headerlink" title="5.2 实现"></a>5.2 实现</h2><ol><li>创建项目、登录界面，配置文件以及数据库，导入jar包（在Web项目下，jar包一般是放在WEB-INF的lib目录下）</li><li>创建包domain，包下建User表，对应着数据库表</li><li>创建包dao，包下建UserDao，提供Login方法</li><li>创建包utils，包下建JDBCUtils（连接池工具类）</li><li>创建包servlet，包下建响应的Servlet</li><li>创建包test，通过Junit进行单元测试</li></ol><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"loginServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>dao层下的UserDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作数据中user表的类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/meethigher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate temp=<span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDs());</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 只有用户名和密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 包含用户全部方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(User loginUser)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.编写sql,只查询一条数据，因为我数据库里存储的内容有重复值，所有...</span></span><br><span class="line">            String sql=<span class="string">"select * from user where user=? and password=? limit 0,1"</span>;</span><br><span class="line">            <span class="comment">//2.调用template的查询方法</span></span><br><span class="line">            User user = temp.queryForObject(sql,</span><br><span class="line">                    <span class="keyword">new</span> BeanPropertyRowMapper&lt;User&gt;(User<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line"><span class="class">                    <span class="title">loginUser</span>.<span class="title">getUser</span>(),<span class="title">loginUser</span>.<span class="title">getPassword</span>())</span>;</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DataAccessException e) &#123;</span><br><span class="line">            <span class="comment">//如果没有查到内容，返回null</span></span><br><span class="line">            e.printStackTrace();<span class="comment">//后期不再会使用打印异常，而是通过记录日志的方式</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>domain层的User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户的JavaBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/meethigher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>utils层下的JDBCUtils.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC工具类，使用Druid连接池</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/meethigher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource ds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态代码块初始化连接池对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载配置文件</span></span><br><span class="line">            Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            InputStream is = JDBCUtils.class.getClassLoader().getResourceAsStream("druid.properties");</span><br><span class="line">            pro.load(is);</span><br><span class="line">            <span class="comment">//2.初始化连接池对象</span></span><br><span class="line">            ds = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接池对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>test层下的UserDaoTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/meethigher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLogin</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User u=<span class="keyword">new</span> User();</span><br><span class="line">        u.setUser(<span class="string">"胡列娜"</span>);</span><br><span class="line">        u.setPassword(<span class="string">"123f"</span>);</span><br><span class="line">        UserDao udao=<span class="keyword">new</span> UserDao();</span><br><span class="line">        udao.login(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>servlet层下的LoginServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/example/loginServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//获取请求参数</span></span><br><span class="line">        String user = request.getParameter(<span class="string">"user"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">        <span class="comment">//封装User对象</span></span><br><span class="line">        User loginUser = <span class="keyword">new</span> User();</span><br><span class="line">        loginUser.setUser(user);</span><br><span class="line">        loginUser.setPassword(password);</span><br><span class="line">        <span class="comment">//调用UserDao的登录方法</span></span><br><span class="line">        User login = <span class="keyword">new</span> UserDao().login(loginUser);</span><br><span class="line">        <span class="comment">//判断是否登录成功</span></span><br><span class="line">        <span class="keyword">if</span>(login!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            request.setAttribute(<span class="string">"user"</span>,login);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/example/successServlet"</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/example/failServlet"</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>servlet层下的SuccessServlet和FailServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SuccessServlet.java</span></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/example/successServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuccessServle</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        User user = (User) request.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        response.getWriter().write(user.getUser()+<span class="string">"登录成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//FailServlet.java</span></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/example/failServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FailServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">"登录失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BeanUtils工具类"><a href="#BeanUtils工具类" class="headerlink" title="BeanUtils工具类"></a>BeanUtils工具类</h3><p>JavaBean：标准的Java类</p><p>JavaBean要求</p><ul><li>类必须被public修饰</li><li>必须提供空参的构造方法</li><li>成员变量必须使用private修饰</li><li>提供公共的getter和setter方法</li><li>一般在项目中放在domain或者entity下</li></ul><p>功能：简化数据封装</p><p>概念</p><ul><li>成员变量</li><li>属性：setter和getter方法截取后的产物，比方说getUser()，对应的属性就是user</li></ul><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/10.png" title="成员变量跟属性的区别"><p>方法</p><ul><li>setProperty()</li><li>getProperty()</li><li>populate()</li></ul><blockquote><p>我个人的理解，其实属性跟成员变量是一回事。只不过有的库在封装（比如BeanUtils）的时候，需要拆分出方法的设置或获取的属性，由此产生属性这个概念。</p><p>其实，从这个角度来想，好多东西，都是人规定的，因为你整的东西好，用的人多了，自然而然也就成了规定。就像js，php，这种叫做弱类型语言，底层可能还是通过基本数据类型来实现，但是我也可以说，他没有数据类型，因为在用的时候，根本不需要去定义数据类型。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanUtilsTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException, NoSuchMethodException </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        BeanUtils.setProperty(user,<span class="string">"user"</span>,<span class="string">"胡列娜"</span>);</span><br><span class="line">        String user1 = BeanUtils.getProperty(user, <span class="string">"user"</span>);</span><br><span class="line">        System.out.println(user+<span class="string">"--"</span>+user1);<span class="comment">// User&#123;id=0, user='胡列娜', password='null'&#125;--胡列娜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>登录功能只有两条数据需要封装成User对象。获取数据，创建对象，赋值，6步完成。如果是一个很多条数据，要获取十几次数据，赋值十几次，岂不是很麻烦。这就需要优化一下了。</p><p>一次能获取所有数据，一次赋完所有值。可以通过下载BeanUtils来完成数据的封装</p><p>优化后的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/example/loginServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line"><span class="comment">//        //获取请求参数</span></span><br><span class="line"><span class="comment">//        String user = request.getParameter("user");</span></span><br><span class="line"><span class="comment">//        String password = request.getParameter("password");</span></span><br><span class="line"><span class="comment">//        //封装User对象</span></span><br><span class="line"><span class="comment">//        User loginUser = new User();</span></span><br><span class="line"><span class="comment">//        loginUser.setUser(user);</span></span><br><span class="line"><span class="comment">//        loginUser.setPassword(password);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//改用BeanUtils优化</span></span><br><span class="line">        <span class="comment">//获取所有请求参数</span></span><br><span class="line">        Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">        <span class="comment">//创建对象</span></span><br><span class="line">        User loginUser = <span class="keyword">new</span> User();</span><br><span class="line">        <span class="comment">//使用BeanUtils封装</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BeanUtils.populate(loginUser,parameterMap);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//调用UserDao的登录方法</span></span><br><span class="line">        User login = <span class="keyword">new</span> UserDao().login(loginUser);</span><br><span class="line">        <span class="comment">//判断是否登录成功</span></span><br><span class="line">        <span class="keyword">if</span>(login!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            request.setAttribute(<span class="string">"user"</span>,login);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/example/successServlet"</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/example/failServlet"</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="六、Response"><a href="#六、Response" class="headerlink" title="六、Response"></a>六、Response</h1><h2 id="6-1-Response功能"><a href="#6-1-Response功能" class="headerlink" title="6.1 Response功能"></a>6.1 Response功能</h2><p>设置响应消息</p><ul><li>设置响应行<ul><li>设置状态码：setStatus(int sc)</li></ul></li><li>设置响应头：setHeader(String name,String value)</li><li>设置响应体<ul><li>获取输出流<ul><li>字符输出流：PrintWriter getWriter();</li><li>字节输出流：ServletOutputStream getOutputStream()</li></ul></li><li>使用输出流，将输出流输出到客户端</li></ul></li></ul><h2 id="6-2-重定向"><a href="#6-2-重定向" class="headerlink" title="6.2 重定向"></a>6.2 重定向</h2><p>重定向：资源跳转的方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo01Response"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Response</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"demo01Response..."</span>);</span><br><span class="line">        <span class="comment">//访问 /demo01Response会自动跳转/demo02Response</span></span><br><span class="line"><span class="comment">//        //1.设置状态码为302</span></span><br><span class="line"><span class="comment">//        response.setStatus(302);</span></span><br><span class="line"><span class="comment">//        //2.设置响应头location</span></span><br><span class="line"><span class="comment">//        response.setHeader("location","/demo02Response");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//因为重定向的步骤是一样的，所以java提供了简化版</span></span><br><span class="line">        System.out.println(response.getClass().getName());</span><br><span class="line">        response.sendRedirect(<span class="string">"/demo02Response"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>转发的特点（forward）</p><ol><li>浏览器地址栏路径没有发生变化</li><li>只能转发到当前的服务器内部中</li><li>转发是一次请求，可以使用request来共享数据</li></ol><p>重定向的特点(redirect)</p><ol><li>地址栏发生变化</li><li>可以访问其他站点资源</li><li>重定向是两次请求，不能使用request来共享数据</li></ol><h2 id="6-3-路径"><a href="#6-3-路径" class="headerlink" title="6.3 路径"></a>6.3 路径</h2><p>分类</p><ol><li>相对路径：通过相对路径，不可以确定唯一资源<ul><li>如./index.html（当前路径下的index.html，./是可以省略的），../index.html（上一级的index.html，上上级之类的以此类推）</li><li>不以/开头，以.开头路径；./表示当前路径，当然，这个是可以省略的。</li><li>规则：要使用相对路径，要确定当前的资源和目标资源之间的相对位置关系</li></ul></li><li>绝对路径：通过绝对路径，可以确定唯一的资源<ul><li>如<a href="https://meethigher.top/blog/2020/blogs、/blog/2020/blogs">https://meethigher.top/blog/2020/blogs、/blog/2020/blogs</a></li><li>完整地址或者以/开头都是绝对路径</li></ul></li></ol><p>规则：判断定义的路径是给谁用的</p><ul><li>给客户端浏览器使用：需要加虚拟目录（项目的访问路径），比方说重定向</li><li>给服务器使用：不需要加虚拟目录，比方说请求转发</li></ul><p>在实际项目中，虚拟目录的路径不能写死，可以通过<code>request.getContextPath()</code>动态获取虚拟目录</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/11.png" title="动态获取虚拟目录"><h2 id="6-4-服务器输出数据到客户端"><a href="#6-4-服务器输出数据到客户端" class="headerlink" title="6.4 服务器输出数据到客户端"></a>6.4 服务器输出数据到客户端</h2><p>获取流对象</p><ul><li>获取字符输出流：PrintWriter getWriter()</li><li>获取字节输出流：ServletOutputStream getOutputStream()</li></ul><h3 id="字符输出流"><a href="#字符输出流" class="headerlink" title="字符输出流"></a>字符输出流</h3><p>步骤</p><ol><li>获取字符输出流</li><li>输出数据</li></ol><blockquote><p>注意：乱码问题，客户端的默认编码，与服务端返回消息体的编码不一致</p><p>response.getWriter()获取的流的默认编码是ISO-8859-1，我们需要设置该流的默认编码</p><p>response获取的流，不需要刷新和关闭。因为response在一次响应结束之后，自动销毁</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo03Response"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03Response</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//response获取的流，不需要刷新和关闭。因为response在一次响应结束之后，自动销毁</span></span><br><span class="line">        <span class="comment">//获取流对象之前，设置流的默认编码，但是如果客户端的机器有的是u8，有的是国标，还是会乱码</span></span><br><span class="line"><span class="comment">//        response.setCharacterEncoding("utf-8");</span></span><br><span class="line">        <span class="comment">//设置消息体数据的编码，建议浏览器使用该编码。不区分大写</span></span><br><span class="line"><span class="comment">//        response.setHeader("content-type","text/html;charset=utf-8");</span></span><br><span class="line">        <span class="comment">//当然，javaEE也给提供了更简便的方法</span></span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取字符输出流</span></span><br><span class="line">        PrintWriter pw = response.getWriter();</span><br><span class="line">        <span class="comment">//2.输出数据</span></span><br><span class="line">        pw.write(<span class="string">"Hello Response"</span>);</span><br><span class="line">        pw.write(<span class="string">"胡列娜 我女神"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字节输出流"><a href="#字节输出流" class="headerlink" title="字节输出流"></a>字节输出流</h3><p>步骤</p><ol><li>获取字节输出流：response.getOutputStream()</li><li>输出数据</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo04Response"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04Response</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        <span class="comment">//1.获取字节输出流</span></span><br><span class="line">        ServletOutputStream os = response.getOutputStream();</span><br><span class="line">        <span class="comment">//2.输出数据</span></span><br><span class="line">        os.write(<span class="string">"胡列娜 我女神"</span>.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-5-案例-验证码"><a href="#6-5-案例-验证码" class="headerlink" title="6.5 案例-验证码"></a>6.5 案例-验证码</h2><p>本质：图片</p><p>目的：防止表单恶意注册</p><p><a href="https://blog.csdn.net/weixin_42950079/article/details/83389220" target="_blank" rel="noopener">关于Graphics的常用方法</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/checkCodeServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> width=<span class="number">500</span>;</span><br><span class="line">        <span class="keyword">int</span> height=<span class="number">300</span>;</span><br><span class="line">        <span class="comment">//1.创建对象，在内存中画图（验证码图片对象）</span></span><br><span class="line">        BufferedImage image=<span class="keyword">new</span> BufferedImage(width,height,BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">//2.美化图片</span></span><br><span class="line">        <span class="comment">//2.1填充背景色</span></span><br><span class="line">        Graphics g=image.getGraphics();<span class="comment">//绘图对象</span></span><br><span class="line">        g.setColor(Color.PINK);</span><br><span class="line">        g.fillRect(<span class="number">0</span>,<span class="number">0</span>,width,height);</span><br><span class="line">        <span class="comment">//2.2画边框</span></span><br><span class="line">        g.setColor(Color.RED);</span><br><span class="line">        g.drawRect(<span class="number">0</span>,<span class="number">0</span>,width-<span class="number">1</span>,height-<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">"奥利给"</span>);</span><br><span class="line">        <span class="comment">//2.3写验证码</span></span><br><span class="line">        String str=<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">        Random r=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            g.drawString(str.charAt(r.nextInt(str.length()))+<span class="string">""</span>,width/<span class="number">5</span>*(i+<span class="number">1</span>),height/<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.4 画干扰线</span></span><br><span class="line">        g.setColor(Color.green);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x1=r.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y1=r.nextInt(height);</span><br><span class="line">            <span class="keyword">int</span> x2=r.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y2=r.nextInt(height);</span><br><span class="line">            g.drawLine(x1,y1,x2,y2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.将图片输出到页面展示</span></span><br><span class="line">        ImageIO.write(image,<span class="string">"jpg"</span>,response.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过html对齐进行访问以及单击修改</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/checkCodeServlet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0)"</span>&gt;</span>看不清换一张<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> $img=<span class="built_in">document</span>.querySelector(<span class="string">"img"</span>);</span></span><br><span class="line"><span class="actionscript">    $img.onclick = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> url = <span class="string">"/checkCodeServlet"</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> date=<span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.setAttribute(<span class="string">"src"</span>, url+<span class="string">"?"</span>+date)</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.querySelector(<span class="string">"a"</span>).onclick=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> url = <span class="string">"/checkCodeServlet"</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> date=<span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="actionscript">        $img.setAttribute(<span class="string">"src"</span>, url+<span class="string">"?"</span>+date)</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="七、ServletContext对象"><a href="#七、ServletContext对象" class="headerlink" title="七、ServletContext对象"></a>七、ServletContext对象</h1><p>概念：代表整个web应用，可以和程序的容器（服务器）来通信</p><p>获取</p><ol><li>通过request获取：request.getServletContext()</li><li>通过HttpServlet获取：getServletContext</li></ol><blockquote><p>其实通过这两个方式获取的都是同一个对象。因为本身HttpServletRequest就是HttpServlet的子类，调用的就是其父类的方法</p></blockquote><p>功能</p><ol><li>获取MIME类型<ul><li>MIME类型：在互联网通信过程中定义的一种文件数据类型</li><li>格式：大类型/小类型 如：htm或者html对应text/html、jpg对应image/jpeg</li><li>获取：String getMimeType(String filename)</li></ul></li><li>域对象：共享数据<ul><li>setAttribute(String name,Object value)</li><li>getAttribute(String name)</li><li>removeAttribute(String name)</li></ul></li><li>获取文件的真实路径（服务器完整路径）<ul><li>String getRealPath(String path)</li></ul></li></ol><h2 id="7-1-获取MIME类型"><a href="#7-1-获取MIME类型" class="headerlink" title="7.1 获取MIME类型"></a>7.1 获取MIME类型</h2><p>具体的MIME的相关的映射，都在tomcat的web.xml里面配置着。Tomcat的web.xml相当于是所有集成到ide的web.xml的父类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo02ServletContext"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02ServletContext</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletContext servletContext = getServletContext();</span><br><span class="line">        <span class="comment">//定义文件名称</span></span><br><span class="line">        String name=<span class="string">"a.jpg"</span>;</span><br><span class="line">        <span class="comment">//获取MIME类型</span></span><br><span class="line">        String mimeType = servletContext.getMimeType(name);</span><br><span class="line">        System.out.println(mimeType);<span class="comment">//image/jpeg</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/servlet/12.png"><h2 id="7-2-域对象"><a href="#7-2-域对象" class="headerlink" title="7.2 域对象"></a>7.2 域对象</h2><p>ServletContext对象范围：所有用户所有请求的数据（范围最大的）</p><p>在一个servlet设置属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo03ServletContext"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03ServletContext</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletContext servletContext = getServletContext();</span><br><span class="line">        <span class="comment">//设置数据</span></span><br><span class="line">        servletContext.setAttribute(<span class="string">"fairy"</span>,<span class="string">"胡列娜"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在另外的servlet访问属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo04ServletContext"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04ServletContext</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletContext servletContext = getServletContext();</span><br><span class="line">        <span class="comment">//获取数据</span></span><br><span class="line">        Object fairy = servletContext.getAttribute(<span class="string">"fairy"</span>);</span><br><span class="line">        System.out.println(fairy.toString());<span class="comment">//胡列娜</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>一般用这个，也比较谨慎，所有用户都是可以共享和操作的。而且，生命周期也非常长，服务器启动，它就创建了，服务器关闭，才会销毁。驻留在内存的时间非常久，造成的内存的压力会很大。</p></blockquote><h2 id="7-3-获取文件真实路径（服务器完整路径）"><a href="#7-3-获取文件真实路径（服务器完整路径）" class="headerlink" title="7.3 获取文件真实路径（服务器完整路径）"></a>7.3 获取文件真实路径（服务器完整路径）</h2><ul><li>获取web目录下文件</li><li>获取WEB-INF目录下文件</li><li>获取src目录下文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/demo05ServletContext"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05ServletContext</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletContext servletContext = getServletContext();</span><br><span class="line">        String realPath = servletContext.getRealPath(<span class="string">"/example/login.html"</span>);<span class="comment">//获取web下文件</span></span><br><span class="line">        System.out.println(realPath);<span class="comment">//E:\Develop\JavaDev\JavaEE\out\artifacts\JavaEE_war_exploded\example\login.html</span></span><br><span class="line">        String realPath1 = servletContext.getRealPath(<span class="string">"/WEB-INF/web.xml"</span>);<span class="comment">//获取WEB-INF目录下文件</span></span><br><span class="line">        System.out.println(realPath1);</span><br><span class="line">        <span class="comment">//如果是直接放在src根目录下的，需要去/WEB-INF/classes/下找</span></span><br><span class="line">        String realPath2 = servletContext.getRealPath(<span class="string">"/WEB-INF/classes/a.html"</span>);<span class="comment">//获取src目录下文件</span></span><br><span class="line">        System.out.println(realPath2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="八、文件下载与上传案例"><a href="#八、文件下载与上传案例" class="headerlink" title="八、文件下载与上传案例"></a>八、文件下载与上传案例</h1><h2 id="8-1-文件下载"><a href="#8-1-文件下载" class="headerlink" title="8.1 文件下载"></a>8.1 文件下载</h2><p>需求</p><ol><li>页面显示超链接</li><li>点击超链接后弹出下载框</li><li>完成图片文件下载</li></ol><blockquote><p>HTML中超链接指向的资源如果能够被浏览器解析，则在浏览器中展示；若不能解析，就会进行下载到本地。当然，我们也可以通过添加download属性，直接让它所有的都下载。但是这个是没有提示框的。</p><p>我们可以使用响应头设置资源打开的方式</p><p>content-disposition:attachment;filename=xxx这个表示已附件的形式打开，文件名为xxx</p></blockquote><p>步骤</p><ol><li>定义页面</li><li>定义Servlet<ul><li>获取文件名称</li><li>用字节输入流加载进内存</li><li>设置响应头为附件形式打开</li><li>将内存写出到响应输出流</li></ul></li></ol><blockquote><p>中文名称的文件下载时会乱码，改成utf-8的即可，垃圾ie浏览器已经没救了，兼容不了</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/downloadServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//1.获取请求参数，文件名称</span></span><br><span class="line">        String filename = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">        <span class="comment">//2.使用字节输入流加载文件进内存</span></span><br><span class="line">        <span class="comment">//2.1找到文件服务器路径</span></span><br><span class="line">        ServletContext sc = getServletContext();</span><br><span class="line">        String realPath = sc.getRealPath(<span class="string">"/壁纸5.jpg"</span>);</span><br><span class="line">        <span class="comment">//2.2用字节流关联</span></span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(realPath);</span><br><span class="line">        <span class="comment">//3设置response响应头</span></span><br><span class="line">        <span class="comment">//3.1设置响应格式</span></span><br><span class="line">        String mimeType = sc.getMimeType(filename);</span><br><span class="line"><span class="comment">//        response.setHeader("content-type",mimeType);</span></span><br><span class="line">        response.setContentType(mimeType);</span><br><span class="line">        <span class="comment">//3.2设置响应头打开格式</span></span><br><span class="line">        <span class="comment">//解决中文文件名问题，垃圾ie，去他妈的吧，兼容不了</span></span><br><span class="line">        filename= URLEncoder.encode(filename,<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"content-disposition"</span>,<span class="string">"attachment;filename="</span>+filename);</span><br><span class="line">        <span class="comment">//4.将输入流数据写出到输出流中</span></span><br><span class="line">        ServletOutputStream sos = response.getOutputStream();</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">8</span>];</span><br><span class="line">        <span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((len=fis.read(bytes))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            sos.write(bytes,<span class="number">0</span>,len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5.释放资源</span></span><br><span class="line">        fis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>html中的代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"downloadServlet?filename=壁纸5.jpg"</span>&gt;</span>图片下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="8-2-文件上传"><a href="#8-2-文件上传" class="headerlink" title="8.2 文件上传"></a>8.2 文件上传</h2><p>我一开始以为文件上传跟文件下载一样，获取请求的传过来的数据，然后写。</p><p>但是，一直写出数据都是0kb，我就很纳闷了，我的代码是没有问题的。想了一会，搞明白了，request获取的输入流，是获取到的请求体的数据，而不是获取上传文件的内容</p></div><div class="post-detail">发布：2020-06-11 23:11:31<br>修改：2020-07-06 23:05:22<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/servlet/</span><br>标签：<span><a href="/blog/tags/java/">java</a>&nbsp;<a href="/blog/tags/web/">web</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>