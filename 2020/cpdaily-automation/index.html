<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="今日校园实现自动监测并提交最新表单,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="这个软件，有个bug，通知栏没法直接跳转。我反馈了一个多月，还是暂未受理。而且，这个软件会一直在后台请求启动手机上其他app，限制读取应用列表也没用，不知道他想干啥。不管了，反正已经卸载了。"><title>今日校园实现自动监测并提交最新表单</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">今日校园实现自动监测并提交最新表单</h2></div><div class="post-content blog-markdown"><p>站在巨人的肩膀上，我所写的东西，也会开源分享出来！</p><p>授人以鱼不如授人以渔，我把思路分享出来。</p><p>将源码放在这里<a href="https://github.com/meethigher/cpdaily-submit" target="_blank" rel="noopener">今日校园实现自动检测并提交最新表单</a>，也可以来<a href="https://www.bilibili.com/video/BV1tQ4y1N7XQ" target="_blank" rel="noopener">这里</a>给我的视频点个赞吖！</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/8.png" title="提交"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/9.png" title="邮件"><h1 id="一、抓包（重点）"><a href="#一、抓包（重点）" class="headerlink" title="一、抓包（重点）"></a>一、抓包（重点）</h1><h2 id="1-1-如何抓包"><a href="#1-1-如何抓包" class="headerlink" title="1.1 如何抓包"></a>1.1 如何抓包</h2><p>Fiddler4电脑端与手机端抓包的教程，我不多bb了。点这个<a href="https://blog.csdn.net/c406495762/article/details/76850843" target="_blank" rel="noopener">链接</a>里面有具体步骤，这个大佬是专门学习机器学习的，他的博客放到<a href="https://cuijiahua.com/" target="_blank" rel="noopener">这里</a>。</p><p>一开始，我是用的Fiddler4来进行抓包的，但是涉及到ssl-pinning的问题。导致抓包失败，也就是抓取过程中，一堆灰色链接。同时，手机上的网路也会被断开。</p><p>fiddler抓包中遇到的问题</p><p><a href="https://www.jianshu.com/p/7242d4e8b179" target="_blank" rel="noopener">无法抓https</a></p><p><a href="https://www.jianshu.com/p/59fd5af2eade" target="_blank" rel="noopener">android7+用户级证书不被信任</a></p><p><a href="https://blog.51cto.com/fresscale/1912943" target="_blank" rel="noopener">fiddler使用介绍</a></p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/1.png" title="失败"><p>之后，我就开始考虑，要不用手机抓包，就下载了<a href="https://github.com/MegatronKing/HttpCanary" target="_blank" rel="noopener">HttpCannary</a>，HttpCanary有普通版和高级版之分，建议下载高级版，同样会遇到ssl-pinning的问题，具体解决方法请移步到<a href="https://www.bilibili.com/video/BV1Qe411s7q9?from=search&seid=10930251094898400074" target="_blank" rel="noopener">系统证书的安装，解决APP抓不到包</a>，下载软件点<a href="https://lanzous.com/b0c2a09rg" target="_blank" rel="noopener">这里</a></p><h2 id="1-2-我的解决方法"><a href="#1-2-我的解决方法" class="headerlink" title="1.2 我的解决方法"></a>1.2 我的解决方法</h2><p>此节是废话，请略过。</p><p>我一开始用幸运破解器，很幸运的是，虽然显示破解授权失败，但打开的时候，发现能用了。</p><p>下一步，就是安装系统证书了，我就把手机root了，我的手机是小米的，直接root就行。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/2.jpg" title="root"><p>但是，还是在安装系统证书的过程中出了问题，不能往系统里面移动证书，原因是没有权限。</p><p>后来百度了一下，发现，MIUI的root权限，从Android7之后，就没有完整的root权限了。除非刷第三方系统。</p><p>但是我又舍不得自己的MIUI12。</p><p>接下来，就准备用模拟器了，我下载的是<a href="http://www.xyaz.cn/" target="_blank" rel="noopener">逍遥安卓模拟器</a>。安卓的是4.4版本系统，刷入了<a href="http://xposed.appkg.com/" target="_blank" rel="noopener">xposed框架</a>，安装了<a href="https://github.com/Fuzion24/JustTrustMe" target="_blank" rel="noopener">justtrustme模块</a>。</p><p>然后，打开Fiddler抓包，Yes！</p><p>有了Cpdaily-Extension跟MOD_AUTH_CAS这两条数据，就能模拟提交了。</p><blockquote><p>此处是2020年5月30日更新，用android4.4毕竟不是个好的解决办法，因为现在好多app已经不支持旧版了。那么还得需要root。</p><p>我手机是android10，想要抓加密包的话，就得安装系统证书，安装到系统文件下。</p><p>经过一番折腾，成功了。具体过程看<a href="https://meethigher.top/blog/2020/root/">博客</a></p></blockquote><p>抓包问题就此解决。耗费了我一整天的时间。</p><p>提交过程中碰到的坑：</p><ol><li>今日校园版本过低。这是因为你提交的内容格式不对，按抓包的流程来一遍。</li><li>返回乱码消息。这是因为提交的表单内容，中文部分出现了编码问题，建议以utf-8格式发送。</li></ol><h1 id="二、Java模拟post请求"><a href="#二、Java模拟post请求" class="headerlink" title="二、Java模拟post请求"></a>二、Java模拟post请求</h1><p>这个算是套模板吧，都是这个套路，直接上代码。不要拿来就用，还是根据实际情况进行修改的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HttpUtil类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kit chen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用来模拟发送post请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtil</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sendPost</span><span class="params">(String url, String param,Map&lt;String,String&gt; headers)</span> </span>&#123;</span><br><span class="line">		BufferedWriter out = <span class="keyword">null</span>;</span><br><span class="line">		BufferedReader in = <span class="keyword">null</span>;</span><br><span class="line">		String result = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			URL realUrl = <span class="keyword">new</span> URL(url);</span><br><span class="line">			URLConnection conn = realUrl.openConnection();</span><br><span class="line">			Set&lt;Entry&lt;String, String&gt;&gt; set=headers.entrySet();</span><br><span class="line">			<span class="keyword">for</span>(Entry&lt;String,String&gt; header:set) &#123;</span><br><span class="line">				conn.setRequestProperty(header.getKey(), header.getValue());</span><br><span class="line">			&#125;</span><br><span class="line">			conn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">			conn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">			out = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(conn.getOutputStream(), <span class="string">"utf-8"</span>));</span><br><span class="line">			out.write(param);</span><br><span class="line">			out.flush();</span><br><span class="line">			in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(conn.getInputStream(), <span class="string">"utf-8"</span>));</span><br><span class="line">			String line;</span><br><span class="line">			<span class="keyword">while</span> ((line = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">				result += line;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"发送 POST 请求出现异常！"</span> + e);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">					out.close();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</span><br><span class="line">					in.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">				ex.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="三、模拟请求中的问题"><a href="#三、模拟请求中的问题" class="headerlink" title="三、模拟请求中的问题"></a>三、模拟请求中的问题</h1><p>通过抓包获取了请求头跟请求参数，请求参数还好说。</p><p>在抓取请求头的时候，遇到了点问题。</p><p>通过测试发现，如果想要成功提交内容，需要Cpdaily-Extension跟MOD_AUTH_CAS。</p><p>如果设备不去主动退出的话，Cpdaily-Extension是会<strong>一直存在有效</strong>的。类似的像QQ也是这样的。我在抓取Cpdaily-Extension的过程中，尝试访问各种页面，但是都没法获取到这个的值。哪怕是在登录的时候，也没有这个参数。只有在提交的时候，才能抓取到。</p><p>像MOD_AUTH_CAS这个的值，类似于session，是有有效期的。我目前还没有测试一直让这个东西保持有效。这个值，大概6个小时左右，就会失效了，需要重新登录网页获取。</p><p>问了大佬，好像是涉及到了<a href="https://blog.csdn.net/anumbrella/article/details/80821486" target="_blank" rel="noopener">cas单点登录</a>的知识，这块我也不懂。学！</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/2.png" title="知识盲点"><h1 id="四、监测表单并返回表单号"><a href="#四、监测表单并返回表单号" class="headerlink" title="四、监测表单并返回表单号"></a>四、监测表单并返回表单号</h1><p>今日校园有个获取今日最新表单的接口，如果没有的话，里面某个数据会是个空数组。</p><p>接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;queryCollectorProcessingList</span><br></pre></td></tr></table></figure><p>post的请求参数</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"pageSize"</span>: <span class="number">6</span>,<span class="attr">"pageNumber"</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><p>这个pageSize是指返回几条数据，响应请求中，我记得返回的json字符串，最多就只有6个参数，所以这个传个6就行了。大于等于6</p><p>返回的内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"code"</span>: <span class="string">"0"</span>,</span><br><span class="line">	<span class="attr">"message"</span>: <span class="string">"SUCCESS"</span>,</span><br><span class="line">	<span class="attr">"datas"</span>: &#123;</span><br><span class="line">		<span class="attr">"totalSize"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"pageSize"</span>: <span class="number">6</span>,</span><br><span class="line">		<span class="attr">"pageNumber"</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">"rows"</span>: [</span><br><span class="line">            <span class="string">"wid"</span>:<span class="string">"xx"</span>,</span><br><span class="line">            <span class="string">"formWid"</span>:<span class="string">"xx"</span>,</span><br><span class="line">            <span class="string">"isHandled"</span>:<span class="string">"0"</span></span><br><span class="line">            <span class="string">"..."</span>:<span class="string">"..."</span></span><br><span class="line">        ]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们要的就是这个wid、formWid跟isHandled。isHandled表示是否提交，非0为提交。</p><p>监测到有rows有数据，并且isHandled未提交的时候，我们就可以进行模拟提交了。</p><h1 id="五、获取学校表单号"><a href="#五、获取学校表单号" class="headerlink" title="五、获取学校表单号"></a>五、获取学校表单号</h1><p>这个还有一个坑就是，每天的学校的表单号schoolTaskWid不是固定的，由此，我们就需要来模拟请求来获取schoolTaskWid</p><p>接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;detailCollector</span><br></pre></td></tr></table></figure><p>post请求参数</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;"collectorWid": 传进来第三步获取的collectWid&#125;`</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><p>这sb接口开发者，一开始定义的是collectWid，结果后面又成了collectorWid，一开始在这边把我给坑了，需要注意。</p><p>这个接口获取的是collectorWid，第三步获取的是collectWid，其实他俩是一个东西。</p></blockquote><p>大致的返回内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"code"</span>: <span class="string">"0"</span>,</span><br><span class="line">	<span class="attr">"message"</span>: <span class="string">"SUCCESS"</span>,</span><br><span class="line">	<span class="attr">"datas"</span>: &#123;</span><br><span class="line">		<span class="attr">"collector"</span>: &#123;</span><br><span class="line">			<span class="attr">"wid"</span>: <span class="string">"8888"</span>,</span><br><span class="line">			<span class="attr">"formWid"</span>: <span class="string">"164"</span>,</span><br><span class="line">			<span class="attr">"priority"</span>: <span class="string">"5"</span>,</span><br><span class="line">			<span class="attr">"endTime"</span>: <span class="string">"8888-88-88 88:00:00"</span>,</span><br><span class="line">			<span class="attr">"currentTime"</span>: <span class="string">"8888-88-88 88:00:00"</span>,</span><br><span class="line">			<span class="attr">"schoolTaskWid"</span>: <span class="string">"8888"</span>,</span><br><span class="line">			<span class="attr">"isConfirmed"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="attr">"senderUserName"</span>: <span class="string">"牛逼学院(牛逼老师)"</span>,</span><br><span class="line">			<span class="attr">"createTime"</span>: <span class="string">"8888-88-88 88:00:00"</span>,</span><br><span class="line">			<span class="attr">"attachmentUrls"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"attachmentNames"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"attachmentSizes"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"isUserSubmit"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="attr">"fetchStuLocation"</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">"address"</span>: <span class="string">"xx省xx市xx县"</span> </span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"form"</span>: &#123;</span><br><span class="line">			<span class="attr">"wid"</span>: <span class="string">"164"</span>,</span><br><span class="line">			<span class="attr">"formTitle"</span>: <span class="string">"8月8日学生身体健康状况调查"</span>,</span><br><span class="line">			<span class="attr">"formContent"</span>: <span class="string">"https://wecres.cpdaily.com/counselor/1076158768111098/content/d1c0daf5604af56fbccfadaf28cdbd82.html"</span>,</span><br><span class="line">			<span class="attr">"backReason"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"isBack"</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">"attachments"</span>: []</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里我们获取需要的schoolTaskWid。</p><h1 id="六、获取详细表单"><a href="#六、获取详细表单" class="headerlink" title="六、获取详细表单"></a>六、获取详细表单</h1><p>今日校园还有一条验证就是每次请求的表的id，以及表选项的id都是变化的。</p><p>所有，我们还需要抓取表的详细表单。</p><p>接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;wec-counselor-collector-apps&#x2F;stu&#x2F;collector&#x2F;getFormFields</span><br></pre></td></tr></table></figure><p>参数</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"pageSize"</span>:<span class="number">30</span>,<span class="attr">"pageNumber"</span>:<span class="number">1</span>,<span class="attr">"formWid"</span>:formWid,<span class="attr">"collectorWid"</span>:collectorWid&#125;</span><br></pre></td></tr></table></figure><p>返回的内容，依你们老师的设定为准，不放结果了。</p><h1 id="七、模拟Post请求提交"><a href="#七、模拟Post请求提交" class="headerlink" title="七、模拟Post请求提交"></a>七、模拟Post请求提交</h1><h2 id="7-1-思路"><a href="#7-1-思路" class="headerlink" title="7.1 思路"></a>7.1 思路</h2><p>接口</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/wec-counselor-collector-apps/stu/collector/submitForm</span><br></pre></td></tr></table></figure><p>通过上面，我们获取到了formWid，collectWid，schoolTaskWid，address，form。</p><p>接下来，我们构造出post的json字符串请求体。</p><p>发送！</p><p>成功！</p><h2 id="7-2-邮件通知"><a href="#7-2-邮件通知" class="headerlink" title="7.2 邮件通知"></a>7.2 邮件通知</h2><p>如果提交成功，或者提交失败。都会发通知邮件给我。</p><p>但是，试了几次，经常报错<code>554 DT:SPM</code>，也就是被当做垃圾邮件驳回了。</p><p>尝试了好几个邮箱，像139,163,qq邮箱，都会有这个问题，网上说设置端口啊，不要25，要465…开启ssl…等等</p><p>如果涉及到敏感词，什么签到、自动，仍然没有一个奏效的，都没当成垃圾邮件处理。</p><p>刚好看到一个大佬写的博客，建议用腾讯企业邮箱，试了一下，果然ok了。</p><p><a href="https://blog.csdn.net/qq_38410730/article/details/86538298?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1" target="_blank" rel="noopener">记录一次Could not connect to SMTP host: smtp.163.com, port: 25的解决办法</a></p><blockquote><p>腾讯云或者阿里云，是默认禁用25端口的</p></blockquote><p>我附上发邮件的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMail</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">send</span><span class="params">(String[] mail)</span> </span>&#123;</span><br><span class="line">		Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">		properties.put(<span class="string">"mail.transport.protocol"</span>, <span class="string">"smtp"</span>);<span class="comment">// 连接协议</span></span><br><span class="line">        properties.put(<span class="string">"mail.smtp.host"</span>, <span class="string">"smtp.exmail.qq.com"</span>);<span class="comment">// 主机名</span></span><br><span class="line">        properties.put(<span class="string">"mail.smtp.port"</span>, <span class="string">"587"</span>);<span class="comment">// 端口号</span></span><br><span class="line">        properties.put(<span class="string">"mail.smtp.auth"</span>, <span class="string">"true"</span>);<span class="comment">//设置smtp是否需要认证</span></span><br><span class="line">        properties.put(<span class="string">"mail.smtp.ssl.enable"</span>, <span class="string">"true"</span>);<span class="comment">// 设置是否使用ssl安全连接 ---一般都使用</span></span><br><span class="line">        properties.put(<span class="string">"mail.debug"</span>, <span class="string">"false"</span>);<span class="comment">// 设置是否显示debug信息 true 会在控制台显示相关信息</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Session session = Session.getInstance(properties);</span><br><span class="line">            Message message = <span class="keyword">new</span> MimeMessage(session);</span><br><span class="line">            message.setFrom(<span class="keyword">new</span> InternetAddress(Data.fromMail));</span><br><span class="line">            message.setRecipient(Message.RecipientType.TO, <span class="keyword">new</span> InternetAddress(Data.toMail));</span><br><span class="line">            message.setSubject(mail[<span class="number">0</span>]);</span><br><span class="line">            message.setText(mail[<span class="number">1</span>]);</span><br><span class="line">            message.setSentDate(<span class="keyword">new</span> Date());</span><br><span class="line">            Transport transport = session.getTransport();</span><br><span class="line">            transport.connect(Data.fromMail, Data.fromMailPw);<span class="comment">//登录发信账号</span></span><br><span class="line">            transport.sendMessage(message, message.getAllRecipients());</span><br><span class="line">            transport.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"邮件发送成功"</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"邮件发送失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-3-运行结果"><a href="#7-3-运行结果" class="headerlink" title="7.3 运行结果"></a>7.3 运行结果</h2><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/3.png" title="结果"><ul><li>获取到新表单，则提交。提交成功或失败，24小时之后，再次监测新表单提交</li><li>未获取到表单数据，继续监测，间隔2小时</li></ul><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/4.png" title="提交"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/5.png" title="邮箱通知"><h1 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h1><h2 id="8-1-感谢大佬"><a href="#8-1-感谢大佬" class="headerlink" title="8.1 感谢大佬"></a>8.1 感谢大佬</h2><p><a href="https://www.cnblogs.com/FSHOU/p/12425456.html" target="_blank" rel="noopener">python版今日校园自动签到、填表</a></p><p><a href="https://github.com/Itswag/cpdaily_submit" target="_blank" rel="noopener">python版今日校园自动填报脚本</a></p><p><a href="https://www.jianshu.com/p/c6059b265dd0" target="_blank" rel="noopener">java定时刷新网页</a></p><p><a href="https://www.bilibili.com/video/BV1Qe411s7q9?from=search&seid=6692535577953796826" target="_blank" rel="noopener">手机抓包教程第四节——系统证书的安装，解决APP抓不到包</a></p><p><a href="https://blog.csdn.net/qq_38410730/article/details/86538298?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1" target="_blank" rel="noopener">记录一次Could not connect to SMTP host: smtp.163.com, port: 25的解决办法</a></p><p><a href="https://blog.csdn.net/yfx000/article/details/56831023" target="_blank" rel="noopener">java抓取网页指定元素/内容</a></p><p><a href="https://github.com/CharlesPikachu/DecryptLogin" target="_blank" rel="noopener">模拟登陆系列</a></p><p><a href="https://mp.weixin.qq.com/s/Awnj0x_E7XJtbOW_7OBwbA" target="_blank" rel="noopener">QQ空间模拟登录</a></p><p>还是那句话，站在巨人的肩膀上</p><p>多亏了有大佬们的指点</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/6.jpg" title="dalao"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/cpdaily-automation/7.jpg" title="dalao"><h2 id="8-2-个人收获"><a href="#8-2-个人收获" class="headerlink" title="8.2 个人收获"></a>8.2 个人收获</h2><p>连着两天，早上5点就起。</p><p>因为这个是学校的老师发的表单，我没有老师权限，没法模拟。</p><p>所以，只能，每天早起，在表单未提交之前，进行测试。这也是最难受的一点。</p><p>今天专业课考试，我当时写代码写得正在兴头上，结果作业没给交上去。估计这学期也就考个60分吧。无所谓了，反正我也不是学霸，计较个锤子。而且，我这学期，也都没咋听课，天天在家里就知道玩。每次都下定决心好好学习，结果，嘿嘿…</p><p>总得来说，抓包还是很关键的。</p><p>这个博客算是整理整个的思路，如果思路看明白了，那么，实现这样的功能就不难了。</p><p>我看网上也有不少的类似程序，但是大多数是Python开发的，确实，Python在处理数据的时候，很舒服，给我的感觉，就是跟JavaScript一样，就是舒服。PHP如果实现这个功能的话，也会比较轻松。</p><p>由于我现在正在学java，还没学透，正好可以拿这个练练手。毕竟，java就像是我的初恋，虽然她身材很臃肿，但我依然爱她啊！</p><p>处理过程中，真的感觉<strong>人生苦短，多用python</strong>。</p><p>像这样的功能，好多编程语言都能实现，Java不是不能，只是太繁琐了。</p><p>如果我再次写这个的话，首选Python，其次Nodejs。</p><p>在分层方面，还是觉得自己做地不太好，像学过的继承多态，我在处理的过程中，就是一直在硬写、闷头写。自己的代码也能看得出毛病来，但是想优化，却又不知从何改起。一方面，是对学过的东西，没有彻底理解；另一方面，也是自己的项目经验太少了。</p><p>一定要花时间，弥补这方面的不足！</p></div><div class="post-detail">发布：2020-05-06 20:06:46<br>修改：2020-09-16 19:20:27<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/cpdaily-automation/</span><br>标签：<span><a href="/blog/tags/java/">java</a>&nbsp;<a href="/blog/tags/open/">open</a>&nbsp;<a href="/blog/tags/spider/">spider</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="post-comment"><span class="instruction">翻墙之后才能评论哦</span><div id="gitalk-container"></div></div><link rel="stylesheet" href="/blog/css/gitalk.css"><script src="/blog/js/gitalk.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"84249c02e216e3ce376a",clientSecret:"a032ae7096d026eff848b5815da5afde341e9ffd",repo:"meethigher.github.io",owner:"meethigher",admin:["meethigher"],id:location.pathname,distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>