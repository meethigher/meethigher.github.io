<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="keywords" content="Filter和Listener,个人网站，个人博客，meethigher，学习，生活"><meta name="description" content="今天整下，javaweb的三大核心组件中的两个，Filter和Listener"><title>Filter和Listener</title><link rel="shortcut icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/css/meethigher-font.css"><link rel="stylesheet" href="/blog/css/index.css"></head><body><header class="header"><div class="header-menu"><span class="fa fa-bars"></span></div><div class="header-search"><span class="fa fa-search"></span></div><div class="header-title"><a href="/">言成言成啊<span class="header-subtitle"> | Kit Chen&#39;s Blog</span></a></div><ul class="header-navbar clearFix"><li><a href="/blog/">主页</a></li><li><a href="/blog/tags">标签</a></li><li><a href="/blog/archives">归档</a></li><li><a href="/blog/about">关于</a></li></ul></header><div id="particles-js"></div><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/app.js"></script><div class="search" title="站内搜索"><span class="fa fa-search"></span></div><div class="tool"><div class="up" title="返回顶部"><span class="fa fa-long-arrow-up"></span></div><div class="down" title="返回底部"><span class="fa fa-long-arrow-down"></span></div><a href="/blog/app.apk" class="app" title="下载App" download="app.apk"><span class="fa fa-android"></span></a></div><main class="main"><div class="main-content"><article class="post"><div class="post-title"><h2 class="title">Filter和Listener</h2></div><div class="post-content blog-markdown"><p>javaweb三大组件，Servlet、Filter和Listener。这三者都需要配置，都可以通过web.xml或者注解来配置</p><h1 id="一、Filter过滤器"><a href="#一、Filter过滤器" class="headerlink" title="一、Filter过滤器"></a>一、Filter过滤器</h1><h2 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h2><p>生活中的过滤器：如净水器、空气净化器，打劫。</p><p>web中的过滤器：在浏览器到服务器的请求之间，或者服务器对浏览器的响应之间，进行拦截，以此来完成特殊的功能。</p><p>过滤器的作用：一般用于完成通过的操作。如登录验证、统一编码处理、敏感字符过滤</p><h2 id="1-2-快速入门"><a href="#1-2-快速入门" class="headerlink" title="1.2 快速入门"></a>1.2 快速入门</h2><p>步骤：</p><ol><li>定义一个类，实现Filter接口</li><li>重写方法</li><li>配置拦截路径</li></ol><p>两种配置方式：</p><ol><li>web.xml配置（参照1.3）</li><li>注解配置（下面使用的就是注解配置）</li></ol><blockquote><p>在过滤器中，要考虑是否放行，如果不放行，访问的资源内容就不会被加载</p><p>放行执行的代码filterChain.doFilter(servletRequest, servletResponse); 将request跟response传进去。</p></blockquote><p>jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">测试过滤器..</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 过滤器快速入门</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">/* 表示访问所有资源之前，都会执行该过滤器</span></span><br><span class="line"><span class="comment">/index.jsp 表示访问index.jsp之前，执行该过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter</span>(<span class="string">"/*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Filter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"filter被执行了..."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//考虑是否放行，如果不放行，访问的资源内容就不会被加载</span></span><br><span class="line">        <span class="comment">//下面进行放行</span></span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-3-过滤器细节"><a href="#1-3-过滤器细节" class="headerlink" title="1.3 过滤器细节"></a>1.3 过滤器细节</h2><h3 id="web-xml配置"><a href="#web-xml配置" class="headerlink" title="web.xml配置"></a>web.xml配置</h3><p>此处带有之前的servlet的配置，我就不删掉了。为了方便阅读，删掉其实比较好。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置Servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>demo01_servlet.Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Servlet映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置Servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo02<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>demo01_servlet.Demo02Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定Servlet的创建时机</span></span><br><span class="line"><span class="comment">        1. 第一次被访问时，创建。&lt;load-on-startup&gt;为负数，一般为-1</span></span><br><span class="line"><span class="comment">        2. 在服务器启动时，创建。&lt;load-on-startup&gt;为0或正整数，一般为0-10</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Servlet映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo02<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo02<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置Filter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>filter01<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>demo10_filter.Demo02Filter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>filter01<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 拦截路径， /* 表示，访问所有资源都要经过过滤器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="过滤器执行流程"><a href="#过滤器执行流程" class="headerlink" title="过滤器执行流程"></a>过滤器执行流程</h3><p>如果去了解整个底层工作原理，会发现，本质就是一个方法的顺序执行。</p><ol><li>执行过滤器</li><li>放行</li><li>执行放行后的资源</li><li>回来执行过滤器</li></ol><p>java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter</span>(<span class="string">"/*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03Filter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//在放行之前，可以对request消息对象进行增强</span></span><br><span class="line">        System.out.println(<span class="string">"filter03执行.."</span>);</span><br><span class="line"></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在放行之后，可以对response消息对象进行增强</span></span><br><span class="line">        System.out.println(<span class="string">"filter03回来了.."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">测试过滤器..</span><br><span class="line">&lt;%</span><br><span class="line">    System.out.println(<span class="string">"访问到index.jsp"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/filter-and-listener/1.png"><h3 id="过滤器生命周期方法"><a href="#过滤器生命周期方法" class="headerlink" title="过滤器生命周期方法"></a>过滤器生命周期方法</h3><ol><li>init：在服务器启动后，就会创建Filter对象，然后调用init方法，只执行一次。用于加载资源。<ul><li>Servlet中默认是Servlet第一次被访问创建时，仅执行一次。此时Filter的init会比Servlet的先执行</li><li>Servlet也可以配置在启动服务器即执行，一般用于加载资源。经过测试，此时也仍然是Filter的init先执行</li></ul></li><li>doFilter：每一次请求，被拦截资源时执行。具体的拦截操作逻辑，放在这里</li><li>destroy：在服务器正常关闭后，Filter对象被销毁。如果服务器是正常关闭，则会执行destroy方法。只执行一次，用于释放资源</li></ol><h3 id="过滤器配置详解"><a href="#过滤器配置详解" class="headerlink" title="过滤器配置详解"></a>过滤器配置详解</h3><ol><li><p>拦截路径配置</p><ul><li>具体的资源路径：/index.jsp，只有访问index.jsp资源时，过滤器才会被执行。不过这种情况一般比较少，因为过滤器通常是用来拦截通用操作的。比方说，登录验证、敏感词过滤、统一编码</li><li>目录拦截：/user/*，访问/user下的所有资源时，过滤器都会被执行</li><li>后缀名拦截：*.jsp，访问所有后缀名为jsp资源时，过滤器都会被执行</li><li>拦截所有资源：/*，访问所有资源时，过滤器都会被执行</li></ul></li><li><p>拦截方式配置：资源被访问的方式</p><ul><li><p>注解配置：设置dispatcherTypes属性</p><ul><li><p>REQUEST：默认值。浏览器直接请求资源</p></li><li><p>FORWARD：转发访问资源</p></li><li><p>INCLUDE：包含访问资源</p></li><li><p>ASYNC：异步访问资源</p></li><li><p>ERROR：错误跳转资源</p></li></ul></li><li><p>web.xml配置：在filter-mapping下配置<code>&lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;</code>，取值也是上面5个</p></li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//浏览器请求资源时，该过滤器会被执行</span></span><br><span class="line"><span class="comment">//@WebFilter(value="/filter/index.jsp",dispatcherTypes = DispatcherType.REQUEST)</span></span><br><span class="line"><span class="comment">//浏览器转发资源时，该过滤器会被执行</span></span><br><span class="line"><span class="comment">//@WebFilter(value="/filter/index.jsp",dispatcherTypes = DispatcherType.FORWARD)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//浏览器请求资源或者转发资源时，该过滤器会被执行</span></span><br><span class="line"><span class="meta">@WebFilter</span>(value=<span class="string">"/filter/index.jsp"</span>,dispatcherTypes = &#123;DispatcherType.FORWARD,DispatcherType.REQUEST&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05Filter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"filter05.."</span>);</span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤器链（配置多个过滤器）"><a href="#过滤器链（配置多个过滤器）" class="headerlink" title="过滤器链（配置多个过滤器）"></a>过滤器链（配置多个过滤器）</h3><h4 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h4><p>执行顺序：如果有两个过滤器，分别为过滤器1和过滤器2</p><ol><li>过滤器1</li><li>过滤器2</li><li>资源执行</li><li>过滤器2</li><li>过滤器1</li></ol><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/filter-and-listener/2.png"><h4 id="过滤器先后顺序"><a href="#过滤器先后顺序" class="headerlink" title="过滤器先后顺序"></a>过滤器先后顺序</h4><p>注解配置：按照类型的字符串比较规则，值小的先执行。</p><ul><li>如AFilter和BFilter，A小，故A先执行；Demo6和Demo17比较，Demo17先执行</li></ul><p>web.xml配置：<code>&lt;filter-mapping&gt;</code>哪个定义在上边，哪个先执行</p><h2 id="1-4-过滤器案例"><a href="#1-4-过滤器案例" class="headerlink" title="1.4 过滤器案例"></a>1.4 过滤器案例</h2><h2 id="登录验证"><a href="#登录验证" class="headerlink" title="登录验证"></a>登录验证</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>需求：</p><ol><li>如果登录，则放行</li><li>如果没有登录，则跳转登录页</li></ol><p>分析：</p><ol><li>判断是否是登录相关资源。如果不排除登录资源，会陷入死循环。<ul><li>是，放行</li><li>否，验证是否登录</li></ul></li><li>判断是否登录<ul><li>是，放行</li><li>否，返回登录页</li></ul></li></ol><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>LoginFilter.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录验证过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter</span>(<span class="string">"/filter/*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//强制转换，不然没法使用其子类方法</span></span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) req;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取资源请求路径</span></span><br><span class="line">        String requestURI = request.getRequestURI();</span><br><span class="line">        <span class="comment">//2.判断是否包含登录相关的资源</span></span><br><span class="line">        <span class="keyword">if</span> (requestURI.contains(<span class="string">"/filter/login.jsp"</span>) || requestURI.contains(<span class="string">"/filter/loginServlet"</span>)||requestURI.contains(<span class="string">"/filter/checkCodeServlet"</span>)||requestURI.contains(<span class="string">"/css/"</span>)||requestURI.contains(<span class="string">"/js/"</span>)) &#123;</span><br><span class="line">            <span class="comment">//放行</span></span><br><span class="line">            System.out.println(<span class="string">"登录资源，放行"</span>);</span><br><span class="line">            chain.doFilter(req,resp);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//验证是否登录</span></span><br><span class="line">            HttpSession session = request.getSession();</span><br><span class="line">            <span class="keyword">if</span>(session.getAttribute(<span class="string">"user"</span>)!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">"已登录，放行"</span>);</span><br><span class="line">                chain.doFilter(req,resp);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                request.setAttribute(<span class="string">"login_error"</span>,<span class="string">"您尚未登录"</span>);</span><br><span class="line">                request.getRequestDispatcher(<span class="string">"login.jsp"</span>).forward(request,resp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LoginServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/filter/loginServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//        1. 设置request编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line"><span class="comment">//        2. 获取参数Map集合</span></span><br><span class="line"><span class="comment">//        Map&lt;String, String[]&gt; map = request.getParameterMap();</span></span><br><span class="line">        String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">        String checkcode = request.getParameter(<span class="string">"checkcode"</span>);</span><br><span class="line"><span class="comment">//        3. 获取验证码</span></span><br><span class="line">        String code = (String)session.getAttribute(<span class="string">"checkcode"</span>);</span><br><span class="line">        <span class="comment">//这是为了使验证码保持一次性使用</span></span><br><span class="line">        session.removeAttribute(<span class="string">"checkcode"</span>);</span><br><span class="line">        <span class="comment">//忽略大小写</span></span><br><span class="line">        <span class="keyword">if</span>(code!=<span class="keyword">null</span>&amp;&amp;code.equalsIgnoreCase(checkcode))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"胡列娜"</span>.equals(username)&amp;&amp;<span class="string">"fairy"</span>.equals(password))&#123;</span><br><span class="line">                <span class="comment">//存储信息</span></span><br><span class="line">                session.setAttribute(<span class="string">"user"</span>,username);</span><br><span class="line">                <span class="comment">//重定向</span></span><br><span class="line">                response.sendRedirect(<span class="string">"/filter/success.jsp"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//存储信息</span></span><br><span class="line">                request.setAttribute(<span class="string">"login_error"</span>,<span class="string">"用户名或者密码错误"</span>);</span><br><span class="line">                <span class="comment">//转发</span></span><br><span class="line">                request.getRequestDispatcher(<span class="string">"/filter/login.jsp"</span>).forward(request,response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//存储信息</span></span><br><span class="line">            request.setAttribute(<span class="string">"cc_error"</span>,<span class="string">"验证码错误"</span>);</span><br><span class="line">            <span class="comment">//转发</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/filter/login.jsp"</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        4. 将用户信息封装到User对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CheckCodeServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/filter/checkCodeServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> width=<span class="number">100</span>;</span><br><span class="line">        <span class="keyword">int</span> height=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.创建对象，在内存中画图（验证码图片对象）</span></span><br><span class="line">        BufferedImage image=<span class="keyword">new</span> BufferedImage(width,height,BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">//2.美化图片</span></span><br><span class="line">        <span class="comment">//2.1填充背景色</span></span><br><span class="line">        Graphics g=image.getGraphics();<span class="comment">//绘图对象</span></span><br><span class="line">        g.setColor(<span class="keyword">new</span> Color(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</span><br><span class="line">        g.fillRect(<span class="number">0</span>,<span class="number">0</span>,width,height);</span><br><span class="line">        <span class="comment">//2.2画边框</span></span><br><span class="line">        g.setColor(Color.RED);</span><br><span class="line">        g.drawRect(<span class="number">0</span>,<span class="number">0</span>,width-<span class="number">1</span>,height-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//2.3写验证码</span></span><br><span class="line">        String str=<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">        Random r=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="comment">//StringBuilder在处理多个字符串拼接的时候，效率要比+拼接要高很多。</span></span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//设置字体,绘制字符</span></span><br><span class="line">            g.setFont(<span class="keyword">new</span> Font(Font.SANS_SERIF,Font.BOLD,<span class="number">20</span>));</span><br><span class="line">            <span class="keyword">char</span> c = str.charAt(r.nextInt(str.length()));</span><br><span class="line">            stringBuilder.append(c);</span><br><span class="line">            g.drawString(String.valueOf(c),width/<span class="number">5</span>*(i+<span class="number">1</span>),height/<span class="number">2</span>+<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将验证码存入session</span></span><br><span class="line">        String checkcode=stringBuilder.toString();</span><br><span class="line">        request.getSession().setAttribute(<span class="string">"checkcode"</span>,checkcode);</span><br><span class="line">        <span class="comment">//2.4 画干扰线</span></span><br><span class="line">        g.setColor(Color.green);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x1=r.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y1=r.nextInt(height);</span><br><span class="line">            <span class="keyword">int</span> x2=r.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y2=r.nextInt(height);</span><br><span class="line">            g.drawLine(x1,y1,x2,y2);<span class="comment">//画线</span></span><br><span class="line">            <span class="comment">//画点</span></span><br><span class="line"><span class="comment">//            g.drawOval(x1,y1,5,5);</span></span><br><span class="line"><span class="comment">//            g.fillOval(x1,y1,5,5);</span></span><br><span class="line"><span class="comment">//            g.drawOval(x2,y2,5,5);</span></span><br><span class="line"><span class="comment">//            g.fillOval(x2,y2,5,5);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.将图片输出到页面展示</span></span><br><span class="line">        ImageIO.write(image,<span class="string">"jpg"</span>,response.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>login.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        * &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .box &#123;</span><br><span class="line">            background-color: #74C3B5;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width:<span class="number">100</span>vw;</span><br><span class="line">            height:<span class="number">100</span>vh;</span><br><span class="line">            position:fixed;</span><br><span class="line">        &#125;</span><br><span class="line">        .container &#123;</span><br><span class="line">            width: <span class="number">600</span>px;</span><br><span class="line">            margin: <span class="number">80</span>px auto;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .logo &#123;</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">70</span>px;</span><br><span class="line">            margin: auto;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">            margin-bottom: <span class="number">40</span>px;</span><br><span class="line">            font-size:<span class="number">44</span>px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        input &#123;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">40</span>px;</span><br><span class="line">            <span class="comment">/*opacity:.5;*/</span></span><br><span class="line">            transition: all ease .<span class="number">4</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">2</span>);</span><br><span class="line">            text-align: center;</span><br><span class="line">            font-size: <span class="number">20</span>px;</span><br><span class="line">            border: <span class="number">2</span><span class="function">px solid <span class="title">rgba</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">.4</span>)</span></span>;</span><br><span class="line">            outline: none;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        img &#123;</span><br><span class="line">            outline: <span class="number">0</span>;</span><br><span class="line">            border: <span class="number">1</span><span class="function">px solid <span class="title">rgba</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>)</span></span>;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">70</span>px;</span><br><span class="line">            border-radius: <span class="number">3</span>px;</span><br><span class="line">            padding: <span class="number">5</span>px <span class="number">8</span>px;</span><br><span class="line">            margin: <span class="number">0</span> auto <span class="number">5</span>px auto;</span><br><span class="line">            display: block;</span><br><span class="line">            text-align: center;</span><br><span class="line">            color: white;</span><br><span class="line">            opacity: .<span class="number">9</span>;</span><br><span class="line">            box-sizing: border-box;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        input:focus &#123;</span><br><span class="line">            color: #75DFB7;</span><br><span class="line">            width: <span class="number">300</span>px;</span><br><span class="line">            background-color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        button &#123;</span><br><span class="line">            width: <span class="number">250</span>px;</span><br><span class="line">            height: <span class="number">40</span>px;</span><br><span class="line">            border: none;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">9</span>);</span><br><span class="line">            font-size: <span class="number">20</span>px;</span><br><span class="line">            color: #75DFB7;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ul &#123;</span><br><span class="line">            list-style: none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        li &#123;</span><br><span class="line">            line-height: <span class="number">50</span>px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        form a &#123;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        input::placeholder &#123;</span><br><span class="line">            color:#fff;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            top: <span class="number">0</span>;</span><br><span class="line">            left: <span class="number">0</span>;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            height: <span class="number">100</span>%;</span><br><span class="line">            z-index: <span class="number">1</span>;</span><br><span class="line">            pointer-events: none;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            list-style: none;</span><br><span class="line">            display: block;</span><br><span class="line">            width: <span class="number">40</span>px;</span><br><span class="line">            height: <span class="number">40</span>px;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.15</span>);</span><br><span class="line">            bottom: -<span class="number">160</span>px;</span><br><span class="line">            -webkit-animation: square <span class="number">25</span>s infinite;</span><br><span class="line">            animation: square <span class="number">25</span>s infinite;</span><br><span class="line">            -webkit-transition-timing-function: linear;</span><br><span class="line">            transition-timing-function: linear;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">1</span>) &#123;</span><br><span class="line">            left: <span class="number">10</span>%;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">2</span>) &#123;</span><br><span class="line">            left: <span class="number">20</span>%;</span><br><span class="line">            width: <span class="number">80</span>px;</span><br><span class="line">            height: <span class="number">80</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">2</span>s;</span><br><span class="line">            animation-delay: <span class="number">2</span>s;</span><br><span class="line">            -webkit-animation-duration: <span class="number">17</span>s;</span><br><span class="line">            animation-duration: <span class="number">17</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">3</span>) &#123;</span><br><span class="line">            left: <span class="number">25</span>%;</span><br><span class="line">            -webkit-animation-delay: <span class="number">4</span>s;</span><br><span class="line">            animation-delay: <span class="number">4</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">4</span>) &#123;</span><br><span class="line">            left: <span class="number">40</span>%;</span><br><span class="line">            width: <span class="number">60</span>px;</span><br><span class="line">            height: <span class="number">60</span>px;</span><br><span class="line">            -webkit-animation-duration: <span class="number">22</span>s;</span><br><span class="line">            animation-duration: <span class="number">22</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.25</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">5</span>) &#123;</span><br><span class="line">            left: <span class="number">70</span>%;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">6</span>) &#123;</span><br><span class="line">            left: <span class="number">80</span>%;</span><br><span class="line">            width: <span class="number">120</span>px;</span><br><span class="line">            height: <span class="number">120</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">3</span>s;</span><br><span class="line">            animation-delay: <span class="number">3</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">7</span>) &#123;</span><br><span class="line">            left: <span class="number">32</span>%;</span><br><span class="line">            width: <span class="number">160</span>px;</span><br><span class="line">            height: <span class="number">160</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">7</span>s;</span><br><span class="line">            animation-delay: <span class="number">7</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">8</span>) &#123;</span><br><span class="line">            left: <span class="number">55</span>%;</span><br><span class="line">            width: <span class="number">20</span>px;</span><br><span class="line">            height: <span class="number">20</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">15</span>s;</span><br><span class="line">            animation-delay: <span class="number">15</span>s;</span><br><span class="line">            -webkit-animation-duration: <span class="number">40</span>s;</span><br><span class="line">            animation-duration: <span class="number">40</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">9</span>) &#123;</span><br><span class="line">            left: <span class="number">25</span>%;</span><br><span class="line">            width: <span class="number">10</span>px;</span><br><span class="line">            height: <span class="number">10</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">2</span>s;</span><br><span class="line">            animation-delay: <span class="number">2</span>s;</span><br><span class="line">            -webkit-animation-duration: <span class="number">40</span>s;</span><br><span class="line">            animation-duration: <span class="number">40</span>s;</span><br><span class="line">            background-color: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .bg-bubbles li:nth-child(<span class="number">10</span>) &#123;</span><br><span class="line">            left: <span class="number">90</span>%;</span><br><span class="line">            width: <span class="number">160</span>px;</span><br><span class="line">            height: <span class="number">160</span>px;</span><br><span class="line">            -webkit-animation-delay: <span class="number">11</span>s;</span><br><span class="line">            animation-delay: <span class="number">11</span>s;</span><br><span class="line">        &#125;</span><br><span class="line">        @-webkit-keyframes square &#123;</span><br><span class="line">            <span class="number">0</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(<span class="number">0</span>);</span><br><span class="line">                transform: translateY(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="number">100</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">                transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@keyframes</span> square &#123;</span><br><span class="line">            <span class="number">0</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(<span class="number">0</span>);</span><br><span class="line">                transform: translateY(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="number">100</span>% &#123;</span><br><span class="line">                -webkit-transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">                transform: translateY(-<span class="number">700</span>px) rotate(<span class="number">600</span>deg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        error &#123;</span><br><span class="line">            color:deeppink;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String login_error = (String) request.getAttribute(<span class="string">"login_error"</span>);</span><br><span class="line">    String cc_error = (String) request.getAttribute(<span class="string">"cc_error"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"box"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"logo"</span>&gt;</span><br><span class="line">            住房公积金</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">            <span class="keyword">if</span>(login_error!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                out.write(<span class="string">"&lt;error&gt;"</span>+login_error+<span class="string">"&lt;/error&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cc_error!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                out.write(<span class="string">"&lt;error&gt;"</span>+cc_error+<span class="string">"&lt;/error&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        %&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/filter/loginServlet"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &lt;li&gt;&lt;input type="text" name="username" placeholder="用户名" autocomplete="off"&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;input type="text" name="password" placeholder="密码" autocomplete="off"&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;input type="text" name="checkcode" placeholder="不区分大小写"&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;img id="checkcode" src="/filter/checkCodeServlet" alt=""&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;button&gt;登录&lt;/button&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"bg-bubbles"</span>&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    document.querySelector(<span class="string">"#checkcode"</span>).onclick=function ()&#123;</span><br><span class="line">        let url = <span class="string">"/filter/checkCodeServlet"</span>;</span><br><span class="line">        let date=<span class="keyword">new</span> Date().getTime();</span><br><span class="line">        <span class="keyword">this</span>.setAttribute(<span class="string">"src"</span>, url+<span class="string">"?"</span>+date)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>success.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;主页&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        * &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .box &#123;</span><br><span class="line">            background-color: #74C3B5;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width: <span class="number">100</span>vw;</span><br><span class="line">            height: <span class="number">100</span>vh;</span><br><span class="line">            position: fixed;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"box"</span>&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        String user = (String) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        out.write(user+<span class="string">"欢迎你"</span>);</span><br><span class="line"></span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>注意事项：</p><p>应当注意，像login.jsp，LoginServlet.java，CheckCodeServlet.java，css，js这些都属于登录资源，访问这些的时候，直接放行。</p></blockquote><h2 id="敏感词过滤验证"><a href="#敏感词过滤验证" class="headerlink" title="敏感词过滤验证"></a>敏感词过滤验证</h2><h3 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h3><p>需求：表单中含有<code>胡列娜</code>或者<code>江厌离</code>或者<code>邱若水</code>就自动转为<code>***</code></p><p>分析：在过滤器中，对request传过来的内容进行修改，将修改内容后的request进行放行（request中并没有setParameter这个方法）</p><p>解决方法：</p><ol><li>对request对象的getParameter方法进行增强（通过getParameter获取到的内容就是已经过滤的了）。产生一个新的request对象</li><li>放行。将新的request对象传入</li></ol><p>重点分析：如何对geParameter方法进行增强？</p><p>增强对象的功能的途径：</p><ul><li>设计模式：一些通用的解决固定问题的方式，<a href="https://www.runoob.com/design-pattern/design-pattern-tutorial.html" target="_blank" rel="noopener">参考</a><ul><li>装饰模式</li><li>代理模式<ul><li>概念：真实对象（比如小米公司）、代理对象（比如小米旗舰店），代理模式（代理对象代替真实对象，达到增强真实对象的目的）</li><li>静态代理（有一个类文件描述代理模式）</li><li>动态代理（在内存中形成代理类）<ul><li>实现步骤<ul><li>代理对象和真实对象实现相同的接口</li><li>代理对象=Proxy.newProxyInstance()</li><li>使用代理对象调用方法</li><li>增强方法</li></ul></li><li>增强方式<ul><li>增强参数列表</li><li>增强返回值类型</li><li>增强方法体执行逻辑</li></ul></li></ul></li></ul></li></ul></li></ul><h3 id="理解动态代理demo"><a href="#理解动态代理demo" class="headerlink" title="理解动态代理demo"></a>理解动态代理demo</h3><p>下面通过动态代理模拟一个现实生活中的例子，买电脑。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/filter-and-listener/3.png"><p>接口SellComputer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SellComputer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sale</span><span class="params">(<span class="keyword">double</span> money)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接口SellComputer的实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 真实类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/meethigher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lenovo</span> <span class="keyword">implements</span> <span class="title">SellComputer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sale</span><span class="params">(<span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"花钱"</span>+money+<span class="string">"买电脑"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"联想电脑"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"展示电脑..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动态代理增强对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建真实对象</span></span><br><span class="line">        Lenovo lenovo = <span class="keyword">new</span> Lenovo();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.调用方法</span></span><br><span class="line">        <span class="comment">//但是我们不应该直接通过真实对象来处理，我们需要通过一个增强对象</span></span><br><span class="line">        <span class="comment">//因为直接通过真实对象方法处理并不满足我们需求，就比方说request的getParameter实现敏感词过滤</span></span><br><span class="line"><span class="comment">//        String sale = lenovo.sale(8000);//花钱8000买电脑</span></span><br><span class="line"><span class="comment">//        System.out.println(sale);//联想电脑</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.动态代理增强lenovo对象</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 三个参数</span></span><br><span class="line"><span class="comment">         * 1. 类加载器：真实对象.getClass().getClassLoader()</span></span><br><span class="line"><span class="comment">         * 2. 接口数组：真实对象.getClass().getInterfaces()</span></span><br><span class="line"><span class="comment">         * 3. 处理器：new InvocationHandler()，这个就是增强对象的核心方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        SellComputer proxy_lenovo = (SellComputer) Proxy.newProxyInstance(lenovo.getClass().getClassLoader(), lenovo.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 代理逻辑编写的方法：代理对象调用的所有方法，都会触发该方法执行</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> proxy 代理对象，一般我们不会用</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method 代理对象调用的方法，被封装的对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args 代理对象调用方法时，传递的实际参数</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * 判断是否是sale方法</span></span><br><span class="line"><span class="comment">                 * 若是，对其增强再返回</span></span><br><span class="line"><span class="comment">                 * 若否，直接原样返回</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span>(method.getName().equals(<span class="string">"sale"</span>))&#123;</span><br><span class="line">                    <span class="comment">//1.增强参数</span></span><br><span class="line">                    <span class="keyword">double</span> money = (<span class="keyword">double</span>)args[<span class="number">0</span>];</span><br><span class="line">                    money=money*<span class="number">1.2</span>;</span><br><span class="line">                    <span class="comment">//使用真实对象调用该方法</span></span><br><span class="line">                    System.out.println(<span class="string">"专车接你..."</span>);</span><br><span class="line">                    System.out.println(<span class="string">"免费送货..."</span>);</span><br><span class="line">                    String obj = (String)method.invoke(lenovo, money);</span><br><span class="line">                    <span class="keyword">return</span> obj+<span class="string">"&amp;&amp;鼠标垫"</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    Object obj = method.invoke(lenovo, args);</span><br><span class="line">                    <span class="keyword">return</span> obj;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        String sale = proxy_lenovo.sale(<span class="number">8000</span>);<span class="comment">//专车接你...免费送货...花钱9600.0买电脑</span></span><br><span class="line">        System.out.println(<span class="string">"买到了"</span>+sale);<span class="comment">//买到了联想电脑&amp;&amp;鼠标垫</span></span><br><span class="line">        proxy_lenovo.show();<span class="comment">//展示电脑...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><p>index.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">"testServlet"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;textarea name="remark"&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>SensitiveFilter.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter</span>(<span class="string">"/filter_proxy/*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建代理对象，增强getParameter方法</span></span><br><span class="line">        ServletRequest proxy_req = (ServletRequest)Proxy.newProxyInstance(req.getClass().getClassLoader(), req.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//判断getParameter,getParameterMap,getParameterValue</span></span><br><span class="line">                <span class="comment">//此处指拿getParameter举个例子</span></span><br><span class="line">                <span class="keyword">if</span>(method.getName().equals(<span class="string">"getParameter"</span>))&#123;</span><br><span class="line">                    <span class="comment">//增强返回值。先获取返回值，进行过滤，再返回</span></span><br><span class="line"><span class="comment">//                    req.setCharacterEncoding("utf-8");</span></span><br><span class="line">                    String value= (String)method.invoke(req, args);</span><br><span class="line">                    <span class="keyword">if</span>(value!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(String str:list)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(value.contains(str))&#123;</span><br><span class="line">                                value=value.replaceAll(str,<span class="string">"***"</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> value;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> method.invoke(req,args);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//2.放行</span></span><br><span class="line">        chain.doFilter(proxy_req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;String&gt;();<span class="comment">//敏感词汇集合</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">//加载配置文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.获取文件真实路径</span></span><br><span class="line">            ServletContext sc = config.getServletContext();</span><br><span class="line">            String realPath = sc.getRealPath(<span class="string">"/WEB-INF/classes/sensitivewords.txt"</span>);</span><br><span class="line">            <span class="comment">//2.读取文件</span></span><br><span class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(realPath, StandardCharsets.UTF_8));</span><br><span class="line">            String line=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span>((line=br.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                list.add(line);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"加载敏感词"</span>);</span><br><span class="line">            br.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TestServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/filter_proxy/testServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        String remark = request.getParameter(<span class="string">"remark"</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">"&lt;h1&gt;"</span>+remark+<span class="string">"&lt;/h1&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" data-original="/blog/2020/filter-and-listener/4.png"><h1 id="二、Listener监听器"><a href="#二、Listener监听器" class="headerlink" title="二、Listener监听器"></a>二、Listener监听器</h1><h2 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2.1 概念"></a>2.1 概念</h2><p>web的三大组件之一。</p><p>事件监听机制</p><ul><li>事件：一件事情。比方说点击按钮</li><li>事件源：事件发生的地方</li><li>监听器：一段代码或者一个对象</li><li>注册监听：将事件、事件源、监听器绑定在一起，当事件源上发生某个事件后，执行监听器代码</li></ul><h2 id="2-2-ServletContextListener"><a href="#2-2-ServletContextListener" class="headerlink" title="2.2 ServletContextListener"></a>2.2 ServletContextListener</h2><p>这是个接口，用来监听ServletContext对象的创建和销毁</p><p>两个方法</p><ul><li>void contextDestroyed(ServletContextEvent sce)：ServletConext对象被销毁之前，会调用该方法</li><li>void contextInitialized(ServletContextEvent sce)：ServletContext对象被创建之后，会调用该方法</li></ul><p>用途：一般用于全局资源文件的加载</p><p>步骤</p><ol><li>定义一个类，实现ServletContextListener接口</li><li>重写方法</li><li>配置<ul><li>web.xml配置</li><li>注解配置：直接在类上面添加<code>@WebListener</code></li></ul></li></ol><p>web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置监听器,此处可以通过@WebListener来代替--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>demo14_listener.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--指定要加载配置文件的初始化参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/classes/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p>demo演示</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听ServletContext对象创建的。ServletContext对象服务器启动后自动创建</span></span><br><span class="line"><span class="comment">     * 在服务器启动后自动调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sce</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//加载资源文件</span></span><br><span class="line">        <span class="comment">//1.获取ServletContext对象</span></span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        <span class="comment">//2.加载资源文件</span></span><br><span class="line">        String contextConfigLocation = servletContext.getInitParameter(<span class="string">"contextConfigLocation"</span>);</span><br><span class="line">        <span class="comment">//3.获取真实路径</span></span><br><span class="line">        String realPath = servletContext.getRealPath(contextConfigLocation);</span><br><span class="line">        <span class="comment">//4.加载进内存</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(realPath);</span><br><span class="line">            System.out.println(fis);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"ServletContext对象被创建了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在服务器关闭后，ServletContext对象被销毁。</span></span><br><span class="line"><span class="comment">     * 当服务器被正常关闭后，该方法被调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sce</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ServletContext对象被销毁了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="post-detail">发布：2020-07-06 21:50:56<br>修改：2020-07-08 08:41:19<br>链接：<span class="shareUrl">https://meethigher.top/blog/2020/filter-and-listener/</span><br>标签：<span><a href="/blog/tags/web/">web</a>&nbsp;<a href="/blog/tags/jsp/">jsp</a>&nbsp;</span></div><div class="post-btn"><img no-lazy src="/blog/images/alipay.png" style="display:none" alt="付款码"> <span class="post-donation-btn">捐助</span> <span class="post-share-btn">分享</span></div><div class="busuanzi"><span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span><script defer src="/blog/js/busuanzi.js"></script></div></article><div class="outline" title="目录"><span class="fa fa-list-alt"></span></div></div></main><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@9.0/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@11/js/layer/layer.js"></script><script src="https://cdn.jsdelivr.net/gh/meethigher/cdn@13/js/instantpage.js"></script><script src="/blog/js/meethigher.js"></script><script>let imgs = $(".post-content.blog-markdown img");imgs.css("width", "100%");</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){n&&(o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var e,i,r=0;r<o.length;r++)e=o[r],0<=(i=e.getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,a=o[r];t=a,e=function(){o=o.filter(function(t){return a===t&&t.removeAttribute("style"),a!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}t.imageLazyLoadSetting.processImages=e;var n=t.imageLazyLoadSetting.isSPA,o=Array.prototype.slice.call(document.querySelectorAll(".blog-markdown img[data-original]"));e(),t.addEventListener("scroll",function(){var n,o;n=e,o=t,clearTimeout(n.tId),n.tId=setTimeout(function(){n.call(o)},500)})}(this)</script></body></html>